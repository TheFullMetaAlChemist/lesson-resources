<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KS3 Physics: Energy and Power (Enhanced + Game Levels)</title>
    <style>
        /* Basic Reset & Body Style */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --primary-color: #005c97;
            --secondary-color: #363795;
            --accent-color: #f39c12;
            --light-bg: #f0f4f8;
            --dark-text: #333;
            --medium-text: #555;
            --light-text: #fff;
            --info-border: #17a2b8;
            --success-border: #28a745;
            --warning-border: #ffc107;
            --danger-border: #dc3545;
            --grey-border: #ced4da;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: var(--light-bg);
            color: var(--dark-text);
            padding-bottom: 50px;
            padding-top: 60px; /* Space for fixed header/toolbar */
        }

        /* Container */
        .container {
            max-width: 1000px;
            margin: 20px auto;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        /* Header Toolbar (Fixed) */
        .header-toolbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: var(--light-text);
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-toolbar h1 {
            margin: 0;
            font-size: 1.5em; /* Smaller for toolbar */
            font-weight: 600;
        }
        .toolbar-buttons button {
            background-color: var(--accent-color);
            color: var(--dark-text);
            border: none;
            padding: 5px 10px;
            margin-left: 10px;
            cursor: pointer;
            font-size: 0.9em;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        .toolbar-buttons button:hover {
            background-color: #e68a00;
        }

        /* Main Navigation */
        nav.main-nav {
            background-color: #e9ecef;
            padding: 10px 0;
            text-align: center;
            border-bottom: 1px solid var(--grey-border);
        }
        nav.main-nav button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 0 10px;
            cursor: pointer;
            font-size: 1.1em;
            border-radius: 5px;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        nav.main-nav button:hover { background-color: #5a6268; }
        nav.main-nav button.active {
            background-color: var(--primary-color);
            font-weight: bold;
            transform: scale(1.05);
        }

        /* Main Content Area */
        main { padding: 25px 30px; }
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Tutorial Section Tabs */
        .tutorial-tabs { display: flex; border-bottom: 2px solid var(--grey-border); margin-bottom: 20px; flex-wrap: wrap; }
        .tutorial-tabs button { background: none; border: none; padding: 10px 15px; cursor: pointer; font-size: 1em; color: var(--medium-text); border-bottom: 3px solid transparent; margin-bottom: -2px; transition: color 0.3s ease, border-color 0.3s ease; }
        .tutorial-tabs button:hover { color: var(--primary-color); }
        .tutorial-tabs button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); font-weight: bold; }
        .tab-content { display: none; animation: fadeIn 0.4s ease; } /* Only one active at a time */
        .tab-content.active { display: block; }

        /* General Content Styling */
        h2 { color: var(--primary-color); margin-top: 20px; margin-bottom: 15px; border-bottom: 2px solid var(--accent-color); padding-bottom: 5px; font-size: 1.8em; }
        h3 { color: var(--secondary-color); margin-top: 15px; margin-bottom: 10px; font-size: 1.4em; }
        p, ul, ol { margin-bottom: 15px; }
        ul, ol { margin-left: 25px; }
        strong { color: var(--danger-border); }
        code, .formula { background-color: #e9ecef; padding: 3px 6px; border-radius: 4px; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; color: #c7254e; font-size: 0.95em; }
        .formula { display: block; padding: 15px; margin: 15px 0; text-align: center; font-size: 1.1em; border: 1px solid var(--grey-border); }

        /* Interactive Elements & Boxes */
        .info-box, .worked-example, .checkpoint, .guided-practice, .simulation, .game-area, .practice-question, .fantastic-fact, .key-words {
            background-color: #f8f9fa; border: 1px solid var(--grey-border); padding: 15px 20px; margin: 20px 0; border-radius: 5px;
        }
        .info-box { border-left: 5px solid var(--info-border); }
        .worked-example { border-left: 5px solid var(--success-border); background-color: #eaf6ec; }
        .checkpoint { border-left: 5px solid var(--warning-border); background-color: #fff9e6; }
        .guided-practice { border-left: 5px solid #fd7e14; background-color: #fff3e0; } /* Orange */
        .simulation { border-left: 5px solid #6f42c1; } /* Purple */
        .game-area { border-left: 5px solid #e83e8c; } /* Pink */
        .practice-question { border-left: 5px solid #6c757d; } /* Grey */
        .fantastic-fact { border-left-color: var(--primary-color); background-color: #e7f5ff; }
        .key-words { border-left-color: var(--warning-border); background-color: #fffbeb; }

        .info-box h4, .worked-example h4, .checkpoint h4, .guided-practice h4, .simulation h4, .game-area h4, .practice-question h4, .fantastic-fact h4, .key-words h4 {
            margin-top: 0; margin-bottom: 10px; font-size: 1.2em; color: var(--dark-text);
        }
        .fantastic-fact h4 { color: #0056b3; font-family: 'Comic Sans MS', cursive, sans-serif; font-size: 1.3em; }
        .key-words h4 { color: #856404; }
         .key-words span { display: inline-block; background-color: #e9ecef; padding: 3px 8px; margin: 3px; border-radius: 4px; font-weight: bold; }

        /* Buttons */
        button.check-button, button.sim-button, button.game-button, button.practice-submit-button, button.hint-button, button.reveal-equations-button {
            background-color: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 0.95em; transition: background-color 0.3s ease; margin-top: 10px; margin-right: 5px; vertical-align: middle;
        }
        button.check-button:hover, button.sim-button:hover, button.game-button:hover, button.practice-submit-button:hover, button.hint-button:hover, button.reveal-equations-button:hover { background-color: #0056b3; }
        button.hint-button { background-color: #ffc107; color: var(--dark-text); }
        button.hint-button:hover { background-color: #e0a800; }

        /* Feedback & Hints */
        .answer-feedback, .hint-content { margin-top: 10px; padding: 10px; border-radius: 4px; font-weight: bold; }
        .answer-feedback.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .answer-feedback.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .hint-content { background-color: #e2e3e5; color: #383d41; border: 1px solid #d6d8db; font-weight: normal; }
        .hidden { display: none; }

        /* Images */
        img.content-image { max-width: 80%; height: auto; display: block; margin: 15px auto; border-radius: 5px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
        figcaption { text-align: center; font-style: italic; color: #6c757d; font-size: 0.9em; margin-top: -5px; margin-bottom: 15px; }

        /* Input Fields */
        input[type="text"], input[type="number"] { padding: 8px; margin: 5px 5px 5px 0; border: 1px solid var(--grey-border); border-radius: 4px; font-size: 1em; width: 100px; }
        textarea { width: 90%; padding: 8px; margin-top: 5px; border: 1px solid var(--grey-border); border-radius: 4px; font-size: 1em; }

        /* Practice Section */
        .practice-question ol { list-style-type: lower-alpha; }
        #practice-results { margin-top: 25px; }

        /* Game Section */
        #game-timer, #game-score { font-weight: bold; font-size: 1.1em; }
        #game-level { font-weight: bold; font-size: 1.1em; margin-left: 15px; } /* Style for level display */
        #game-question { margin: 15px 0; font-size: 1.1em; }
        .game-options button { display: block; width: 100%; margin: 8px 0; padding: 12px; font-size: 1em; text-align: left; }
        #game-feedback { margin-top: 15px; font-weight: bold; }

        /* Floating Calculator & Equations Panel */
        #calculator, #equations-panel {
            position: fixed;
            background-color: #f1f3f5;
            border: 1px solid #adb5bd;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1010;
            transition: width 0.3s, height 0.3s, opacity 0.3s;
            overflow: hidden;
        }
        #calculator {
            bottom: 20px;
            right: 20px;
            width: 260px;
            user-select: none; /* Prevent text selection during drag */
        }
        #equations-panel {
            top: 80px;
            right: 20px;
            width: 300px;
            padding: 15px;
        }
        .calc-header, .equations-header {
            background-color: #6c757d;
            color: white;
            padding: 5px 10px;
            cursor: grab;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .calc-header:active { cursor: grabbing; }
        .calc-display {
            background-color: #e9ecef;
            color: var(--dark-text);
            font-size: 1.5em;
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid #adb5bd;
            min-height: 50px;
            word-wrap: break-word;
        }
        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background-color: #adb5bd; /* For grid gaps */
        }
        .calc-buttons button {
            background-color: #f8f9fa;
            border: none;
            padding: 15px 0;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .calc-buttons button:hover { background-color: #e2e6ea; }
        .calc-buttons button.operator { background-color: #dee2e6; color: var(--primary-color); font-weight: bold; }
        .calc-buttons button.equals { background-color: var(--accent-color); grid-column: span 2; color: var(--dark-text); font-weight: bold;}
        .calc-buttons button.clear { background-color: #ffc107; color: var(--dark-text); }
        .calc-minimize-btn, .equations-close-btn { background: none; border: none; color: white; font-size: 1.2em; cursor: pointer; padding: 0 5px;}
        #calculator.minimized { width: 60px; height: 40px; overflow: hidden; }
        #calculator.minimized .calc-display, #calculator.minimized .calc-buttons { display: none; }
        #calculator.minimized .calc-header { cursor: pointer; } /* Allow clicking header to maximize */

        #equations-panel ul { list-style: none; padding: 0; margin: 10px 0 0 0; }
        #equations-panel li { margin-bottom: 8px; font-size: 1em; }

        /* Helper classes */
        .text-center { text-align: center; }
        .icon { width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;}
    </style>
</head>
<body>

    <!-- Fixed Toolbar -->
    <div class="header-toolbar">
        <h1>Energy & Power</h1>
        <div class="toolbar-buttons">
            <button id="toggle-equations">Equations</button>
            <button id="toggle-calculator">Calculator</button>
        </div>
    </div>

    <!-- Floating Equations Panel (Initially Hidden) -->
    <div id="equations-panel" class="hidden">
        <div class="equations-header">
            <span>Key Equations</span>
            <button class="equations-close-btn" title="Close Equations">×</button>
        </div>
        <ul>
            <li><strong>Power (W)</strong> = Energy (J) / Time (s)</li>
            <li><strong>Energy (J)</strong> = Power (W) × Time (s)</li>
            <li>1 kW = 1000 W</li>
            <li>1 kJ = 1000 J</li>
            <li>1 hour = 3600 s = 60 minutes</li>
            <li><strong>Energy (kWh)</strong> = Power (kW) × Time (hours)</li>
            <li><strong>Cost</strong> = Energy (kWh) × Price (per kWh)</li>
            <li><strong>Cost</strong> = Power (kW) × Time (hours) × Price (per kWh)</li>
        </ul>
    </div>

    <!-- Floating Calculator (Initially Hidden) -->
    <div id="calculator" class="hidden">
        <div class="calc-header">
            <span>Calculator</span>
            <button class="calc-minimize-btn" title="Minimize/Maximize">_</button>
        </div>
        <div class="calc-display" id="calcDisplay">0</div>
        <div class="calc-buttons">
            <button onclick="calcClear()">AC</button>
            <button onclick="calcInput('/')" class="operator">/</button>
            <button onclick="calcInput('*')" class="operator">*</button>
            <button onclick="calcBackspace()">DEL</button>

            <button onclick="calcInput('7')">7</button>
            <button onclick="calcInput('8')">8</button>
            <button onclick="calcInput('9')">9</button>
            <button onclick="calcInput('-')" class="operator">-</button>

            <button onclick="calcInput('4')">4</button>
            <button onclick="calcInput('5')">5</button>
            <button onclick="calcInput('6')">6</button>
            <button onclick="calcInput('+')" class="operator">+</button>

            <button onclick="calcInput('1')">1</button>
            <button onclick="calcInput('2')">2</button>
            <button onclick="calcInput('3')">3</button>
            <button onclick="calcEquals()" class="equals">=</button>

            <button onclick="calcInput('0')" style="grid-column: span 2;">0</button>
            <button onclick="calcInput('.')">.</button>
        </div>
    </div>


    <div class="container">
        <!-- Main Navigation moved below fixed header -->
        <nav class="main-nav">
            <button id="nav-tutorial" class="active">Tutorial</button>
            <button id="nav-practice">Practice Questions</button>
            <button id="nav-game">Game: Power Quiz</button>
        </nav>

        <main id="content-area">

            <!-- Tutorial Section -->
            <section id="tutorial-section" class="content-section active">
                <h2>Tutorial: Understanding Energy and Power</h2>

                 <div class="info-box">
                    <h4>Learning Objectives</h4>
                     <p>After this section you will be able to:</p>
                    <ul>
                        <li>Define power and state its units (W, kW).</li>
                        <li>Define energy and state its units (J, kJ, kWh).</li>
                        <li>Calculate power given energy and time.</li>
                        <li>Calculate energy in kWh given power and time.</li>
                        <li>Calculate the cost of using electrical appliances.</li>
                        <li>Compare energy usage and suggest ways to save energy.</li>
                    </ul>
                </div>

                <div class="tutorial-tabs">
                    <button class="tab-link active" data-tab="tab-intro">Introduction</button>
                    <button class="tab-link" data-tab="tab-power">What is Power?</button>
                    <button class="tab-link" data-tab="tab-units">Units (kW, kJ)</button>
                    <button class="tab-link" data-tab="tab-kwh">Energy (kWh)</button>
                    <button class="tab-link" data-tab="tab-cost">Calculating Cost</button>
                    <button class="tab-link" data-tab="tab-saving">Saving Energy</button>
                </div>

                <!-- Tab Content: Introduction -->
                <div id="tab-intro" class="tab-content active">
                    <h3>Welcome!</h3>
                    <p>Have you ever wondered why some microwave ovens cook popcorn faster than others, or what your electricity bill is actually charging you for? This lesson explores <strong>energy</strong> and <strong>power</strong>, two fundamental concepts in physics that explain how appliances work and how we measure their energy use.</p>
                    <p>Energy makes things happen, and power tells us how quickly that energy is used or transferred.</p>

                    <div class="fantastic-fact">
                        <h4>Fantastic Fact!</h4>
                        <p>When you make popcorn, you are boiling water! The water inside the popcorn kernel turns to steam and expands rapidly, causing the kernel to explode into the fluffy snack we enjoy.</p>
                        <!-- Image: images/popcorn.jpg -->
                        <img src="images/popcorn.jpg" alt="Popcorn popping" class="content-image" style="max-width: 200px;">
                        <figcaption>Heating transfers energy to the water inside the kernel.</figcaption>
                    </div>
                     <!-- Image: images/power_station.jpg -->
                     <figure>
                        <img src="images/power_station.jpg" alt="Power station generating electricity" class="content-image">
                        <figcaption>Power stations generate the electrical energy used in our homes.</figcaption>
                    </figure>
                </div>

                <!-- Tab Content: What is Power? -->
                <div id="tab-power" class="tab-content">
                    <h3>What is Power?</h3>
                    <p>Appliances like microwave ovens, kettles, and light bulbs have a <strong>power rating</strong>. This rating tells you how much energy the appliance transfers (or uses) every second.</p>
                    <p>Power is the <strong>rate</strong> at which energy is transferred.</p>
                    <p>The unit of power is the <strong>Watt (W)</strong>. A higher wattage means more energy is transferred per second.</p>
                     <!-- Image: images/appliance_rating.jpg -->
                     <figure>
                        <img src="images/appliance_rating.jpg" alt="Appliance power rating label showing 2000 W" class="content-image">
                        <figcaption>This appliance has a power rating of 2000 W.</figcaption>
                    </figure>

                    <h4>Calculating Power</h4>
                    <p>You can calculate power if you know the energy transferred and the time taken:</p>
                    <p class="formula">Power (W) = Energy (J) / Time (s)</p>
                    <p>Where Energy is measured in <strong>Joules (J)</strong> and Time is measured in <strong>seconds (s)</strong>. A Watt is therefore equivalent to one Joule per second (J/s).</p>

                    <div class="worked-example">
                        <h4>Worked Example 1: Power Calculation</h4>
                        <p>A light bulb transfers 3000 Joules of energy in 60 seconds. What is its power rating?</p>
                        <p>Power = Energy / Time</p>
                        <p>Power = 3000 J / 60 s</p>
                        <p>Power = 50 W</p>
                        <p><strong>Answer:</strong> The power rating of the light bulb is 50 W.</p>
                    </div>

                    <div class="checkpoint" id="cp1">
                        <h4>Checkpoint 1: Kettle Power</h4>
                        <p>An electric kettle transfers 180,000 Joules of energy in 90 seconds. What is its power rating in Watts (W)?</p>
                        <label>Power = <input type="number" id="cp1-ans"> W</label>
                        <button class="check-button" data-question="cp1" data-correct="2000">Check</button>
                        <button class="hint-button" data-question="cp1">Hint</button>
                        <div class="hint-content hidden">Use the formula: Power (W) = Energy (J) / Time (s).</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                     <div class="checkpoint" id="cp2">
                        <h4>Checkpoint 2: Hairdryer Energy</h4>
                        <p>A hairdryer has a power rating of 1500 W. How much energy (in Joules) does it transfer in 2 minutes?</p>
                        <label>Energy = <input type="number" id="cp2-ans"> J</label>
                        <button class="check-button" data-question="cp2" data-correct="180000">Check</button>
                         <button class="hint-button" data-question="cp2">Hint</button>
                        <div class="hint-content hidden">First, convert the time to seconds (2 minutes = ? seconds). Then rearrange the power formula: Energy (J) = Power (W) × Time (s).</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                    <div class="checkpoint" id="cp3">
                        <h4>Checkpoint 3: Time Calculation</h4>
                        <p>A 60 W lamp transfers 3600 J of energy. How long was it switched on for, in seconds?</p>
                        <label>Time = <input type="number" id="cp3-ans"> s</label>
                        <button class="check-button" data-question="cp3" data-correct="60">Check</button>
                         <button class="hint-button" data-question="cp3">Hint</button>
                        <div class="hint-content hidden">Rearrange the power formula to find time: Time (s) = Energy (J) / Power (W).</div>
                        <div class="answer-feedback hidden"></div>
                    </div>
                </div>

                <!-- Tab Content: Units (kW, kJ) -->
                 <div id="tab-units" class="tab-content">
                    <h3>Bigger Units: Kilowatts and Kilojoules</h3>
                     <p>Watts (W) and Joules (J) are often quite small units for everyday appliances.</p>
                     <p>We frequently use prefixes like 'kilo' which means '1000'.</p>
                     <p class="formula">1 kilowatt (kW) = 1000 watts (W)</p>
                     <p class="formula">1 kilojoule (kJ) = 1000 joules (J)</p>
                     <p>To convert Watts to Kilowatts, you <strong>divide by 1000</strong>.</p>
                     <p>To convert Kilowatts to Watts, you <strong>multiply by 1000</strong>.</p>
                     <p>The same applies for Joules and Kilojoules.</p>

                    <div class="worked-example">
                        <h4>Worked Example 2: Unit Conversion</h4>
                        <p>a) Convert 2500 W to kW.</p>
                        <p>2500 W / 1000 = 2.5 kW</p>
                        <p>b) Convert 0.8 kW to W.</p>
                        <p>0.8 kW × 1000 = 800 W</p>
                        <p>c) Convert 150,000 J to kJ.</p>
                        <p>150,000 J / 1000 = 150 kJ</p>
                    </div>

                    <div class="checkpoint" id="cp4">
                        <h4>Checkpoint 4: W to kW</h4>
                        <p>Convert 120 W to kW.</p>
                        <label>Power = <input type="number" step="0.01" id="cp4-ans"> kW</label>
                        <button class="check-button" data-question="cp4" data-correct="0.12">Check</button>
                         <button class="hint-button" data-question="cp4">Hint</button>
                        <div class="hint-content hidden">To convert W to kW, divide by 1000.</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                     <div class="checkpoint" id="cp5">
                        <h4>Checkpoint 5: kW to W</h4>
                        <p>Convert 3.5 kW to W.</p>
                        <label>Power = <input type="number" id="cp5-ans"> W</label>
                        <button class="check-button" data-question="cp5" data-correct="3500">Check</button>
                         <button class="hint-button" data-question="cp5">Hint</button>
                        <div class="hint-content hidden">To convert kW to W, multiply by 1000.</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                    <div class="checkpoint" id="cp6">
                        <h4>Checkpoint 6: J to kJ</h4>
                        <p>An appliance uses 45,000 J of energy. How much is this in kJ?</p>
                        <label>Energy = <input type="number" id="cp6-ans"> kJ</label>
                        <button class="check-button" data-question="cp6" data-correct="45">Check</button>
                         <button class="hint-button" data-question="cp6">Hint</button>
                        <div class="hint-content hidden">To convert J to kJ, divide by 1000.</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                      <div class="checkpoint" id="cp7">
                        <h4>Checkpoint 7: Power in kW</h4>
                        <p>An oven transfers 6,000,000 J (6000 kJ) of energy in 30 minutes (1800 seconds). What is its power in kW?</p>
                        <p>(Calculate power in W first, then convert)</p>
                        <label>Power = <input type="number" step="0.01" id="cp7-ans"> kW</label>
                        <button class="check-button" data-question="cp7" data-correct="3.33">Check</button>
                        <button class="hint-button" data-question="cp7">Hint</button>
                        <div class="hint-content hidden">1. Find power in W: Power = Energy(J) / Time(s). <br> 2. Convert power from W to kW by dividing by 1000. (Watch for rounding if needed!)</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                </div>

                 <!-- Tab Content: Energy (kWh) -->
                 <div id="tab-kwh" class="tab-content">
                    <h3>The Kilowatt-Hour (kWh)</h3>
                    <p>Joules are too small for measuring household energy consumption over long periods. Electricity companies use a larger unit: the <strong>kilowatt-hour (kWh)</strong>.</p>
                    <p><strong>One kilowatt-hour (1 kWh) is the amount of energy transferred by a 1 kW appliance running for 1 hour.</strong></p>
                    <p>This is the 'unit' of energy you pay for on your electricity bill.</p>

                     <!-- Image: images/electricity_meter.jpg -->
                     <figure>
                        <img src="images/electricity_meter.jpg" alt="Electricity meter showing energy usage in kWh" class="content-image">
                        <figcaption>An electricity meter measures the total energy used in kilowatt-hours (kWh).</figcaption>
                    </figure>

                    <h4>Calculating Energy in kWh</h4>
                     <p>You can calculate the energy used in kWh using this formula:</p>
                    <p class="formula">Energy (kWh) = Power (kW) × Time (hours)</p>
                    <p><strong>Important:</strong> For this formula:</p>
                    <ul>
                        <li>Power *must* be in <strong>kilowatts (kW)</strong>.</li>
                        <li>Time *must* be in <strong>hours (h)</strong>.</li>
                    </ul>
                    <p>You might need to convert units first!</p>
                    <ul>
                        <li>Watts to Kilowatts: Divide by 1000</li>
                        <li>Minutes to Hours: Divide by 60</li>
                    </ul>

                    <div class="worked-example">
                        <h4>Worked Example 3: Energy Calculation in kWh</h4>
                        <p>A 150 W television is left on for 4 hours. How much energy does it use in kWh?</p>
                        <p>1. Convert Power to kW: 150 W / 1000 = 0.15 kW</p>
                        <p>2. Time is already in hours: 4 h</p>
                        <p>3. Use the formula: Energy (kWh) = Power (kW) × Time (h)</p>
                        <p>Energy = 0.15 kW × 4 h = 0.6 kWh</p>
                        <p><strong>Answer:</strong> The television uses 0.6 kWh of energy.</p>
                    </div>

                     <div class="worked-example">
                        <h4>Worked Example 4: Energy Calculation with Time Conversion</h4>
                        <p>A 2000 W hair dryer is used for 15 minutes. How much energy does it use in kWh?</p>
                        <p>1. Convert Power to kW: 2000 W / 1000 = 2 kW</p>
                        <p>2. Convert Time to hours: 15 minutes / 60 = 0.25 h</p>
                        <p>3. Use the formula: Energy (kWh) = Power (kW) × Time (h)</p>
                        <p>Energy = 2 kW × 0.25 h = 0.5 kWh</p>
                        <p><strong>Answer:</strong> The hair dryer uses 0.5 kWh of energy.</p>
                    </div>

                    <div class="checkpoint" id="cp8">
                        <h4>Checkpoint 8: Heater Energy</h4>
                        <p>A 3 kW electric heater is used for 5 hours. How much energy does it use in kWh?</p>
                        <label>Energy = <input type="number" id="cp8-ans"> kWh</label>
                        <button class="check-button" data-question="cp8" data-correct="15">Check</button>
                         <button class="hint-button" data-question="cp8">Hint</button>
                        <div class="hint-content hidden">Use Energy (kWh) = Power (kW) × Time (h). Units are already correct.</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                    <div class="checkpoint" id="cp9">
                        <h4>Checkpoint 9: Laptop Energy (W to kW)</h4>
                        <p>A laptop charger uses 50 W of power. If it's used for 6 hours, how much energy does it consume in kWh?</p>
                         <label>Energy = <input type="number" step="0.01" id="cp9-ans"> kWh</label>
                        <button class="check-button" data-question="cp9" data-correct="0.3">Check</button>
                         <button class="hint-button" data-question="cp9">Hint</button>
                        <div class="hint-content hidden">1. Convert Power from W to kW (divide by 1000). <br> 2. Use Energy (kWh) = Power (kW) × Time (h).</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                     <div class="checkpoint" id="cp10">
                        <h4>Checkpoint 10: Microwave Energy (Minutes to Hours)</h4>
                        <p>A 900 W microwave oven is used for 10 minutes. How much energy does it use in kWh?</p>
                         <label>Energy = <input type="number" step="0.01" id="cp10-ans"> kWh</label>
                        <button class="check-button" data-question="cp10" data-correct="0.15">Check</button>
                         <button class="hint-button" data-question="cp10">Hint</button>
                        <div class="hint-content hidden">1. Convert Power from W to kW. <br> 2. Convert Time from minutes to hours (divide by 60). <br> 3. Use Energy (kWh) = Power (kW) × Time (h).</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                </div>

                <!-- Tab Content: Calculating Cost -->
                 <div id="tab-cost" class="tab-content">
                    <h3>What Are You Paying For? Calculating Cost</h3>
                    <p>When you pay your electricity bill, you are paying for the amount of <strong>energy</strong> you have used, measured in kilowatt-hours (kWh). The electricity company charges a certain price for each kWh (unit) consumed. This price is often given in pence (p).</p>

                    <h4>The Cost Formula</h4>
                    <p>To calculate the cost of using an appliance, you need to know:</p>
                    <ol>
                        <li>The energy used in kWh (which depends on Power in kW and Time in hours).</li>
                        <li>The price of electricity per kWh.</li>
                    </ol>
                    <p class="formula">Cost = Energy used (kWh) × Price (per kWh)</p>
                    <p>Combining with the energy formula, you get:</p>
                    <p class="formula">Cost = Power (kW) × Time (hours) × Price (per kWh)</p>
                     <p>The cost will be in the same unit as the price (e.g., if price is in pence, cost is in pence).</p>

                    <div class="worked-example">
                        <h4>Worked Example 5: Calculating Cost</h4>
                        <p>Suppose you use a 2.5 kW oven for 2 hours. Each kWh costs 10p.</p>
                        <p><strong>Method 1: Calculate Energy First</strong></p>
                        <p>1. Energy = Power (kW) × Time (h) = 2.5 kW × 2 h = 5 kWh</p>
                        <p>2. Cost = Energy (kWh) × Price (p/kWh) = 5 kWh × 10 p/kWh = 50p</p>
                        <p><strong>Method 2: Combined Formula</strong></p>
                        <p>Cost = Power (kW) × Time (h) × Price (p/kWh)</p>
                        <p>Cost = 2.5 kW × 2 h × 10 p/kWh = 50p</p>
                        <p><strong>Answer:</strong> It costs 50p to use the oven for 2 hours.</p>
                    </div>

                    <div class="guided-practice" id="gp1">
                        <h4>Guided Practice 1: Shower Cost</h4>
                        <p>A powerful electric shower has a power rating of 10 kW. Electricity costs 20p per kWh.</p>
                        <p>a) How much energy (in kWh) does it use in 15 minutes?</p>
                         <label>Energy = <input type="number" step="0.1" id="gp1a-ans"> kWh</label>
                        <button class="check-button" data-question="gp1a" data-correct="2.5">Check (a)</button>
                        <button class="hint-button" data-question="gp1a">Hint (a)</button>
                        <div class="hint-content hidden">Convert 15 minutes to hours (15/60 = 0.25 h). Use Energy = Power (kW) x Time (h).</div>
                        <div class="answer-feedback hidden"></div>

                        <p>b) How much does it cost to use the shower for 15 minutes?</p>
                        <label>Cost = <input type="number" id="gp1b-ans"> p</label>
                        <button class="check-button" data-question="gp1b" data-correct="50">Check (b)</button>
                        <button class="hint-button" data-question="gp1b">Hint (b)</button>
                        <div class="hint-content hidden">Use Cost = Energy (kWh) x Price (p/kWh). Use your answer from part (a).</div>
                        <div class="answer-feedback hidden"></div>

                        <p>c) If a family uses the shower for a total of 45 minutes per day, what is the daily cost?</p>
                        <label>Daily Cost = <input type="number" id="gp1c-ans"> p</label>
                        <button class="check-button" data-question="gp1c" data-correct="150">Check (c)</button>
                         <button class="hint-button" data-question="gp1c">Hint (c)</button>
                        <div class="hint-content hidden">1. Find daily time in hours (45/60 = 0.75 h). <br> 2. Find daily energy: Energy = 10 kW x 0.75 h. <br> 3. Find daily cost: Cost = Daily Energy x 20 p/kWh. (Alternatively, notice 45 mins is 3 x 15 mins, so cost is 3 x answer b).</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                     <div class="checkpoint" id="cp11">
                        <h4>Checkpoint 11: TV Cost (W, hours)</h4>
                        <p>A 100 W TV is watched for 5 hours. Electricity costs 18p per kWh. Calculate the cost in pence.</p>
                         <label>Cost = <input type="number" step="0.1" id="cp11-ans"> p</label>
                        <button class="check-button" data-question="cp11" data-correct="9">Check</button>
                         <button class="hint-button" data-question="cp11">Hint</button>
                        <div class="hint-content hidden">1. Convert power to kW (100 W = ? kW). <br> 2. Use Cost = Power (kW) × Time (h) × Price (p/kWh).</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                     <div class="checkpoint" id="cp12">
                        <h4>Checkpoint 12: Games Console Cost (W, minutes)</h4>
                        <p>A games console uses 150 W. It's played for 90 minutes. Electricity costs 22p per kWh. Calculate the cost in pence.</p>
                         <label>Cost = <input type="number" step="0.01" id="cp12-ans"> p</label>
                        <button class="check-button" data-question="cp12" data-correct="4.95">Check</button>
                         <button class="hint-button" data-question="cp12">Hint</button>
                        <div class="hint-content hidden">1. Convert power to kW (150 W = ? kW). <br> 2. Convert time to hours (90 mins = ? h). <br> 3. Use Cost = Power (kW) × Time (h) × Price (p/kWh).</div>
                        <div class="answer-feedback hidden"></div>
                    </div>

                </div>

                <!-- Tab Content: Saving Energy -->
                 <div id="tab-saving" class="tab-content">
                    <h3>Saving Energy (and Money!)</h3>
                    <p>Understanding power and energy helps you make choices to reduce your electricity bills and help the environment by using less energy, which often comes from burning fossil fuels.</p>
                    <p>Ways to save energy relate directly to the cost formula: Cost = <strong>Power (kW)</strong> × <strong>Time (hours)</strong> × Price (per kWh)</p>
                    <p>You can save money by reducing the <strong>Power</strong> or the <strong>Time</strong>.</p>
                    <ul>
                        <li><strong>Use lower power appliances:</strong> Choose appliances with a lower Wattage (or higher energy efficiency rating) for the same job. Modern LED light bulbs are a great example.</li>
                         <!-- Image: images/bulb_comparison.jpg -->
                         <figure>
                            <img src="images/bulb_comparison.jpg" alt="Comparison of light bulbs showing different power usage for similar brightness" class="content-image">
                            <figcaption>The bulb on the right is just as bright but uses much less power (10 W vs 61 W).</figcaption>
                        </figure>
                        <li><strong>Use appliances for less time:</strong> Turn things off when not needed! Shorter showers, turning off lights, not leaving devices on standby.</li>
                        <li><strong>Improve Insulation:</strong> This doesn't reduce appliance power, but it reduces the *time* your heating needs to be on to maintain temperature. Good insulation (loft, walls, windows) slows down heat transfer to the surroundings.</li>
                         <!-- Image: images/thermal_house.jpg -->
                         <figure>
                            <img src="images/thermal_house.jpg" alt="Thermal image of houses showing heat loss" class="content-image">
                            <figcaption>This thermal image shows areas of heat loss (brighter colours) from houses. Better insulation reduces this.</figcaption>
                        </figure>
                    </ul>

                     <div class="checkpoint" id="cp13">
                        <h4>Checkpoint 13: Bulb Savings</h4>
                        <p>A room has one 60 W incandescent bulb, used for 4 hours a day. It's replaced with a 10 W LED bulb providing the same light.</p>
                        <p>a) How much energy (in kWh) does the 60 W bulb use per day?</p>
                        <label>Energy (60W) = <input type="number" step="0.01" id="cp13a-ans"> kWh</label>
                        <button class="check-button" data-question="cp13a" data-correct="0.24">Check (a)</button>
                        <div class="answer-feedback hidden"></div>

                        <p>b) How much energy (in kWh) does the 10 W bulb use per day?</p>
                         <label>Energy (10W) = <input type="number" step="0.01" id="cp13b-ans"> kWh</label>
                        <button class="check-button" data-question="cp13b" data-correct="0.04">Check (b)</button>
                         <div class="answer-feedback hidden"></div>

                        <p>c) If electricity costs 25p per kWh, how much money is saved per day by using the LED bulb?</p>
                         <label>Saving = <input type="number" step="0.1" id="cp13c-ans"> p</label>
                        <button class="check-button" data-question="cp13c" data-correct="5">Check (c)</button>
                         <button class="hint-button" data-question="cp13c">Hint (c)</button>
                        <div class="hint-content hidden">1. Find the energy saved per day (answer a - answer b). <br> 2. Calculate the cost saving: Saving = Energy Saved (kWh) x Price (p/kWh).</div>
                        <div class="answer-feedback hidden"></div>
                    </div>
                </div>

                 <div class="key-words">
                    <h4>Key Words</h4>
                    <span>Watt (W)</span> <span>Power</span> <span>Kilowatt (kW)</span>
                    <span>Joule (J)</span> <span>Energy</span> <span>Kilojoule (kJ)</span>
                    <span>Kilowatt-hour (kWh)</span> <span>Rate</span> <span>Cost</span>
                    <span>Unit</span> <span>Efficiency</span> <span>Insulation</span>
                </div>

            </section>

            <!-- Practice Section -->
            <section id="practice-section" class="content-section">
                <h2>Practice Questions</h2>
                <p>Test your understanding. Use the calculator if needed. Check your answers as you go or at the end.</p>

                 <div class="practice-question" id="pq1">
                    <h4>Question 1: Definitions</h4>
                    <p>a) What is power? <input type="text" id="pq1a-ans" size="30"></p>
                    <p>b) What is the standard unit of power? <input type="text" id="pq1b-ans" size="10"></p>
                    <p>c) What unit do electricity companies use to measure energy? <input type="text" id="pq1c-ans" size="15"></p>
                    <button class="check-button" onclick="checkPracticeQuestion('pq1')">Check Q1</button>
                     <button class="hint-button" data-question="pq1">Hint Q1</button>
                     <div class="hint-content hidden">a) Think about speed/rate. b) Symbol W. c) Symbol kWh.</div>
                    <div class="answer-feedback hidden"></div>
                 </div>

                 <div class="practice-question" id="pq2">
                    <h4>Question 2: Conversions</h4>
                    <p>a) Convert 3800 W to kW: <input type="number" step="0.1" id="pq2a-ans"> kW</p>
                    <p>b) Convert 0.05 kW to W: <input type="number" id="pq2b-ans"> W</p>
                    <p>c) Convert 120 minutes to hours: <input type="number" id="pq2c-ans"> h</p>
                     <p>d) Convert 45 minutes to hours: <input type="number" step="0.01" id="pq2d-ans"> h</p>
                    <button class="check-button" onclick="checkPracticeQuestion('pq2')">Check Q2</button>
                    <button class="hint-button" data-question="pq2">Hint Q2</button>
                     <div class="hint-content hidden">a) W to kW: /1000. b) kW to W: *1000. c/d) mins to hours: /60.</div>
                    <div class="answer-feedback hidden"></div>
                 </div>

                 <div class="practice-question" id="pq3">
                    <h4>Question 3: Energy Calculation (kWh)</h4>
                    <p>A 1.8 kW kettle takes 5 minutes to boil. How much energy does it use in kWh?</p>
                     <label>Energy = <input type="number" step="0.01" id="pq3-ans"> kWh</label>
                    <button class="check-button" onclick="checkPracticeQuestion('pq3')">Check Q3</button>
                    <button class="hint-button" data-question="pq3">Hint Q3</button>
                    <div class="hint-content hidden">1. Ensure power is in kW (it is). 2. Convert time to hours (5 / 60 = ?). 3. Use Energy = Power x Time.</div>
                    <div class="answer-feedback hidden"></div>
                 </div>

                 <div class="practice-question" id="pq4">
                    <h4>Question 4: Cost Calculation</h4>
                    <p>Using the kettle from Q3 (1.8 kW, 5 minutes use), calculate the cost if electricity is 30p per kWh.</p>
                     <label>Cost = <input type="number" step="0.01" id="pq4-ans"> p</label>
                    <button class="check-button" onclick="checkPracticeQuestion('pq4')">Check Q4</button>
                     <button class="hint-button" data-question="pq4">Hint Q4</button>
                    <div class="hint-content hidden">Use the energy calculated in Q3. Cost = Energy (kWh) x Price (p/kWh).</div>
                    <div class="answer-feedback hidden"></div>
                 </div>

                <div class="practice-question" id="pq5">
                    <h4>Question 5: Comparing Costs</h4>
                    <p>Device A: 1200 W used for 30 minutes.</p>
                    <p>Device B: 80 W used for 4 hours.</p>
                    <p>Electricity costs 20p per kWh.</p>
                    <p>a) Calculate the cost of using Device A: <input type="number" step="0.1" id="pq5a-ans"> p</p>
                    <p>b) Calculate the cost of using Device B: <input type="number" step="0.1" id="pq5b-ans"> p</p>
                     <p>c) Which device cost more to run for its specified time? Device <input type="text" id="pq5c-ans" size="3"></p>
                    <button class="check-button" onclick="checkPracticeQuestion('pq5')">Check Q5</button>
                    <button class="hint-button" data-question="pq5">Hint Q5</button>
                    <div class="hint-content hidden">Calculate cost for each device separately. Remember unit conversions! <br> Device A: 1.2 kW, 0.5 h. <br> Device B: 0.08 kW, 4 h.</div>
                    <div class="answer-feedback hidden"></div>
                </div>

                 <div class="practice-question" id="pq6">
                    <h4>Question 6: Energy Saving</h4>
                    <p>Suggest two different ways a household could reduce their electricity bill, based on the physics concepts learned.</p>
                    <textarea id="pq6-ans" rows="3" placeholder="1. Use appliances that...
2. Use appliances for..."></textarea>
                    <button class="check-button" onclick="checkPracticeQuestion('pq6')">Check Q6</button>
                     <!-- No specific correct answer, just check if reasonable suggestions -->
                    <div class="answer-feedback hidden"></div>
                </div>

                <hr style="margin: 30px 0;">
                <button class="practice-submit-button" id="check-all-practice-btn">Check All Practice Questions</button>
                <div id="practice-results" style="margin-top: 20px;"></div>

            </section>

            <!-- Game Section -->
            <section id="game-section" class="content-section">
                 <h2>Game: Power Quiz Challenge!</h2>
                <p>Test your knowledge through multiple levels! Answer questions as quickly as you can.</p>
                <div class="game-area">
                    <div id="game-intro">
                        <button class="game-button" id="start-game-btn">Start Game</button>
                    </div>
                    <div id="game-play" class="hidden">
                        <div> <!-- Header Div for Timer, Score, Level -->
                            Time Left: <span id="game-timer">75</span>s | Score: <span id="game-score">0</span>
                            <!-- Level span will be added here by JS -->
                        </div>
                        <div id="game-question" style="margin-top: 15px;">Question appears here...</div>
                        <div class="game-options">
                            <button class="game-button option" id="optionA"></button>
                            <button class="game-button option" id="optionB"></button>
                            <button class="game-button option" id="optionC"></button>
                            <button class="game-button option" id="optionD"></button>
                        </div>
                        <div id="game-feedback"></div>
                    </div>
                    <div id="game-over" class="hidden text-center">
                        <h3>Game Over!</h3> <!-- Message updated by JS -->
                        <p>Your final score: <strong id="final-score">0</strong></p>
                        <button class="game-button" id="restart-game-btn">Play Again</button>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        // --- Global Elements ---
        const contentArea = document.getElementById('content-area');
        const calculator = document.getElementById('calculator');
        const equationsPanel = document.getElementById('equations-panel');
        const calcDisplay = document.getElementById('calcDisplay');

        // --- Main Navigation ---
        const mainNavButtons = document.querySelectorAll('.main-nav button');
        const contentSections = document.querySelectorAll('.content-section');
        mainNavButtons.forEach(button => {
            button.addEventListener('click', () => {
                mainNavButtons.forEach(btn => btn.classList.remove('active'));
                contentSections.forEach(section => section.classList.remove('active'));
                button.classList.add('active');
                const sectionId = button.id.replace('nav-', '') + '-section';
                document.getElementById(sectionId)?.classList.add('active');
            });
        });

        // --- Tutorial Tab Navigation ---
        const tutorialTabsContainer = document.querySelector('.tutorial-tabs');
        if (tutorialTabsContainer) {
            const tutorialTabLinks = tutorialTabsContainer.querySelectorAll('.tab-link');
            const tutorialTabContents = contentArea.querySelectorAll('#tutorial-section .tab-content');
            tutorialTabLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const targetTab = link.getAttribute('data-tab');
                    tutorialTabLinks.forEach(l => l.classList.remove('active'));
                    tutorialTabContents.forEach(c => c.classList.remove('active')); // Hide all first
                    link.classList.add('active');
                    document.getElementById(targetTab)?.classList.add('active'); // Show target
                });
            });
        }

        // --- Hints ---
        contentArea.addEventListener('click', function(event) {
            if (event.target.classList.contains('hint-button')) {
                const questionId = event.target.getAttribute('data-question');
                const hintDiv = event.target.closest('.checkpoint, .guided-practice, .practice-question')?.querySelector(`.hint-content`);
                if (hintDiv) {
                    hintDiv.classList.toggle('hidden');
                    event.target.textContent = hintDiv.classList.contains('hidden') ? 'Show Hint' : 'Hide Hint';
                }
            }
        });


        // --- Checkpoint & Guided Practice Checking ---
         contentArea.addEventListener('click', function(event) {
            if (event.target.classList.contains('check-button') && !event.target.hasAttribute('onclick')) { // Avoid conflict with practice section buttons
                const button = event.target;
                 const container = button.closest('.checkpoint, .guided-practice'); // Ensure it's CP or GP
                 if (!container) return;

                const questionId = button.getAttribute('data-question');
                const correctAnswer = button.getAttribute('data-correct');
                const inputElement = container.querySelector(`#${questionId}-ans`);
                const feedbackDiv = container.querySelector('.answer-feedback');

                if (!inputElement || !feedbackDiv) return;

                const userAnswer = inputElement.value.trim();
                let isCorrect = false;

                 if (userAnswer !== "" && correctAnswer !== null && !isNaN(userAnswer) && !isNaN(correctAnswer)) {
                    // Use tolerance for floating point numbers
                    isCorrect = Math.abs(parseFloat(userAnswer) - parseFloat(correctAnswer)) < 0.01;
                } else if (typeof correctAnswer === 'string') {
                    // Case-insensitive string comparison
                     isCorrect = userAnswer.toLowerCase() === correctAnswer.toLowerCase();
                }


                feedbackDiv.classList.remove('hidden', 'correct', 'incorrect');
                if (isCorrect) {
                    feedbackDiv.textContent = 'Correct!';
                    feedbackDiv.classList.add('correct');
                    inputElement.style.backgroundColor = '#d4edda';
                } else {
                    feedbackDiv.textContent = `Incorrect. Check calculation/units. Expected: ${correctAnswer}`;
                    feedbackDiv.classList.add('incorrect');
                    inputElement.style.backgroundColor = '#f8d7da';
                }
            }
        });


        // --- Practice Question Checking Logic ---
         const practiceQuestionData = {
             pq1: { a: "the rate at which energy is transferred", b: "watt", c: "kilowatt-hour" },
             pq2: { a: "3.8", b: "50", c: "2", d: "0.75" },
             pq3: { ans: "0.15" }, // 1.8 * (5/60)
             pq4: { ans: "4.5" }, // 0.15 * 30
             pq5: { a: "12", b: "6.4", c: "a"}, // A: 1.2*0.5*20=12. B: 0.08*4*20=6.4
             pq6: { ans: "subjective" } // Check for reasonable input
         };

         function checkPracticeQuestion(questionId) {
            const questionDiv = document.getElementById(questionId);
             if (!questionDiv) return; // Exit if question div not found
            const feedbackDiv = questionDiv.querySelector('.answer-feedback');
            const data = practiceQuestionData[questionId];
            let allPartsCorrect = true;
             let hasSubjective = false;

            if (!feedbackDiv || !data) return; // Exit if feedback or data missing

            feedbackDiv.innerHTML = ''; // Clear previous feedback
            feedbackDiv.classList.remove('hidden', 'correct', 'incorrect');

            for (const part in data) {
                const input = questionDiv.querySelector(`#${questionId}${part}-ans`);
                const correctAnswer = data[part];

                if (correctAnswer === "subjective") {
                    hasSubjective = true;
                    const userAnswer = input ? input.value.trim() : '';
                    if (userAnswer.length < 10) { // Basic check for some content
                         allPartsCorrect = false;
                         feedbackDiv.innerHTML += ` Part (${part}): Please provide a more detailed answer.`;
                         if(input) input.style.backgroundColor = '#f8d7da';
                    } else {
                         // For subjective, just acknowledge input without marking strictly correct/incorrect
                         feedbackDiv.innerHTML += ` Part (${part}): Answer noted.`;
                         if(input) input.style.backgroundColor = '#e2e6ea'; // Neutral background
                    }
                    continue; // Move to next part
                }

                 if (!input) continue; // Skip if input not found for objective parts

                // Normalize both user answer and correct answer for comparison
                const userAnswer = input.value.trim().toLowerCase().replace(/[^a-z0-9.-]/g, '');
                const correctNorm = String(correctAnswer).toLowerCase().replace(/[^a-z0-9.-]/g, '');


                let isPartCorrect = false;
                 // Check if both are valid numbers for numeric comparison
                 if (userAnswer !== "" && correctNorm !== "" && !isNaN(userAnswer) && !isNaN(correctNorm)) {
                    isPartCorrect = Math.abs(parseFloat(userAnswer) - parseFloat(correctNorm)) < 0.01;
                } else {
                     // Otherwise, perform string comparison
                     isPartCorrect = userAnswer === correctNorm;
                }


                if (!isPartCorrect) {
                    allPartsCorrect = false;
                    feedbackDiv.innerHTML += ` Part (${part}) incorrect (Expected '${correctAnswer}').`;
                    input.style.backgroundColor = '#f8d7da';
                } else {
                     input.style.backgroundColor = '#d4edda';
                }
            }

             feedbackDiv.classList.remove('hidden'); // Ensure feedback is visible
            if (allPartsCorrect && !hasSubjective) {
                 feedbackDiv.innerHTML = 'Correct!';
                 feedbackDiv.classList.add('correct');
            } else if (!allPartsCorrect) {
                 feedbackDiv.classList.add('incorrect'); // Add main incorrect class if any part failed
            } else if (allPartsCorrect && hasSubjective) {
                // All objective parts correct, subjective part noted
                feedbackDiv.classList.add('correct'); // Still mark overall as checked/correct context
            }
         }

         const checkAllPracticeBtn = document.getElementById('check-all-practice-btn');
         if(checkAllPracticeBtn) {
             checkAllPracticeBtn.addEventListener('click', () => {
                Object.keys(practiceQuestionData).forEach(id => checkPracticeQuestion(id));
                 // Optionally provide summary feedback
                 const practiceResultsDiv = document.getElementById('practice-results');
                 if (practiceResultsDiv) practiceResultsDiv.textContent = "All questions checked. Review feedback above.";
            });
         }


        // --- Calculator Logic ---
        let calcCurrentInput = '0';
        let calcOperator = null;
        let calcPreviousInput = null;
        let resetDisplay = false;

        function calcInput(value) {
            if (!calcDisplay) return;
            if (calcDisplay.textContent === 'Error') calcClear();
            if (resetDisplay) {
                calcDisplay.textContent = '';
                resetDisplay = false;
            }

            if (calcDisplay.textContent === '0' && value !== '.') {
                calcDisplay.textContent = value;
            } else {
                if (value === '.' && calcDisplay.textContent.includes('.')) return;
                // Limit display length to prevent overflow (optional)
                if (calcDisplay.textContent.length < 16) {
                    calcDisplay.textContent += value;
                }
            }
        }

        function calcClear() {
             if (!calcDisplay) return;
            calcDisplay.textContent = '0';
            calcCurrentInput = '0';
            calcOperator = null;
            calcPreviousInput = null;
            resetDisplay = false;
        }

        function calcBackspace() {
             if (!calcDisplay) return;
             if (calcDisplay.textContent === 'Error') calcClear();
             if (resetDisplay) return;
             if (calcDisplay.textContent.length > 1) {
                 calcDisplay.textContent = calcDisplay.textContent.slice(0, -1);
             } else {
                 calcDisplay.textContent = '0';
             }
        }

        function calcEquals() {
             if (!calcDisplay) return;
             if (calcDisplay.textContent === 'Error') return;
             try {
                 // Basic sanitization - better than nothing, but still relies on eval's risks
                 const expression = calcDisplay.textContent.replace(/[^-()\d/*+.]/g, '');
                 if (!expression) { calcDisplay.textContent = '0'; return; } // Handle empty after sanitize

                 let result = eval(expression);
                 // Handle potential floating point issues and NaN/Infinity
                 if (isNaN(result) || !isFinite(result)) {
                     calcDisplay.textContent = 'Error';
                 } else {
                     result = parseFloat(result.toFixed(10)); // Limit precision
                     calcDisplay.textContent = String(result).slice(0, 16); // Limit display length
                 }
                 resetDisplay = true;
                 calcOperator = null;
                 calcPreviousInput = null;
             } catch (e) {
                 calcDisplay.textContent = 'Error';
             }
        }


        // --- Calculator UI & Dragging ---
        const toggleCalcButton = document.getElementById('toggle-calculator');
        const calcMinimizeButton = document.querySelector('.calc-minimize-btn');
        const calcHeader = document.querySelector('.calc-header');
        let isDragging = false;
        let offsetX, offsetY;

        if(toggleCalcButton && calculator) {
            toggleCalcButton.addEventListener('click', () => {
                calculator.classList.toggle('hidden');
                if (!calculator.classList.contains('hidden')) {
                    calculator.classList.remove('minimized');
                }
            });
        }

        if(calcMinimizeButton && calculator) {
            calcMinimizeButton.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent header drag start
                calculator.classList.toggle('minimized');
            });
        }

         if(calcHeader && calculator) {
             calcHeader.addEventListener('click', () => {
                 if (calculator.classList.contains('minimized')) {
                      calculator.classList.remove('minimized');
                 }
             });
            calcHeader.addEventListener('mousedown', (e) => {
                if (calculator.classList.contains('minimized')) return;
                isDragging = true;
                offsetX = e.clientX - calculator.offsetLeft;
                offsetY = e.clientY - calculator.offsetTop;
                calculator.style.cursor = 'grabbing';
                e.preventDefault(); // Prevent text selection
            });
         }

        document.addEventListener('mousemove', (e) => {
            if (!isDragging || !calculator) return;
            let newX = e.clientX - offsetX;
            let newY = e.clientY - offsetY;

            // Boundary checks
            const maxX = window.innerWidth - calculator.offsetWidth;
            const maxY = window.innerHeight - calculator.offsetHeight;
            newX = Math.max(0, Math.min(newX, maxX < 0 ? 0 : maxX)); // Handle small screens
            newY = Math.max(0, Math.min(newY, maxY < 0 ? 0 : maxY));

            calculator.style.left = `${newX}px`;
            calculator.style.top = `${newY}px`;
            calculator.style.bottom = 'auto'; // Override CSS position if dragged
            calculator.style.right = 'auto';
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                if(calculator) calculator.style.cursor = 'grab';
            }
        });

        // --- Equations Panel ---
         const toggleEquationsButton = document.getElementById('toggle-equations');
         const closeEquationsButton = document.querySelector('.equations-close-btn');

         if(toggleEquationsButton && equationsPanel) {
             toggleEquationsButton.addEventListener('click', () => {
                 equationsPanel.classList.toggle('hidden');
             });
         }
         if(closeEquationsButton && equationsPanel) {
             closeEquationsButton.addEventListener('click', () => {
                  equationsPanel.classList.add('hidden');
             });
         }


        // --- Multi-Level Game Logic ---

        const gameLevels = [
            // Level 1: Basic Definitions & Conversions
            [
                { q: "What is the standard unit of Power?", o: ["Joule (J)", "Kilowatt-hour (kWh)", "Watt (W)", "Volt (V)"], a: "Watt (W)" },
                { q: "1 Kilowatt (kW) is equal to how many Watts (W)?", o: ["10 W", "100 W", "1000 W", "0.1 W"], a: "1000 W" },
                { q: "What quantity does 'kWh' measure?", o: ["Power", "Time", "Energy", "Cost"], a: "Energy" },
                { q: "Convert 2500 W to kW.", o: ["2.5 kW", "25 kW", "0.25 kW", "250 kW"], a: "2.5 kW" },
                { q: "Power is the _____ at which energy is transferred.", o: ["amount", "rate", "cost", "unit"], a: "rate" }
            ],
            // Level 2: Simple Calculations (kWh, Cost)
            [
                { q: "A 2 kW heater runs for 3 hours. Energy used?", o: ["2 kWh", "3 kWh", "5 kWh", "6 kWh"], a: "6 kWh" },
                { q: "A 50 W lamp is on for 10 hours. Energy used?", o: ["0.05 kWh", "0.5 kWh", "5 kWh", "500 kWh"], a: "0.5 kWh" },
                { q: "Time = 30 minutes. Convert to hours:", o: ["0.3 h", "0.5 h", "30 h", "1/2 h"], a: "0.5 h" },
                { q: "If 1 kWh costs 10p, what is the cost of using 5 kWh?", o: ["5p", "10p", "50p", "£5"], a: "50p" },
                { q: "Energy (kWh) = Power (kW) x _____", o: ["Cost (p/kWh)", "Time (hours)", "Time (seconds)", "Joules"], a: "Time (hours)" }
            ],
            // Level 3: Multi-step Calculations & Concepts
            [
                { q: "A 1500 W kettle is used for 6 minutes. Energy used in kWh?", o: ["0.15 kWh", "1.5 kWh", "9 kWh", "90 kWh"], a: "0.15 kWh" }, // 1.5kW * (6/60)h
                { q: "Device uses 0.4 kWh. Cost at 20p/kWh?", o: ["4p", "8p", "20p", "40p"], a: "8p" }, // 0.4 * 20
                { q: "Which saves more energy? A) Using 100W bulb for 1hr B) Using 50W bulb for 3hrs", o: ["A", "B", "Same", "Not enough info"], a: "A" }, // A=0.1kWh, B=0.15kWh
                { q: "Cost = Power (kW) x Time (h) x _____", o: ["Energy (kWh)", "Price (p/kWh)", "Time (s)", "Joules"], a: "Price (p/kWh)" },
                { q: "To reduce electricity cost, you should use appliances with ____ power for ____ time.", o: ["higher, less", "lower, less", "lower, more", "higher, more"], a: "lower, less" }
            ]
        ];

        const startGameBtn = document.getElementById('start-game-btn');
        const restartGameBtn = document.getElementById('restart-game-btn');
        const gameIntroDiv = document.getElementById('game-intro');
        const gamePlayDiv = document.getElementById('game-play');
        const gameOverDiv = document.getElementById('game-over');
        const gameTimerSpan = document.getElementById('game-timer');
        const gameScoreSpan = document.getElementById('game-score');
        const gameLevelSpan = document.createElement('span'); // Create span for level display
              gameLevelSpan.id = 'game-level';
        const gamePlayHeader = gamePlayDiv?.querySelector('div:first-child'); // Get the first div inside game-play
              if (gamePlayHeader) gamePlayHeader.appendChild(gameLevelSpan); // Add level display

        const gameQuestionDiv = document.getElementById('game-question');
        const gameOptionBtns = document.querySelectorAll('.game-options button');
        const gameFeedbackDiv = document.getElementById('game-feedback');
        const finalScoreSpan = document.getElementById('final-score');
        const gameOverMessage = gameOverDiv?.querySelector('h3'); // Get h3 for custom message

        let currentLevelIndex = 0;
        let currentQuestionIndex = 0; // Question index *within* the current level
        let score = 0;
        let timer = 75; // Adjust as needed for total questions
        let timerInterval;
        let gameActive = false;

        function startGame() {
            currentLevelIndex = 0;
            currentQuestionIndex = 0;
            score = 0;
            timer = 75; // Reset timer
            gameActive = true;
            gameIntroDiv?.classList.add('hidden');
            gameOverDiv?.classList.add('hidden');
            gamePlayDiv?.classList.remove('hidden');
            if(gameScoreSpan) gameScoreSpan.textContent = score;
            if(gameTimerSpan) gameTimerSpan.textContent = timer;
            if(gameFeedbackDiv) gameFeedbackDiv.textContent = '';
            loadLevel(); // Start by loading the first level
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!gameActive) {
                    clearInterval(timerInterval);
                    return;
                }
                timer--;
                if(gameTimerSpan) gameTimerSpan.textContent = timer;
                if (timer <= 0) {
                    endGame(false); // Ran out of time
                }
            }, 1000);
        }

        function loadLevel() {
             if (!gameActive) return;

            if (currentLevelIndex >= gameLevels.length) {
                endGame(true); // Completed all levels
                return;
            }
            currentQuestionIndex = 0; // Reset question index for the new level
            if(gameLevelSpan) gameLevelSpan.textContent = `| Level: ${currentLevelIndex + 1}`; // Update UI
            loadQuestion();
        }

        function loadQuestion() {
             if (!gameActive || currentLevelIndex >= gameLevels.length || !gameQuestionDiv || gameOptionBtns.length < 4) return; // Safety checks

            const currentLevelQuestions = gameLevels[currentLevelIndex];
            if (currentQuestionIndex >= currentLevelQuestions.length) {
                currentLevelIndex++; // Level complete, move to next level index
                loadLevel(); // Attempt to load the next level
                return;
            }

            const qData = currentLevelQuestions[currentQuestionIndex];
            gameQuestionDiv.textContent = `Q${currentQuestionIndex + 1}: ${qData.q}`;
            // Assign options safely
            for(let i=0; i < 4; i++) {
                if(gameOptionBtns[i]) gameOptionBtns[i].textContent = qData.o[i] || ''; // Assign option or empty string
            }
            gameOptionBtns.forEach(btn => { btn.disabled = false; btn.style.backgroundColor = ''; });
            if(gameFeedbackDiv) gameFeedbackDiv.textContent = '';
        }

        function selectAnswer(event) {
             if (!gameActive || currentLevelIndex >= gameLevels.length || currentQuestionIndex >= gameLevels[currentLevelIndex].length) return;

            const selectedButton = event.target;
            const selectedAnswer = selectedButton.textContent;
            const correctAnswer = gameLevels[currentLevelIndex][currentQuestionIndex].a;
            gameOptionBtns.forEach(btn => btn.disabled = true); // Disable after selection

            if (selectedAnswer === correctAnswer) {
                score++;
                if(gameScoreSpan) gameScoreSpan.textContent = score;
                selectedButton.style.backgroundColor = '#28a745'; // Green
                if(gameFeedbackDiv) gameFeedbackDiv.textContent = "Correct!";
                if(gameFeedbackDiv) gameFeedbackDiv.style.color = '#155724';
            } else {
                selectedButton.style.backgroundColor = '#dc3545'; // Red
                if(gameFeedbackDiv) gameFeedbackDiv.textContent = `Incorrect. Answer: ${correctAnswer}`;
                 if(gameFeedbackDiv) gameFeedbackDiv.style.color = '#721c24';
                 // Highlight correct answer
                 gameOptionBtns.forEach(btn => { if (btn.textContent === correctAnswer) { btn.style.backgroundColor = '#28a745'; } });
            }
            currentQuestionIndex++; // Move to the next question index

            // Load next question or next level after a delay
            setTimeout(() => {
                 if (gameActive) loadQuestion(); // loadQuestion handles moving to next level if needed
            }, 1500); // 1.5 second delay
        }

        function endGame(completedAll) {
            gameActive = false;
            clearInterval(timerInterval);
            gamePlayDiv?.classList.add('hidden');
            gameOverDiv?.classList.remove('hidden');
            if(finalScoreSpan) finalScoreSpan.textContent = score;
            if (gameOverMessage) {
                 gameOverMessage.textContent = completedAll ? "Congratulations! All Levels Completed!" : "Time's Up!";
            }
        }

        // Add event listeners safely
        if(startGameBtn) startGameBtn.addEventListener('click', startGame);
        if(restartGameBtn) restartGameBtn.addEventListener('click', startGame);
        gameOptionBtns.forEach(button => { button.addEventListener('click', selectAnswer); });


        // --- Initialize view ---
        // Ensure the page starts with the tutorial section visible
        document.addEventListener('DOMContentLoaded', () => {
             const initialNavButton = document.getElementById('nav-tutorial');
             if (initialNavButton && typeof initialNavButton.click === 'function') {
                  initialNavButton.click(); // Simulate click to set initial state
             } else {
                 // Fallback if click simulation fails
                 mainNavButtons.forEach(btn => btn.classList.remove('active'));
                 contentSections.forEach(section => section.classList.remove('active'));
                 document.getElementById('nav-tutorial')?.classList.add('active');
                 document.getElementById('tutorial-section')?.classList.add('active');
                 document.getElementById('tab-intro')?.classList.add('active'); // Ensure first tab is active
                 document.querySelector('.tutorial-tabs .tab-link')?.classList.add('active');
             }
        });

    </script>

</body>
</html>
