<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KS3 Science - Variation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #16a085;
            --secondary-color: #9bdb4d;
            --text-color: #333;
            --light-bg: #f9f9f9;
            --dark-bg: #333;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        header {
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            position: relative;
            z-index: 10;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .logo span {
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.8rem;
            font-size: 1rem;
            text-align: center;
            padding: 5px;
            line-height: 1.1;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav li {
            margin-left: 1.5rem;
        }

        nav a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--primary-color);
        }

        main {
            max-width: 1200px;
            margin: 2rem auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .container {
            padding: 2rem;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-header {
            margin-bottom: 2rem;
            position: relative;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid rgba(22, 160, 133, 0.2);
        }

        .section-header h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
        }

        .section-header h2::before {
            content: "";
            display: inline-block;
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: 50%;
            margin-right: 12px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>');
            background-position: center;
            background-repeat: no-repeat;
            background-size: 24px;
        }

        .section-header::after {
            content: "";
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 150px;
            height: 3px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        }

        .learning-objectives {
            background-color: rgba(22, 160, 133, 0.1);
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            margin-bottom: 2.5rem;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .learning-objectives::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2316A085"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.2;
        }

        .learning-objectives h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }

        .learning-objectives h3::before {
            content: "";
            display: inline-block;
            width: 24px;
            height: 24px;
            margin-right: 10px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2316A085"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
        }

        .learning-objectives ul {
            list-style-type: none;
            margin-left: 0.5rem;
        }

        .learning-objectives li {
            margin-bottom: 0.8rem;
            position: relative;
            padding-left: 2rem;
            line-height: 1.5;
        }

        .learning-objectives li::before {
            content: "✓";
            color: var(--primary-color);
            font-size: 1.2rem;
            position: absolute;
            left: 0;
            top: 0;
            font-weight: bold;
        }

        .content-box {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin-bottom: 2.5rem;
            position: relative;
            border-left: 4px solid var(--primary-color);
        }

        .content-box h3 {
            color: var(--primary-color);
            margin-bottom: 1.2rem;
            font-size: 1.5rem;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .content-box h3::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 3px;
        }

        .content-box p {
            margin-bottom: 1.2rem;
            line-height: 1.6;
            font-size: 1.05rem;
        }

        .example-box {
            background-color: rgba(155, 219, 77, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid var(--secondary-color);
        }

        .example-box h4 {
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .info-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .info-card-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem;
            font-weight: bold;
        }

        .info-card-body {
            padding: 1rem;
        }

        .info-card-body p {
            margin-bottom: 0.8rem;
        }

        .info-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .checkpoint {
            background-color: rgba(22, 160, 133, 0.05);
            border-radius: 10px;
            padding: 1.8rem;
            margin: 2.5rem 0;
            border: 1px solid rgba(22, 160, 133, 0.2);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .checkpoint::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
        }

        .checkpoint h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            font-size: 1.3rem;
        }

        .checkpoint h3 i {
            margin-right: 0.8rem;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .question {
            margin-bottom: 1.5rem;
        }

        .question p {
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .option {
            background-color: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .option:hover {
            background-color: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        }

        .option.selected {
            background-color: rgba(22, 160, 133, 0.1);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(22, 160, 133, 0.2);
        }

        .option.correct {
            background-color: rgba(46, 204, 113, 0.1);
            border-color: var(--success-color);
            box-shadow: 0 0 0 2px rgba(46, 204, 113, 0.2);
        }

        .option.incorrect {
            background-color: rgba(231, 76, 60, 0.1);
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.2);
        }

        .option input {
            margin-right: 1rem;
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
        }

        .feedback {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
            font-weight: 500;
            position: relative;
            padding-left: 2.5rem;
        }

        .feedback.correct {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
            display: block;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .feedback.correct::before {
            content: "✓";
            position: absolute;
            left: 1rem;
            font-size: 1.2rem;
            color: var(--success-color);
        }

        .feedback.incorrect {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--accent-color);
            display: block;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .feedback.incorrect::before {
            content: "✗";
            position: absolute;
            left: 1rem;
            font-size: 1.2rem;
            color: var(--accent-color);
        }

        .btn {
            display: inline-block;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px; /* Making button more rounded */
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
            font-size: 1.05rem;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(22, 160, 133, 0.3);
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn:active {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(22, 160, 133, 0.2);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: flex-end;
        }

        .progress-container {
            background-color: #e9ecef;
            border-radius: 50px;
            position: relative;
            margin: 2rem 0;
            height: 15px;
            width: 100%;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 2px;
        }

        .progress-bar {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            height: 100%;
            border-radius: 50px;
            transition: width 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            width: 0%;
            box-shadow: 0 2px 4px rgba(22, 160, 133, 0.3);
        }

        .progress-container::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShine 1.5s infinite;
        }

        @keyframes progressShine {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        .image-container {
            text-align: center;
            margin: 1.5rem 0;
        }

        .image-container img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .match-activity {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .match-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 1rem;
            cursor: grab;
            transition: all 0.3s;
        }

        .match-item:hover {
            background-color: #f0f0f0;
        }

        .match-item.selected {
            background-color: rgba(22, 160, 133, 0.1);
            border-color: var(--primary-color);
        }

        .match-item.correct {
            background-color: rgba(46, 204, 113, 0.1);
            border-color: var(--success-color);
        }

        .match-item.incorrect {
            background-color: rgba(231, 76, 60, 0.1);
            border-color: var(--accent-color);
        }

        .match-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .match-column {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .match-drop {
            background-color: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 1rem;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .match-drop.highlight {
            border-color: var(--primary-color);
            background-color: rgba(22, 160, 133, 0.05);
        }

        .game-container {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }

        .game-container h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .game-card {
            background-color: var(--primary-color);
            color: white;
            height: 120px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            perspective: 1000px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .game-card.flipped {
            transform: rotateY(180deg);
        }

        .game-card-front, .game-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            text-align: center;
        }

        .game-card-front {
            background-color: var(--primary-color);
            transform: rotateY(0deg);
        }

        .game-card-back {
            background-color: white;
            color: var(--text-color);
            transform: rotateY(180deg);
            border: 2px solid var(--primary-color);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .score, .time {
            font-weight: bold;
        }

        .summary {
            background-color: rgba(22, 160, 133, 0.05);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 1px solid rgba(22, 160, 133, 0.2);
        }

        .summary h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .summary-list {
            list-style-type: none;
        }

        .summary-list li {
            margin-bottom: 0.8rem;
            position: relative;
            padding-left: 1.5rem;
        }

        .summary-list li::before {
            content: "✓";
            color: var(--success-color);
            position: absolute;
            left: 0;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--primary-color);
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-bg);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background-color: var(--primary-color);
            color: white;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .animation-container {
            position: relative;
            height: 300px;
            margin: 2rem 0;
            background-color: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .match-activity {
                grid-template-columns: 1fr;
            }

            .game-board {
                grid-template-columns: repeat(2, 1fr);
            }

            nav ul {
                display: none; /* Simple hiding for smaller screens, could add hamburger */
            }

            .btn-group {
                flex-direction: column;
            }

            .options {
                grid-template-columns: 1fr;
            }
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 2rem;
            flex-wrap: wrap; /* Allow tabs to wrap on smaller screens */
        }

        .tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            text-align: center; /* Center text in tabs */
            flex-grow: 1; /* Allow tabs to share space */
        }

        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }

        .tab:hover:not(.active) {
            background-color: #f0f0f0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .comparison-slider {
            position: relative;
            width: 100%;
            max-width: 600px; /* Limit max width for better layout */
            height: 300px;
            margin: 2rem auto; /* Center the slider */
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); /* Add shadow */
        }

        .comparison-slider .before,
        .comparison-slider .after {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            /* Add placeholder background color */
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa;
            font-style: italic;
        }
         /* Add text to placeholders */
        .comparison-slider .before::before {
            content: 'Image 1 Placeholder';
        }
        .comparison-slider .after::before {
            content: 'Image 2 Placeholder';
        }


        .comparison-slider .before {
            clip-path: polygon(0 0, var(--slider-position, 50%) 0, var(--slider-position, 50%) 100%, 0 100%);
            z-index: 1; /* Ensure 'before' is above 'after' */
        }
        .comparison-slider .after {
             z-index: 0; /* Ensure 'after' is below 'before' */
        }


        .comparison-slider .slider {
            position: absolute;
            top: 0;
            left: var(--slider-position, 50%);
            width: 4px;
            height: 100%;
            background-color: white;
            cursor: ew-resize;
            transform: translateX(-50%);
            z-index: 2; /* Slider line above images */
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3); /* Add shadow to slider line */
        }

        .comparison-slider .slider-handle {
            position: absolute;
            top: 50%;
            left: 50%; /* Centered on the line */
            width: 40px; /* Make handle larger */
            height: 40px;
            border-radius: 50%;
            background-color: white;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
            z-index: 3; /* Handle above everything */
            display: flex; /* Use flexbox for icon centering */
            align-items: center;
            justify-content: space-between; /* Space out arrows */
            padding: 0 5px; /* Padding for arrows */
            color: var(--primary-color); /* Color for arrows */
        }

        /* Add arrows using pseudo-elements */
        .comparison-slider .slider-handle::before {
            content: '◀';
            font-weight: bold;
        }

        .comparison-slider .slider-handle::after {
            content: '▶';
             font-weight: bold;
        }


        /* Confetti animation for game completion */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            top: -10px;
            z-index: 999;
            animation: confetti-fall linear forwards;
            pointer-events: none; /* Allow interaction below confetti */
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(105vh) rotate(720deg); /* Increased rotation */
                 opacity: 0; /* Fade out at the end */
            }
        }

        /* Style for fill-in-the-blanks */
        .fill-blank {
            border: none;
            border-bottom: 1px dashed var(--primary-color);
            padding: 0.2rem 0.5rem;
            font-size: 1em;
            background-color: transparent;
            transition: all 0.3s ease;
            width: 100px; /* Adjust width as needed */
            text-align: center;
        }
        .fill-blank:focus {
            outline: none;
            border-bottom: 2px solid var(--primary-color);
            background-color: rgba(22, 160, 133, 0.05);
        }

        /* Responsive adjustments for slider */
        @media (max-width: 768px) {
            .comparison-slider {
                height: 250px;
            }
        }
        @media (max-width: 480px) {
            .comparison-slider {
                height: 200px;
            }
            .fill-blank {
                 width: 80px;
            }
            .tab {
                 padding: 0.6rem 1rem; /* Adjust tab padding */
                 font-size: 0.9rem;
            }
             .logo {
                font-size: 1.5rem;
             }
             .logo span {
                 width: 40px;
                 height: 40px;
                 font-size: 0.8rem;
             }
             nav li {
                 margin-left: 1rem;
             }
        }


    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <span>10.1.1</span>
                <div>Variation</div>
            </div>
            <nav>
                <ul>
                    <li><a href="#tutorial" class="nav-link active" data-section="tutorial">Tutorial</a></li>
                    <li><a href="#practice" class="nav-link" data-section="practice">Practice</a></li>
                    <li><a href="#game" class="nav-link" data-section="game">Game</a></li>
                    <li><a href="#summary" class="nav-link" data-section="summary">Summary</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <!-- Tutorial Section -->
            <section id="tutorial" class="section active">
                <div class="section-header">
                    <h2>Learning About Variation</h2>
                </div>

                <div class="learning-objectives">
                    <h3>Learning Objectives</h3>
                    <ul>
                        <li>State the causes of variation in a species</li>
                        <li>Explain whether characteristics are inherited or environmental</li>
                    </ul>
                </div>

                <div class="content-box">
                    <h3>What is Variation?</h3>
                    <p>Variation refers to the differences between individuals of the same species. If you imagine your friends and family, you will picture people who look quite different to each other. For example, people may vary in height and have different hair color. They have different characteristics.</p>

                    <div class="example-box">
                        <h4>Example</h4>
                        <p>Look at the images below. Even though they are all dogs, they show variation within the same species.</p>
                        <div class="image-container">
                            <!-- Using a more descriptive placeholder service -->
                            <img src="images/dog-breeds.jpg" alt="Various dog breeds showing variation">
                        </div>
                    </div>

                    <p>Only members of the same <span class="tooltip">species<span class="tooltiptext">A group of organisms that can reproduce naturally with one another and create fertile offspring.</span></span> can mate to produce fertile offspring.</p>
                </div>

                <div class="checkpoint">
                    <h3><i class="fas fa-clipboard-check"></i> Checkpoint 1</h3>
                    <div class="question" id="q1">
                        <p>What is variation?</p>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q1" value="a"> The differences between different species
                            </label>
                            <label class="option">
                                <input type="radio" name="q1" value="b"> The differences between individuals of the same species
                            </label>
                            <label class="option">
                                <input type="radio" name="q1" value="c"> The differences between plants and animals
                            </label>
                            <label class="option">
                                <input type="radio" name="q1" value="d"> The similarities between individuals of the same species
                            </label>
                        </div>
                        <div class="feedback" id="q1-feedback"></div>
                    </div>
                </div>

                <!-- MOVED CONTENT BLOCK STARTS HERE -->
                 <div class="content-box">
                    <h3>Types of Variation</h3>
                    <p>There are two main types of variation:</p>

                    <div class="info-grid">
                        <div class="info-card">
                            <div class="info-card-header">
                                Inherited Variation
                            </div>
                            <div class="info-card-body">
                                <p>Some variation is from characteristics the people have inherited from their parents, such as their eye color. This is known as <strong>inherited variation</strong>.</p>
                                <p>Examples include:</p>
                                <ul>
                                    <li>Eye color</li>
                                    <li>Blood group</li>
                                    <li>Genetic diseases (e.g., cystic fibrosis)</li>
                                    <li>Whether your earlobes are attached or detached</li>
                                    <li>Natural hair color</li>
                                </ul>
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="info-card-header">
                                Environmental Variation
                            </div>
                            <div class="info-card-body">
                                <p>Changes related to your surroundings and what happens to you is called <strong>environmental variation</strong>.</p>
                                <p>Examples include:</p>
                                <ul>
                                    <li>Dyed hair color</li>
                                    <li>Scars</li>
                                    <li>Language spoken</li>
                                    <li>Diet and lifestyle factors (e.g., muscle size from exercise)</li>
                                     <li>Tattoos or piercings</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="checkpoint">
                    <h3><i class="fas fa-clipboard-check"></i> Checkpoint 2</h3>
                    <div class="question" id="q2">
                        <p>Which of the following is an example of inherited variation?</p>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q2" value="a"> Scars from an injury
                            </label>
                            <label class="option">
                                <input type="radio" name="q2" value="b"> Dyed hair
                            </label>
                            <label class="option">
                                <input type="radio" name="q2" value="c"> Blood group
                            </label>
                            <label class="option">
                                <input type="radio" name="q2" value="d"> Developed muscles from exercise
                            </label>
                        </div>
                        <div class="feedback" id="q2-feedback"></div>
                    </div>
                </div>

                 <div class="content-box">
                    <h3>How Do Organisms Vary?</h3>
                    <p>Organisms of different species have clear differences. For example:</p>

                    <div class="example-box">
                        <h4>Dogs vs. Fish</h4>
                        <p>It is easy to tell the difference between a dog and a fish. Fish have fins and gills; dogs have four legs and fur. This is because these organisms belong to different <strong>species</strong>.</p>
                    </div>

                    <p>However, it is more difficult to tell the difference between two fish of the same type (e.g., two goldfish). This is because organisms of the same species have more features in common with each other than with other groups, but still show individual differences (variation).</p>

                    <h4>What Causes Variation?</h4>
                    <p>Variation arises from both inherited factors (genes passed from parents) and environmental factors (influences from surroundings and lifestyle). Children usually share some characteristics with their mother and some with their father because they inherit <span class="tooltip">genes<span class="tooltiptext">Units of heredity passed from parent to offspring, determining some characteristic of the offspring.</span></span> from both. They are not identical to either parent because they get a unique mixture of these genes.</p>

                    <div class="comparison-slider" id="comparisonSlider">
                        <div class="before" style="background-image: url('https://via.placeholder.com/600x300/1abc9c/ffffff?text=Parent+1+Trait')"></div>
                        <div class="after" style="background-image: url('https://via.placeholder.com/600x300/3498db/ffffff?text=Parent+2+Trait')"></div>
                        <div class="slider">
                            <div class="slider-handle"></div>
                        </div>
                    </div>
                    <p class="caption" style="text-align: center; margin-top: 0.5rem; font-style: italic;">Imagine traits inherited from two different parents contributing to the offspring.</p>
                </div>

                <div class="checkpoint">
                    <h3><i class="fas fa-clipboard-check"></i> Checkpoint 3</h3>
                    <div class="question" id="q3">
                        <p>Which of the following is an example of environmental variation?</p>
                        <div class="options">
                             <label class="option">
                                <input type="radio" name="q3" value="a"> Eye color
                            </label>
                            <label class="option">
                                <input type="radio" name="q3" value="b"> Tattoos
                            </label>
                            <label class="option">
                                <input type="radio" name="q3" value="c"> Blood group
                            </label>
                            <label class="option">
                                <input type="radio" name="q3" value="d"> Attached or detached earlobes
                            </label>
                        </div>
                        <div class="feedback" id="q3-feedback"></div>
                    </div>
                </div>
                <!-- MOVED CONTENT BLOCK ENDS HERE -->

                <div class="content-box">
                    <h3>Human Variation</h3>
                    <p>Every human in the world is different – even <span class="tooltip">identical twins<span class="tooltiptext">Twins developed from a single fertilized ovum, having the same genetic makeup.</span></span> differ in some ways due to environmental factors. The image below shows some of the ways people may vary:</p>

                    <div class="image-container">
                        <!-- Using a more descriptive placeholder -->
                        <img src="images/human-variation.jpg" alt="Diagram showing human variation examples like height, hair color, eye color">
                    </div>

                    <div class="tabs">
                        <div class="tab active" data-tab="inherited">Inherited Variation</div>
                        <div class="tab" data-tab="environmental">Environmental Variation</div>
                        <div class="tab" data-tab="combined">Combined Effects</div>
                    </div>

                    <div class="tab-content active" id="inherited">
                        <h4>Inherited Characteristics</h4>
                        <p>These characteristics are primarily determined by the genes you inherit from your parents:</p>
                        <ul>
                            <li>Eye color</li>
                            <li>Natural hair color</li>
                            <li>Blood group</li>
                            <li>Attached/detached earlobes</li>
                            <li>Ability to roll tongue</li>
                            <li>Dimpled or smooth chin</li>
                        </ul>
                        <p>These traits are passed down through generations.</p>
                    </div>

                    <div class="tab-content" id="environmental">
                        <h4>Environmental Characteristics</h4>
                        <p>These characteristics are acquired during life due to your surroundings and choices:</p>
                        <ul>
                            <li>Scars</li>
                            <li>Tattoos</li>
                            <li>Dyed hair</li>
                            <li>Piercings</li>
                            <li>Language spoken</li>
                            <li>Accent</li>
                            <li>Suntan</li>
                            <li>Muscle development due to exercise</li>
                        </ul>
                        <p>Environmental characteristics are generally not passed on to offspring.</p>
                    </div>

                    <div class="tab-content" id="combined">
                        <h4>Combined Effects</h4>
                        <p>Many characteristics are a result of both genetic predisposition and environmental influences:</p>
                        <ul>
                            <li><strong>Height:</strong> Genetics sets a potential range, but nutrition and health during growth affect the final height.</li>
                            <li><strong>Weight:</strong> Genetic factors can influence metabolism and appetite, but diet and exercise play a major role.</li>
                            <li><strong>Skin color:</strong> Basic skin tone is inherited, but sun exposure (environment) can alter it (tanning).</li>
                            <li><strong>Intelligence:</strong> Genetic potential exists, but education, nutrition, and environment heavily influence cognitive development.</li>
                        </ul>
                    </div>
                </div>

                <div class="checkpoint">
                    <h3><i class="fas fa-clipboard-check"></i> Checkpoint 4</h3>
                    <div class="question" id="q4">
                        <p>Which statement best explains why identical twins, who share the same genes, can still show differences?</p>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q4" value="a"> They have completely different genes after birth
                            </label>
                            <label class="option">
                                <input type="radio" name="q4" value="b"> Environmental factors can affect them differently throughout their lives
                            </label>
                            <label class="option">
                                <input type="radio" name="q4" value="c"> They are always exactly the same in every way
                            </label>
                            <label class="option">
                                <input type="radio" name="q4" value="d"> One twin inherits genes only from the mother, the other only from the father
                            </label>
                        </div>
                        <div class="feedback" id="q4-feedback"></div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn" id="tutorialComplete">Complete Tutorial & Proceed to Practice</button>
                </div>
            </section>

            <!-- Practice Section -->
            <section id="practice" class="section">
                <div class="section-header">
                    <h2>Practice Activities</h2>
                </div>

                <div class="content-box">
                    <h3>Activity 1: Classifying Variation</h3>
                    <p>For each characteristic, decide whether it is primarily an example of <strong>inherited</strong> or <strong>environmental</strong> variation.</p>

                    <table id="variationTable">
                        <thead>
                            <tr>
                                <th>Characteristic</th>
                                <th>Inherited</th>
                                <th>Environmental</th>
                                <th>Result</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Eye color</td>
                                <td><input type="radio" name="char1" value="inherited"></td>
                                <td><input type="radio" name="char1" value="environmental"></td>
                                <td class="result"></td>
                            </tr>
                            <tr>
                                <td>Scars</td>
                                <td><input type="radio" name="char2" value="inherited"></td>
                                <td><input type="radio" name="char2" value="environmental"></td>
                                <td class="result"></td>
                            </tr>
                            <tr>
                                <td>Blood group</td>
                                <td><input type="radio" name="char3" value="inherited"></td>
                                <td><input type="radio" name="char3" value="environmental"></td>
                                <td class="result"></td>
                            </tr>
                            <tr>
                                <td>Language spoken</td>
                                <td><input type="radio" name="char4" value="inherited"></td>
                                <td><input type="radio" name="char4" value="environmental"></td>
                                <td class="result"></td>
                            </tr>
                            <tr>
                                <td>Hair style (e.g., cut short)</td>
                                <td><input type="radio" name="char5" value="inherited"></td>
                                <td><input type="radio" name="char5" value="environmental"></td>
                                <td class="result"></td>
                            </tr>
                            <tr>
                                <td>Earlobes (attached/detached)</td>
                                <td><input type="radio" name="char6" value="inherited"></td>
                                <td><input type="radio" name="char6" value="environmental"></td>
                                <td class="result"></td>
                            </tr>
                            <tr>
                                <td>Tattoos</td>
                                <td><input type="radio" name="char7" value="inherited"></td>
                                <td><input type="radio" name="char7" value="environmental"></td>
                                <td class="result"></td>
                            </tr>
                            <tr>
                                <td>Ability to roll tongue</td>
                                <td><input type="radio" name="char8" value="inherited"></td>
                                <td><input type="radio" name="char8" value="environmental"></td>
                                <td class="result"></td>
                            </tr>
                        </tbody>
                    </table>

                    <button class="btn" id="checkActivity1">Check Answers</button>
                    <div id="activity1-feedback" class="feedback"></div>
                </div>

                <div class="content-box">
                    <h3>Activity 2: Matching Terms</h3>
                    <p>Drag and drop (or click to select/place) each term next to its correct definition.</p>

                    <div class="match-container">
                        <div class="match-column" id="terms-column">
                            <div class="match-item" draggable="true" data-term="species">Species</div>
                            <div class="match-item" draggable="true" data-term="variation">Variation</div>
                            <div class="match-item" draggable="true" data-term="inherited">Inherited variation</div>
                            <div class="match-item" draggable="true" data-term="environmental">Environmental variation</div>
                        </div>

                        <div class="match-column" id="definitions-column">
                            <div class="match-drop" data-def="species">A group of organisms that can reproduce to produce fertile offspring</div>
                            <div class="match-drop" data-def="variation">Differences between individuals of the same species</div>
                            <div class="match-drop" data-def="inherited">Characteristics passed from parents to offspring through genes</div>
                            <div class="match-drop" data-def="environmental">Characteristics affected by surroundings and lifestyle</div>
                        </div>
                    </div>

                    <button class="btn" id="checkActivity2">Check Matches</button>
                    <div id="activity2-feedback" class="feedback"></div>
                </div>

                <div class="content-box">
                    <h3>Activity 3: Complete the Sentences</h3>
                    <p>Fill in the blanks using the correct terms from the word bank.</p>

                    <div class="example-box">
                        <h4>Word Bank</h4>
                        <p>species, variation, inherited, environmental, genes, characteristics, offspring</p>
                    </div>

                    <div class="question-set">
                        <p>1. Differences between individuals of the same species are called <input type="text" data-answer="variation" class="fill-blank">.</p>
                        <p>2. <input type="text" data-answer="Inherited" class="fill-blank"> variation is passed from parents to <input type="text" data-answer="offspring" class="fill-blank"> through <input type="text" data-answer="genes" class="fill-blank">.</p>
                        <p>3. <input type="text" data-answer="Environmental" class="fill-blank"> variation is caused by surroundings and lifestyle factors.</p>
                        <p>4. Only members of the same <input type="text" data-answer="species" class="fill-blank"> can mate to produce fertile offspring.</p>
                        <p>5. Eye color and blood group are examples of <input type="text" data-answer="inherited" class="fill-blank"> <input type="text" data-answer="characteristics" class="fill-blank">.</p>
                    </div>

                    <button class="btn" id="checkActivity3">Check Answers</button>
                    <div id="activity3-feedback" class="feedback"></div>
                </div>

                <div class="btn-group">
                    <button class="btn" id="practiceComplete">Complete Practice & Play Game</button>
                </div>
            </section>

            <!-- Game Section -->
            <section id="game" class="section">
                <div class="section-header">
                    <h2>Variation Challenge Game</h2>
                </div>

                <div class="content-box">
                    <h3>Memory Match Challenge</h3>
                    <p>Match pairs of cards with related variation concepts (e.g., a term and its definition, or an example and its type). Complete the game as quickly as possible!</p>

                    <div class="game-info">
                        <div class="score">Score: <span id="score">0</span></div>
                        <div class="time">Time: <span id="time">00:00</span></div>
                        <div class="pairs">Pairs Found: <span id="pairs">0</span>/8</div>
                    </div>

                    <div class="game-board" id="gameBoard">
                        <!-- Cards will be generated by JavaScript -->
                        <p style="text-align: center; padding: 2rem; color: #888;">Click 'Start Game' to begin!</p>
                    </div>

                    <div class="btn-group" style="justify-content: center;"> <!-- Center game buttons -->
                        <button class="btn" id="startGame">Start Game</button>
                        <button class="btn btn-secondary" id="resetGame">Reset Game</button>
                    </div>
                </div>

                <div class="content-box" id="gameResult" style="display: none; text-align: center;"> <!-- Renamed ID and centered -->
                    <h3>Congratulations!</h3>
                    <p>You've completed the Variation Challenge Game!</p>
                    <div class="summary" style="max-width: 400px; margin: 1rem auto;"> <!-- Centered and sized summary -->
                        <h4>Your Results:</h4>
                        <p>Time Taken: <span id="finalTime">00:00</span></p>
                        <p>Total Moves: <span id="finalMoves">0</span></p>
                        <p>Final Score: <span id="finalScore">0</span></p>
                    </div>
                     <div class="btn-group" style="justify-content: center;">
                         <button class="btn" id="gameCompleteBtn">Proceed to Summary</button> <!-- Changed ID from gameComplete -->
                     </div>
                </div>

            </section>

            <!-- Summary Section -->
            <section id="summary" class="section">
                <div class="section-header">
                    <h2>Summary and Key Points</h2>
                </div>

                <div class="content-box">
                    <div class="summary">
                        <h3>What You've Learned</h3>
                        <ul class="summary-list">
                            <li><strong>Variation</strong> means the differences that exist between individuals of the same species.</li>
                            <li>There are two main causes of variation: <strong>inherited</strong> factors and <strong>environmental</strong> factors.</li>
                            <li><strong>Inherited variation</strong> comes from characteristics passed down from parents to offspring through genes (e.g., eye color, blood group, natural hair color).</li>
                            <li><strong>Environmental variation</strong> results from differences in surroundings and lifestyle (e.g., scars, tattoos, language spoken, dyed hair).</li>
                            <li>Many characteristics (like height, weight, skin tone) are affected by a combination of both inherited and environmental factors.</li>
                            <li>A <strong>species</strong> is defined as a group of organisms that can interbreed to produce fertile offspring.</li>
                        </ul>
                    </div>

                    <div class="example-box">
                        <h4>Key Words Recap</h4>
                        <p><strong>Variation:</strong> Differences between individuals of the same species.</p>
                        <p><strong>Species:</strong> A group of organisms capable of interbreeding to produce fertile offspring.</p>
                        <p><strong>Inherited variation:</strong> Differences due to characteristics passed from parents via genes.</p>
                        <p><strong>Environmental variation:</strong> Differences due to surroundings, lifestyle, or events during life.</p>
                        <p><strong>Genes:</strong> Units of heredity that determine characteristics.</p>
                        <p><strong>Characteristics:</strong> Features or qualities of an organism.</p>
                    </div>
                </div>

                <div class="content-box">
                    <h3>Final Quiz</h3>
                    <p>Test your understanding of variation with this final quiz.</p>

                    <div class="question" id="fq1">
                        <p>1. Which of these is NOT primarily an example of inherited variation?</p>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="fq1" value="a"> Eye color
                            </label>
                            <label class="option">
                                <input type="radio" name="fq1" value="b"> Blood group
                            </label>
                            <label class="option">
                                <input type="radio" name="fq1" value="c"> Language spoken
                            </label>
                            <label class="option">
                                <input type="radio" name="fq1" value="d"> Ability to roll tongue
                            </label>
                        </div>
                        <div class="feedback" id="fq1-feedback"></div>
                    </div>

                    <div class="question" id="fq2">
                        <p>2. Height in humans is influenced by both genetics and factors like nutrition. This makes height an example of a characteristic affected by:</p>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="fq2" value="a"> Only inherited variation
                            </label>
                            <label class="option">
                                <input type="radio" name="fq2" value="b"> Only environmental variation
                            </label>
                            <label class="option">
                                <input type="radio" name="fq2" value="c"> Both inherited and environmental variation
                            </label>
                            <label class="option">
                                <input type="radio" name="fq2" value="d"> Neither inherited nor environmental variation
                            </label>
                        </div>
                        <div class="feedback" id="fq2-feedback"></div>
                    </div>

                    <div class="question" id="fq3">
                        <p>3. What defines a species?</p>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="fq3" value="a"> A group of organisms that look exactly alike
                            </label>
                            <label class="option">
                                <input type="radio" name="fq3" value="b"> A group of organisms living in the same habitat
                            </label>
                            <label class="option">
                                <input type="radio" name="fq3" value="c"> A group of organisms that can reproduce to produce fertile offspring
                            </label>
                            <label class="option">
                                <input type="radio" name="fq3" value="d"> A group of organisms that share the same environmental variations
                            </label>
                        </div>
                        <div class="feedback" id="fq3-feedback"></div>
                    </div>

                    <button class="btn" id="checkFinalQuiz">Check Final Quiz Answers</button>
                    <div id="finalQuiz-feedback" class="feedback"></div>
                </div>

                <div class="btn-group">
                    <button class="btn" id="lessonComplete">Complete Lesson</button>
                </div>
            </section>
        </div>
    </main>

    <script>
        // Global variables
        let currentSection = 'tutorial';
        let progress = 0;
        let gameTimer;
        let gameSeconds = 0;
        let gamePairsFound = 0; // Renamed for clarity
        let gameMoves = 0;
        let gameScore = 0;
        let firstCard, secondCard;
        let lockBoard = false;
        const totalGamePairs = 8; // Define total pairs for the game

        // Game card data (16 cards total for 8 pairs)
        const gameCardsData = [
            { id: 1, content: 'Variation', pair: 2 },
            { id: 2, content: 'Differences in species', pair: 1 },
            { id: 3, content: 'Inherited', pair: 4 },
            { id: 4, content: 'From Genes', pair: 3 },
            { id: 5, content: 'Environmental', pair: 6 },
            { id: 6, content: 'From Surroundings', pair: 5 },
            { id: 7, content: 'Species', pair: 8 },
            { id: 8, content: 'Can make fertile young', pair: 7 },
            { id: 9, content: 'Eye color', pair: 10 },
            { id: 10, content: 'Example: Inherited', pair: 9 },
            { id: 11, content: 'Scars', pair: 12 },
            { id: 12, content: 'Example: Environmental', pair: 11 },
            { id: 13, content: 'Identical Twins', pair: 14 },
            { id: 14, content: 'Same Genes', pair: 13 },
            { id: 15, content: 'Height', pair: 16 },
            { id: 16, content: 'Example: Combined', pair: 15 }
        ];

        // DOM ready event
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the page
            updateProgress(5); // Start with a little progress
            initNavigation();
            initCheckpoints();
            initPracticeActivities();
            initGame(); // Setup game listeners but don't start automatically
            initComparisonSlider();
            initTabs();
            initDragDrop(); // Initialize drag and drop for Activity 2
        });

        function initNavigation() {
            // Nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.dataset.section;
                    // Basic navigation allowed, but progress tied to buttons
                    changeSection(section);
                    // Update progress based on section reached (simple version)
                    switch(section) {
                        case 'tutorial': updateProgress(5); break;
                        case 'practice': updateProgress(33); break;
                        case 'game': updateProgress(66); break;
                        case 'summary': updateProgress(100); break;
                    }
                });
            });

            // Section navigation buttons
            document.getElementById('tutorialComplete').addEventListener('click', function() {
                if (validateTutorial()) {
                    changeSection('practice');
                    updateProgress(33);
                } else {
                    alert('Please complete all checkpoint questions correctly before proceeding.');
                }
            });

            document.getElementById('practiceComplete').addEventListener('click', function() {
                 // Optional: Add validation for practice activities if needed
                 changeSection('game');
                 updateProgress(66);
            });

            // Renamed button ID from 'gameComplete' to 'gameCompleteBtn'
            document.getElementById('gameCompleteBtn').addEventListener('click', function() {
                changeSection('summary');
                updateProgress(100);
            });

            document.getElementById('lessonComplete').addEventListener('click', function() {
                if (validateFinalQuiz()) {
                    alert('Congratulations! You have completed the Variation lesson!');
                    showConfetti();
                    // Optionally disable navigation or redirect
                } else {
                    alert('Please complete the final quiz correctly before finishing the lesson.');
                }
            });
        }

        function changeSection(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => {
                s.classList.remove('active');
            });

            // Show selected section
            const targetSection = document.getElementById(section);
            if (targetSection) {
                targetSection.classList.add('active');
                 // Scroll to the top of the main content area
                document.querySelector('main').scrollTop = 0; // For overflow scrolling
                window.scrollTo({ top: document.querySelector('main').offsetTop - 20, behavior: 'smooth' }); // Scroll window
            }


            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section === section) {
                    link.classList.add('active');
                }
            });

            currentSection = section;
        }

        function updateProgress(value) {
            progress = Math.min(100, Math.max(progress, value)); // Ensure progress only increases or stays same
            const progressBar = document.getElementById('progressBar');
             if(progressBar) {
                progressBar.style.width = progress + '%';
             }
        }

        function initCheckpoints() {
             // Helper function to handle radio button change
            function handleRadioChange(questionId, correctAnswerValue) {
                const radios = document.querySelectorAll(`input[name="${questionId}"]`);
                radios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        const feedback = document.getElementById(`${questionId}-feedback`);
                        const parentOption = this.closest('.option');
                        const allOptions = document.querySelectorAll(`#${questionId} .option`);

                        // Reset styles on all options for this question
                        allOptions.forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));

                         // Apply selected style
                         parentOption.classList.add('selected');

                        if (this.value === correctAnswerValue) {
                            feedback.textContent = 'Correct!'; // Simplified feedback
                            feedback.className = 'feedback correct';
                            parentOption.classList.add('correct');
                        } else {
                            feedback.textContent = 'Incorrect. Check the explanation or try again!'; // Simplified feedback
                            feedback.className = 'feedback incorrect';
                             parentOption.classList.add('incorrect');
                        }
                    });
                });
            }

            // Initialize all checkpoints
            handleRadioChange('q1', 'b');
            handleRadioChange('q2', 'c');
            handleRadioChange('q3', 'b');
            handleRadioChange('q4', 'b');

            // Initialize Final Quiz (using 'fq' prefix)
            handleRadioChange('fq1', 'c');
            handleRadioChange('fq2', 'c'); // Correct answer is 'c' (both)
            handleRadioChange('fq3', 'c');

            // Check Final Quiz button logic
            document.getElementById('checkFinalQuiz').addEventListener('click', function() {
                const fq1 = document.querySelector('input[name="fq1"]:checked');
                const fq2 = document.querySelector('input[name="fq2"]:checked');
                const fq3 = document.querySelector('input[name="fq3"]:checked');
                const feedbackDiv = document.getElementById('finalQuiz-feedback');

                if (!fq1 || !fq2 || !fq3) {
                    feedbackDiv.textContent = 'Please answer all questions.';
                    feedbackDiv.className = 'feedback incorrect';
                    return;
                }

                let correctCount = 0;
                if (fq1.value === 'c') correctCount++;
                if (fq2.value === 'c') correctCount++; // Checking for 'c'
                if (fq3.value === 'c') correctCount++;

                if (correctCount === 3) {
                    feedbackDiv.textContent = 'Excellent! You got all the final quiz questions correct!';
                    feedbackDiv.className = 'feedback correct';
                    updateProgress(100); // Mark as fully complete if quiz passed
                } else {
                     feedbackDiv.textContent = `You got ${correctCount} out of 3 questions correct. Review the summary and try again!`;
                     feedbackDiv.className = 'feedback incorrect';
                }
            });
        }


        function validateTutorial() {
            const q1Correct = document.querySelector('input[name="q1"][value="b"]:checked');
            const q2Correct = document.querySelector('input[name="q2"][value="c"]:checked');
            const q3Correct = document.querySelector('input[name="q3"][value="b"]:checked');
            const q4Correct = document.querySelector('input[name="q4"][value="b"]:checked');

            return q1Correct && q2Correct && q3Correct && q4Correct;
        }

        function validateFinalQuiz() {
            const fq1Correct = document.querySelector('input[name="fq1"][value="c"]:checked');
            const fq2Correct = document.querySelector('input[name="fq2"][value="c"]:checked'); // Correct ans is 'c'
            const fq3Correct = document.querySelector('input[name="fq3"][value="c"]:checked');

            return fq1Correct && fq2Correct && fq3Correct;
        }

         function initPracticeActivities() {
            // Activity 1: Variation Table
            document.getElementById('checkActivity1').addEventListener('click', function() {
                const answers = {
                    'char1': 'inherited',    // Eye color
                    'char2': 'environmental', // Scars
                    'char3': 'inherited',    // Blood group
                    'char4': 'environmental', // Language spoken
                    'char5': 'environmental', // Hair style
                    'char6': 'inherited',    // Earlobes
                    'char7': 'environmental', // Tattoos
                    'char8': 'inherited'     // Ability to roll tongue
                };

                let correctCount = 0;
                let total = Object.keys(answers).length;
                let allAnswered = true;

                for (let key in answers) {
                    const selected = document.querySelector(`input[name="${key}"]:checked`);
                    const resultCell = document.querySelector(`input[name="${key}"]`).closest('tr').querySelector('.result');

                    if (!selected) {
                        resultCell.textContent = '?';
                        resultCell.style.color = 'var(--warning-color)';
                        allAnswered = false;
                        continue; // Skip checking if not answered
                    }

                    if (selected.value === answers[key]) {
                        resultCell.textContent = '✓';
                        resultCell.style.color = 'var(--success-color)';
                        correctCount++;
                    } else {
                        resultCell.textContent = '✗';
                        resultCell.style.color = 'var(--accent-color)';
                    }
                }

                const feedback = document.getElementById('activity1-feedback');

                if (!allAnswered) {
                     feedback.textContent = 'Please answer all classification questions.';
                     feedback.className = 'feedback incorrect';
                } else if (correctCount === total) {
                    feedback.textContent = 'Excellent! You classified all characteristics correctly!';
                    feedback.className = 'feedback correct';
                } else {
                    feedback.textContent = `You got ${correctCount} out of ${total} correct. Review the types of variation and try again!`;
                    feedback.className = 'feedback incorrect';
                }
            });

            // Activity 2: Matching (Drag/Drop initialized in initDragDrop)
            document.getElementById('checkActivity2').addEventListener('click', function() {
                const dropZones = document.querySelectorAll('.match-drop');
                let correctCount = 0;
                let total = dropZones.length;
                let allMatched = true;

                dropZones.forEach(drop => {
                    const droppedItem = drop.querySelector('.match-item');
                    drop.classList.remove('correct', 'incorrect'); // Reset styles

                    if (!droppedItem) {
                         allMatched = false;
                         return;
                    }

                    const term = droppedItem.dataset.term;
                    const def = drop.dataset.def;

                    if (term === def) {
                        drop.classList.add('correct');
                        droppedItem.classList.add('correct'); // Style the item too
                        correctCount++;
                    } else {
                         drop.classList.add('incorrect');
                         droppedItem.classList.add('incorrect');
                    }
                });

                const feedback = document.getElementById('activity2-feedback');

                if (!allMatched) {
                    feedback.textContent = 'Please match all terms to a definition.';
                    feedback.className = 'feedback incorrect';
                } else if (correctCount === total) {
                    feedback.textContent = 'Excellent! You matched all terms correctly!';
                    feedback.className = 'feedback correct';
                } else {
                    feedback.textContent = `You got ${correctCount} out of ${total} correct. Try dragging the terms again!`;
                    feedback.className = 'feedback incorrect';
                }
            });


            // Activity 3: Fill in the blanks
            document.getElementById('checkActivity3').addEventListener('click', function() {
                const blanks = document.querySelectorAll('.fill-blank');
                let correctCount = 0;
                let total = blanks.length;
                let allFilled = true;

                blanks.forEach(blank => {
                    const userAnswer = blank.value.trim().toLowerCase();
                    const correctAnswer = blank.dataset.answer.toLowerCase();

                    blank.classList.remove('correct', 'incorrect'); // Reset styles

                    if (userAnswer === '') {
                        allFilled = false;
                        return; // Skip check if blank
                    }

                    if (userAnswer === correctAnswer) {
                        blank.classList.add('correct');
                        blank.style.borderColor = 'var(--success-color)'; // Use border color for input
                        blank.style.backgroundColor = 'rgba(46, 204, 113, 0.1)';
                        correctCount++;
                    } else {
                         blank.classList.add('incorrect');
                         blank.style.borderColor = 'var(--accent-color)';
                         blank.style.backgroundColor = 'rgba(231, 76, 60, 0.1)';
                    }
                });

                const feedback = document.getElementById('activity3-feedback');

                 if (!allFilled) {
                     feedback.textContent = 'Please fill in all the blanks.';
                     feedback.className = 'feedback incorrect';
                 } else if (correctCount === total) {
                    feedback.textContent = 'Excellent! You filled in all blanks correctly!';
                    feedback.className = 'feedback correct';
                } else {
                    feedback.textContent = `You got ${correctCount} out of ${total} correct. Check the word bank and try again!`;
                    feedback.className = 'feedback incorrect';
                }
            });
        }

         function initDragDrop() {
            const items = document.querySelectorAll('.match-item[draggable="true"]');
            const dropZones = document.querySelectorAll('.match-drop');
            let draggedItem = null;

            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedItem = item;
                    setTimeout(() => item.style.opacity = '0.5', 0);
                    e.dataTransfer.effectAllowed = 'move';
                 //   e.dataTransfer.setData('text/plain', item.dataset.term); // Optional data transfer
                });

                item.addEventListener('dragend', () => {
                    draggedItem = null;
                     item.style.opacity = '1';
                     // Remove highlight from all dropzones
                     dropZones.forEach(zone => zone.classList.remove('highlight'));
                });

                 // --- Click-based alternative for touch/non-drag ---
                 item.addEventListener('click', function selectItem() {
                     if (this.parentElement.id !== 'terms-column') return; // Only select from terms column

                     const currentSelected = document.querySelector('.match-item.selected');
                     if (currentSelected) {
                         currentSelected.classList.remove('selected');
                     }
                     this.classList.add('selected');
                 });
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault(); // Necessary to allow dropping
                    e.dataTransfer.dropEffect = 'move';
                    zone.classList.add('highlight');
                });

                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('highlight');
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('highlight');
                    if (draggedItem && zone.children.length === 0) { // Allow only one item per drop zone
                        // Return item if replacing
                        const originColumn = document.getElementById('terms-column');
                        if(zone.children.length > 0 && zone.children[0].parentElement.id !== 'terms-column') {
                             originColumn.appendChild(zone.children[0]);
                        }

                        zone.appendChild(draggedItem); // Move the dragged item
                        draggedItem = null; // Reset dragged item
                    }
                });

                 // --- Click-based drop ---
                 zone.addEventListener('click', function placeItem() {
                      const selectedItem = document.querySelector('.match-item.selected');
                      if (selectedItem && this.children.length === 0) { // Check if an item is selected and zone is empty
                           // Optional: Return existing item from dropzone to terms list if needed
                           // if(this.children.length > 0) { ... }

                           this.appendChild(selectedItem);
                           selectedItem.classList.remove('selected'); // Unselect after placing
                      }
                 });
            });
        }


        function initGame() {
            const gameBoard = document.getElementById('gameBoard');
            const startGameBtn = document.getElementById('startGame');
            const resetGameBtn = document.getElementById('resetGame');

            startGameBtn.addEventListener('click', startGame);
            resetGameBtn.addEventListener('click', resetGame); // Ensure reset button works

            function startGame() {
                // Reset game variables
                gameSeconds = 0;
                gamePairsFound = 0;
                gameMoves = 0;
                gameScore = 0;
                lockBoard = false;
                firstCard = null;
                secondCard = null;

                // Update display
                document.getElementById('score').textContent = gameScore;
                document.getElementById('pairs').textContent = `0/${totalGamePairs}`;
                document.getElementById('time').textContent = '00:00';

                // Create and shuffle cards
                const cardsToPlay = shuffleArray([...gameCardsData]);

                // Clear the game board
                gameBoard.innerHTML = '';

                // Create card elements
                cardsToPlay.forEach(cardData => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'game-card';
                    cardElement.dataset.id = cardData.id;
                    cardElement.dataset.pair = cardData.pair;
                    cardElement.dataset.content = cardData.content; // Store content for reveal

                    const frontFace = document.createElement('div');
                    frontFace.className = 'game-card-front';
                    frontFace.innerHTML = '<i class="fas fa-question"></i>'; // Use icon

                    const backFace = document.createElement('div');
                    backFace.className = 'game-card-back';
                    backFace.textContent = cardData.content;

                    cardElement.appendChild(frontFace);
                    cardElement.appendChild(backFace);

                    cardElement.addEventListener('click', flipCard);

                    gameBoard.appendChild(cardElement);
                });

                // Start the timer
                clearInterval(gameTimer); // Clear any existing timer
                gameTimer = setInterval(updateTimer, 1000);

                // Hide the game complete message
                 document.getElementById('gameResult').style.display = 'none';
                 // Ensure buttons are visible
                 startGameBtn.style.display = 'inline-block';
                 resetGameBtn.style.display = 'inline-block';
            }

            function flipCard() {
                if (lockBoard || this.classList.contains('flipped') || this.classList.contains('matched')) return; // Prevent clicking flipped/matched/locked cards
                if (this === firstCard) return; // Prevent clicking the same card twice

                this.classList.add('flipped');

                if (!firstCard) {
                    // First card flipped
                    firstCard = this;
                    return;
                }

                // Second card flipped
                secondCard = this;
                gameMoves++;
                lockBoard = true; // Lock board while checking

                checkForMatch();
            }

            function checkForMatch() {
                const isMatch = firstCard.dataset.pair == secondCard.dataset.id && secondCard.dataset.pair == firstCard.dataset.id;

                if (isMatch) {
                    // Correct match
                    firstCard.classList.add('matched');
                    secondCard.classList.add('matched');
                    disableCards();
                    gamePairsFound++;
                    gameScore += 15; // Higher score for match

                    // Update display
                    document.getElementById('score').textContent = gameScore;
                    document.getElementById('pairs').textContent = `${gamePairsFound}/${totalGamePairs}`;

                    // Check if game is complete
                    if (gamePairsFound === totalGamePairs) {
                        endGame();
                    } else {
                        resetBoard(); // Reset for next turn
                    }
                } else {
                    // Incorrect match
                    gameScore = Math.max(0, gameScore - 5); // Smaller penalty
                    document.getElementById('score').textContent = gameScore;
                    unflipCards(); // Flip back after a delay
                }
            }

            function disableCards() {
                 // Remove listener or just rely on 'matched' class to prevent further clicks
                 firstCard.removeEventListener('click', flipCard);
                 secondCard.removeEventListener('click', flipCard);
                // Don't reset board immediately if ending game
                if (gamePairsFound !== totalGamePairs) {
                    resetBoard();
                }
            }

            function unflipCards() {
                setTimeout(() => {
                    if(firstCard) firstCard.classList.remove('flipped');
                    if(secondCard) secondCard.classList.remove('flipped');
                    resetBoard(); // Reset after flipping back
                }, 1000); // Delay before flipping back
            }

            function resetBoard() {
                [firstCard, secondCard] = [null, null];
                lockBoard = false;
            }

            function endGame() {
                clearInterval(gameTimer);
                lockBoard = true; // Ensure board stays locked

                // Calculate final score with time bonus
                const timeBonus = Math.max(0, (totalGamePairs * 15) - gameSeconds); // Example bonus calculation
                gameScore += timeBonus;


                 // Show game complete message (using the renamed ID 'gameResult')
                const gameResultDiv = document.getElementById('gameResult');
                gameResultDiv.style.display = 'block';


                // Update final results
                document.getElementById('finalTime').textContent = document.getElementById('time').textContent;
                document.getElementById('finalMoves').textContent = gameMoves;
                document.getElementById('finalScore').textContent = gameScore;

                 // Optionally hide start/reset buttons
                 // startGameBtn.style.display = 'none';
                 // resetGameBtn.style.display = 'none';

                 showConfetti(); // Add celebratory confetti
            }

            function resetGame() {
                clearInterval(gameTimer);
                gameBoard.innerHTML = '<p style="text-align: center; padding: 2rem; color: #888;">Click \'Start Game\' to begin!</p>'; // Reset board message
                document.getElementById('score').textContent = '0';
                document.getElementById('pairs').textContent = `0/${totalGamePairs}`;
                document.getElementById('time').textContent = '00:00';
                document.getElementById('gameResult').style.display = 'none'; // Hide result message
                lockBoard = false; // Unlock board
                 // Ensure buttons are visible
                 startGameBtn.style.display = 'inline-block';
                 resetGameBtn.style.display = 'inline-block';
            }

            function updateTimer() {
                gameSeconds++;
                const minutes = Math.floor(gameSeconds / 60);
                const seconds = gameSeconds % 60;

                document.getElementById('time').textContent =
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]]; // Swap elements
                }
                return array;
            }
        }

        function initComparisonSlider() {
            const sliderElement = document.querySelector('.comparison-slider .slider'); // Use class selector
             const containerElement = document.querySelector('.comparison-slider');

            if (!sliderElement || !containerElement) {
                // console.warn("Comparison slider elements not found.");
                return;
             }

            let isDragging = false;

            // Set initial position via CSS variable
            containerElement.style.setProperty('--slider-position', '50%');

            const moveSlider = (clientX) => {
                const rect = containerElement.getBoundingClientRect();
                // Calculate position relative to the container, clamping between 0 and container width
                let x = Math.max(0, Math.min(rect.width, clientX - rect.left));
                const positionPercent = (x / rect.width) * 100;
                containerElement.style.setProperty('--slider-position', `${positionPercent}%`);
            };

            // Mouse events
            sliderElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                sliderElement.style.cursor = 'ew-resize'; // Change cursor while dragging
                 document.body.style.userSelect = 'none'; // Prevent text selection during drag
                 e.preventDefault(); // Prevent default drag behavior
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                moveSlider(e.clientX);
            });

            document.addEventListener('mouseup', () => {
                 if (isDragging) {
                     isDragging = false;
                     sliderElement.style.cursor = 'grab'; // Restore cursor
                     document.body.style.userSelect = ''; // Restore text selection
                 }
            });

            // Touch events
            sliderElement.addEventListener('touchstart', (e) => {
                isDragging = true;
                sliderElement.style.cursor = 'ew-resize';
                 document.body.style.userSelect = 'none';
                 e.preventDefault(); // Prevent page scroll on touch devices
            }, { passive: false }); // Explicitly set passive to false if preventDefault is used

            document.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                 // Use the first touch point
                 if (e.touches.length > 0) {
                    moveSlider(e.touches[0].clientX);
                 }
            }, { passive: false });

            document.addEventListener('touchend', () => {
                if (isDragging) {
                    isDragging = false;
                    sliderElement.style.cursor = 'grab';
                    document.body.style.userSelect = '';
                }
            });
        }


        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content'); // Get all content divs

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Add active class to the clicked tab
                    this.classList.add('active');

                    // Show the corresponding tab content
                    const targetContentId = this.dataset.tab;
                    const targetContent = document.getElementById(targetContentId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });

             // Ensure the first tab's content is visible on load if needed
             const initialActiveTab = document.querySelector('.tab.active');
             if (initialActiveTab) {
                 const initialContentId = initialActiveTab.dataset.tab;
                 const initialContent = document.getElementById(initialContentId);
                 if (initialContent) {
                     initialContent.classList.add('active');
                 }
             }
        }

        function showConfetti() {
            const confettiCount = 100;
            const confettiContainer = document.body; // Or a specific container

            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => { // Stagger the creation slightly
                     createConfettiPiece(confettiContainer);
                }, i * 10);
            }
        }

        function createConfettiPiece(container) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';

            // Random horizontal start position
            const startX = Math.random() * 100;
            confetti.style.left = `${startX}vw`;

            // Random color
            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6', '#1abc9c', '#e67e22', '#f39c12'];
            const color = colors[Math.floor(Math.random() * colors.length)];

            // Random size
            const size = Math.random() * 8 + 6; // Size between 6px and 14px

             // Random shape (more variation)
            const shapeType = Math.random();
             if (shapeType < 0.4) { // Rectangle/Square
                 confetti.style.width = `${size}px`;
                 confetti.style.height = `${size * (0.5 + Math.random())}px`; // Vary aspect ratio
                 confetti.style.backgroundColor = color;
             } else if (shapeType < 0.8) { // Circle
                  confetti.style.width = `${size}px`;
                  confetti.style.height = `${size}px`;
                  confetti.style.borderRadius = '50%';
                  confetti.style.backgroundColor = color;
             } else { // Triangle
                 confetti.style.width = '0';
                 confetti.style.height = '0';
                 confetti.style.backgroundColor = 'transparent';
                 confetti.style.borderLeft = `${size/2}px solid transparent`;
                 confetti.style.borderRight = `${size/2}px solid transparent`;
                 confetti.style.borderBottom = `${size}px solid ${color}`;
             }

            // Random animation duration (speed) & delay
            const duration = Math.random() * 3 + 3; // 3 to 6 seconds
            confetti.style.animationDuration = `${duration}s`;
             // Add a slight random delay to the start
            // confetti.style.animationDelay = `${Math.random() * 0.5}s`;

             // Apply random horizontal drift during fall
            const drift = (Math.random() - 0.5) * 150; // Horizontal movement in pixels
            confetti.style.setProperty('--drift', `${drift}px`);


            container.appendChild(confetti);

            // Remove confetti element after animation finishes
            confetti.addEventListener('animationend', () => {
                confetti.remove();
            });
        }

        // Add drift to the keyframes
        const styleSheet = document.styleSheets[0];
        styleSheet.insertRule(`
            @keyframes confetti-fall {
                to {
                    transform: translateY(105vh) translateX(var(--drift, 0px)) rotate(720deg);
                    opacity: 0;
                }
            }
        `, styleSheet.cssRules.length);


    </script>
</body>
</html>
