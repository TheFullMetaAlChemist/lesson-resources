<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chemistry Paper 1H (June 2025) – Question Level Analysis</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#111b2e;
      --panel2:#0f172a;
      --text:#e7eefc;
      --muted:#a9b6d3;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line:rgba(231,238,252,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --radius2: 22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 600px at 15% -10%, rgba(125,211,252,.25), transparent 60%),
                  radial-gradient(900px 500px at 85% 0%, rgba(167,139,250,.22), transparent 55%),
                  radial-gradient(1200px 800px at 60% 110%, rgba(52,211,153,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    header{
      padding:24px 18px 10px;
      max-width:1200px;
      margin:0 auto;
    }
    h1{
      margin:0;
      font-size: clamp(20px, 2.6vw, 30px);
      letter-spacing:.2px;
      line-height:1.15;
    }
    .sub{
      margin:8px 0 0;
      color:var(--muted);
      max-width: 980px;
      line-height:1.4;
      font-size: 13px;
    }
    main{
      max-width:1200px;
      margin:0 auto;
      padding: 10px 18px 60px;
      display:grid;
      grid-template-columns: 1.25fr .95fr;
      gap: 14px;
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardhead{
      padding: 14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid var(--line);
      background: rgba(17,27,46,.35);
    }
    .card h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .cardbody{ padding: 12px 14px 14px; }

    .btnrow{ display:flex; gap:8px; flex-wrap:wrap; }
    button{
      border:1px solid var(--line);
      background: rgba(15,23,42,.55);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 700;
      letter-spacing:.2px;
      box-shadow: 0 3px 0 rgba(0,0,0,.25);
      transition: transform .05s ease, background .2s ease, border-color .2s ease;
      font-size: 12.5px;
    }
    button:hover{ background: rgba(15,23,42,.72); border-color: rgba(231,238,252,.18); }
    button:active{ transform: translateY(1px); }
    button.primary{
      background: linear-gradient(180deg, rgba(125,211,252,.22), rgba(125,211,252,.10));
      border-color: rgba(125,211,252,.30);
    }
    button.ghost{ background: transparent; }

    .tablewrap{
      overflow:auto;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(15,23,42,.40);
    }
    table{
      border-collapse: collapse;
      width:100%;
      min-width: 780px;
      font-size: 12.5px;
    }
    th, td{
      padding: 9px 9px;
      border-bottom: 1px solid rgba(231,238,252,.08);
      vertical-align: middle;
    }
    th{
      text-align:left;
      color: var(--muted);
      font-weight: 800;
      letter-spacing:.25px;
      background: rgba(17,27,46,.55);
      position: sticky;
      top:0;
      z-index:2;
    }
    tr:hover td{ background: rgba(17,27,46,.22); }

    .qtag{
      font-family: var(--mono);
      color: rgba(231,238,252,.92);
      font-weight: 800;
      font-size: 12px;
      letter-spacing: .2px;
    }
    .small{
      color: var(--muted);
      font-size: 12px;
      line-height:1.25;
    }
    .badgetray{ display:flex; gap:6px; flex-wrap:wrap; }
    .badge{
      font-size: 10.5px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(231,238,252,.14);
      color: rgba(231,238,252,.88);
      background: rgba(15,23,42,.55);
      white-space: nowrap;
    }
    .badge.ao1{ border-color: rgba(167,139,250,.35); background: rgba(167,139,250,.12); }
    .badge.ao2{ border-color: rgba(125,211,252,.35); background: rgba(125,211,252,.12); }
    .badge.ao3{ border-color: rgba(52,211,153,.32); background: rgba(52,211,153,.10); }

    input[type="number"]{
      width: 78px;
      padding: 7px 9px;
      border-radius: 12px;
      border:1px solid rgba(231,238,252,.16);
      background: rgba(8,13,24,.55);
      color: var(--text);
      font-weight: 800;
      outline: none;
      font-size: 13px;
    }
    input[type="number"]:focus{
      border-color: rgba(125,211,252,.55);
      box-shadow: 0 0 0 4px rgba(125,211,252,.12);
    }
    .rowflex{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }

    .meter{
      height: 9px;
      background: rgba(231,238,252,.10);
      border-radius: 999px;
      overflow: hidden;
      border:1px solid rgba(231,238,252,.08);
    }
    .meter > i{
      display:block;
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(125,211,252,.9), rgba(167,139,250,.85));
    }
    .meter.good > i{ background: linear-gradient(90deg, rgba(52,211,153,.9), rgba(125,211,252,.75)); }
    .meter.warn > i{ background: linear-gradient(90deg, rgba(251,191,36,.92), rgba(125,211,252,.6)); }
    .meter.bad  > i{ background: linear-gradient(90deg, rgba(251,113,133,.92), rgba(167,139,250,.6)); }

    .statgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 540px){
      .statgrid{ grid-template-columns: 1fr; }
    }
    .stat{
      padding: 10px 10px;
      border-radius: 16px;
      border: 1px solid rgba(231,238,252,.12);
      background: rgba(15,23,42,.45);
    }
    .stat .k{ color: var(--muted); font-size: 12px; }
    .stat .v{ font-size: 18px; font-weight: 900; margin-top: 4px; letter-spacing:.2px; }
    .stat .v small{ font-size: 12px; color: var(--muted); font-weight: 800; }

    .list{
      margin: 8px 0 0;
      padding: 0;
      list-style: none;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .li{
      border:1px solid rgba(231,238,252,.12);
      background: rgba(15,23,42,.45);
      border-radius: 16px;
      padding: 9px 9px;
      display:flex;
      align-items:flex-start;
      gap:10px;
    }
    .li b{ font-size: 12.8px; }
    .li .mini{ color: var(--muted); font-size: 11.7px; margin-top:2px; line-height:1.25; }
    .ico{
      width: 26px;
      height: 26px;
      border-radius: 10px;
      display:grid;
      place-items:center;
      background: rgba(125,211,252,.12);
      border:1px solid rgba(125,211,252,.22);
      flex: 0 0 auto;
      font-weight: 900;
      font-family: var(--mono);
      color: rgba(231,238,252,.9);
    }
    .ico.g{ background: rgba(52,211,153,.10); border-color: rgba(52,211,153,.22); }
    .ico.w{ background: rgba(251,191,36,.10); border-color: rgba(251,191,36,.22); }
    .ico.r{ background: rgba(251,113,133,.10); border-color: rgba(251,113,133,.22); }

    textarea{
      width:100%;
      min-height: 180px; /* big enough for 3+ action points */
      resize: vertical;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(231,238,252,.12);
      background: rgba(8,13,24,.48);
      color: var(--text);
      line-height: 1.35;
      outline:none;
      font-size: 13px;
    }
    textarea:focus{ border-color: rgba(167,139,250,.50); box-shadow: 0 0 0 4px rgba(167,139,250,.12); }

    .fields{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-bottom: 10px;
    }
    @media (max-width: 540px){
      .fields{ grid-template-columns: 1fr; }
    }
    .field{
      border:1px solid rgba(231,238,252,.12);
      background: rgba(15,23,42,.45);
      border-radius: 16px;
      padding: 10px 10px;
    }
    .field label{
      display:block;
      color: var(--muted);
      font-size: 12px;
      font-weight: 800;
      margin-bottom: 6px;
    }
    input[type="text"]{
      width:100%;
      padding: 9px 10px;
      border-radius: 12px;
      border:1px solid rgba(231,238,252,.16);
      background: rgba(8,13,24,.55);
      color: var(--text);
      font-weight: 800;
      outline: none;
      font-size: 13px;
    }
    input[type="text"]:focus{
      border-color: rgba(167,139,250,.55);
      box-shadow: 0 0 0 4px rgba(167,139,250,.12);
    }

    /* Compact two-column blocks inside report */
    .reportGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top: 10px;
      align-items:start;
    }
    @media (max-width: 980px){
      .reportGrid{ grid-template-columns: 1fr; }
    }
    .sectionTitle{
      margin:0 0 8px;
      font-size: 13px;
      letter-spacing:.2px;
    }

    /* Print: start at results, hide the input table area */
    @media print{
      body{ background:#fff; color:#000; }
      header{ display:none !important; }
      .no-print{ display:none !important; }
      main{
        max-width: 980px;
        margin:0;
        padding:0;
        grid-template-columns: 1fr; /* just print the report */
      }
      /* hide the input card entirely */
      #inputCard{ display:none !important; }

      .card{ box-shadow:none; border:1px solid #ddd; background:#fff; }
      .cardhead{ background:#f6f6f6; border-bottom:1px solid #ddd; }
      .badge, .pill{ border-color:#ddd; background:#fff; color:#333; }
      .meter{ border-color:#ddd; background:#eee; }
      .meter > i{ background:#444; }
      input[type="number"], input[type="text"], textarea{ border:1px solid #bbb; background:#fff; color:#000; }
      .stat, .field, .li{ border:1px solid #ddd; background:#fff; }
      .ico{ border:1px solid #bbb; background:#fff; color:#111; }
      .reportGrid{ grid-template-columns: 1fr 1fr; } /* force 2 columns on print to save pages */
      textarea{ min-height: 220px; } /* a bit more room for action points */
      a{ color:#000; text-decoration:none; }
    }
  </style>
</head>
<body>
<header>
  <h1>Chemistry Paper 1H (June 2025) – Question Level Analysis</h1>
  <p class="sub">
    Enter your marks for each sub-question. The report gives feedback on <b>content strands</b>, a <b>skills audit</b> (AO1/AO2/AO3 + maths + practical/data skills),
    and a printable revision plan.
  </p>
</header>

<main>
  <!-- LEFT: Inputs -->
  <section class="card" id="inputCard">
    <div class="cardhead">
      <h2>1) Enter your marks</h2>
      <div class="btnrow no-print">
        <button class="ghost" id="btnClear" type="button">Clear</button>
        <button class="ghost" id="btnMax" type="button">Fill with max</button>
        <button class="primary" id="btnUpdate" type="button">Update analysis</button>
      </div>
    </div>
    <div class="cardbody">
      <div class="tablewrap">
        <table>
          <thead>
            <tr>
              <th style="width:95px;">Sub-Q</th>
              <th>Focus</th>
              <th style="width:70px;">Max</th>
              <th style="width:130px;">Your marks</th>
              <th style="width:250px;">Skills tags</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
      <p class="small" style="margin:10px 0 0;">
        Tip: for multi-mark questions, enter the number of marks you got (e.g. 0–6).
      </p>
    </div>
  </section>

  <!-- RIGHT: Results -->
  <aside class="card" id="reportCard">
    <div class="cardhead">
      <h2>2) Results & revision plan</h2>
      <div class="btnrow no-print">
        <button class="primary" id="btnPrint" type="button">Print summary</button>
      </div>
    </div>

    <div class="cardbody" id="report">
      <!-- Name + grade fields (included in print) -->
      <div class="fields">
        <div class="field">
          <label for="studentName">Student name</label>
          <input id="studentName" type="text" placeholder="e.g. Alex Turner" />
        </div>
        <div class="field">
          <label for="studentGrade">Mock grade / score</label>
          <input id="studentGrade" type="text" placeholder="e.g. 6 or 52/70" />
        </div>
      </div>

      <div class="statgrid">
        <div class="stat">
          <div class="k">Total score</div>
          <div class="v" id="totalScore">–</div>
          <div class="small" id="totalHint">Enter marks to see your total.</div>
        </div>
        <div class="stat">
          <div class="k">Overall percentage</div>
          <div class="v" id="totalPct">–</div>
          <div class="small" id="totalBand"></div>
        </div>
      </div>

      <!-- Compact two-column report: content left, AO+maths right -->
      <div class="reportGrid">
        <div>
          <h3 class="sectionTitle">Content strands</h3>
          <div id="contentBars"></div>

          <div style="margin-top:10px;">
            <h3 class="sectionTitle">Your top strengths</h3>
            <ul class="list" id="strengths"></ul>
          </div>

          <div style="margin-top:10px;">
            <h3 class="sectionTitle">Your priorities</h3>
            <ul class="list" id="priorities"></ul>
          </div>
        </div>

        <div>
          <h3 class="sectionTitle">AO skills audit</h3>
          <div id="aoBars"></div>

          <div style="margin-top:10px;">
            <h3 class="sectionTitle">Maths skills audit</h3>
            <div id="mathBars"></div>
          </div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <h3 class="sectionTitle">Revision plan (editable)</h3>
        <textarea id="plan" placeholder="Write at least 3 clear action points:
• What will you revise?
• How will you practise it?
• When will you check progress?"></textarea>
        <div class="small" style="margin-top:6px;">
          This plan prints with your name and grade at the top.
        </div>
      </div>

      <div style="margin-top:10px;">
        <h3 class="sectionTitle">What to do next</h3>
        <div class="small" id="nextSteps">
          Use your teacher’s model answers file to correct the questions you dropped marks on. Then retest yourself on your weakest strands.
        </div>
      </div>
    </div>
  </aside>
</main>

<script>
  // ---------- Paper map (June 2025 8464/C/1H) ----------
  // Each item: id, max, focus, AO breakdown, content tags, maths tags, practical/data tags
  // Note: Some sub-questions contain mixed AO marks; we store a breakdown per mark.
  const ITEMS = [
    // Q1
    {id:"1.1", max:1, focus:"Risk reduction (chlorine gas) during electrolysis", ao:{AO3:1}, content:["Electrolysis & reactivity","Working scientifically"], maths:[], practical:["Safety"]},
    {id:"1.2", max:3, focus:"Plot graph + line of best fit from Table 1", ao:{AO2:3}, content:["Working scientifically"], maths:["Graphing & best fit"], practical:["Data handling"]},
    {id:"1.3", max:1, focus:"Use evidence to test a hypothesis using results", ao:{AO3:1}, content:["Working scientifically"], maths:["Graph/data interpretation"], practical:["Analysis"]},
    {id:"1.4", max:3, focus:"Concentration (g/dm³) with unit conversion", ao:{AO2:3}, content:["Quantitative chemistry"], maths:["Units & conversions","Using equations"], practical:[]},
    {id:"1.5", max:1, focus:"Electrolysis products explained using reactivity", ao:{AO2:1}, content:["Electrolysis & reactivity"], maths:[], practical:[]},

    // Q2
    {id:"2.1", max:1, focus:"Define exothermic reaction", ao:{AO1:1}, content:["Energy changes"], maths:[], practical:[]},
    {id:"2.2", max:3, focus:"% by mass of oxygen in Ca(OH)₂ (Mr/Ar)", ao:{AO2:3}, content:["Quantitative chemistry"], maths:["Percentages","Using formula mass"], practical:[]},
    {id:"2.3", max:6, focus:"Plan a method: mass of CaO vs temperature change", ao:{AO1:6}, content:["Energy changes","Working scientifically"], maths:[], practical:["Planning required practical","Variables & control","Measurements"]},

    // Q3
    {id:"3.1", max:2, focus:"Alpha scattering conclusions (nuclear model)", ao:{AO1:2}, content:["Atomic structure & ions"], maths:[], practical:[]},
    {id:"3.2", max:1, focus:"Explain why particle X is not an atom (subatomic particles)", ao:{AO3:1}, content:["Atomic structure & ions"], maths:[], practical:[]},
    {id:"3.3", max:1, focus:"Correct ion/isotope representation using periodic table", ao:{AO2:1}, content:["Atomic structure & ions"], maths:[], practical:[]},
    {id:"3.4", max:3, focus:"Explain boiling point trend in Group 7", ao:{AO1:3}, content:["Periodic trends (Group 7)"], maths:[], practical:[]},
    {id:"3.5", max:1, focus:"Bonding type in ClF₃", ao:{AO1:1}, content:["Bonding & structure"], maths:[], practical:[]},
    {id:"3.6", max:1, focus:"Word equation: halogen displacement", ao:{AO2:1}, content:["Periodic trends (Group 7)"], maths:[], practical:[]},
    {id:"3.7", max:3, focus:"Explain why Group 7 reactivity decreases down the group", ao:{AO1:3}, content:["Periodic trends (Group 7)"], maths:[], practical:[]},

    // Q4
    {id:"4.1", max:1, focus:"Reactivity: why carbon can extract iron", ao:{AO1:1}, content:["Metals & extraction"], maths:[], practical:[]},
    {id:"4.2", max:2, focus:"Why cryolite is used (lower mp / less energy)", ao:{AO1:2}, content:["Metals & extraction","Energy changes"], maths:[], practical:[]},
    {id:"4.3", max:2, focus:"Balanced half equation for oxygen at anode", ao:{AO2:2}, content:["Metals & extraction"], maths:["Balancing equations"], practical:[]},
    {id:"4.4", max:1, focus:"Identify reduced substance in a redox equation", ao:{AO2:1}, content:["Metals & extraction"], maths:[], practical:[]},
    {id:"4.5", max:1, focus:"Use table to explain extraction cost difference (Al vs Fe)", ao:{AO3:1}, content:["Metals & extraction"], maths:["Interpreting tables"], practical:[]},
    {id:"4.6", max:1, focus:"Use table to explain extraction cost difference (Al vs Cr)", ao:{AO3:1}, content:["Metals & extraction"], maths:["Interpreting tables"], practical:[]},
    {id:"4.7", max:3, focus:"Why alloys are harder (structure–property)", ao:{AO1:3}, content:["Bonding & structure","Metals & extraction"], maths:[], practical:[]},

    // Q5
    {id:"5.1", max:1, focus:"State symbols (HCl, water, hydrochloric acid)", ao:{AO2:1}, content:["Acids & pH"], maths:[], practical:[]},
    {id:"5.2", max:1, focus:"pH → [H⁺] in standard form", ao:{AO2:1}, content:["Acids & pH"], maths:["Standard form / powers of ten"], practical:[]},
    {id:"5.3", max:2, focus:"Complete dot-and-cross diagram (HOCl)", ao:{AO2:2}, content:["Bonding & structure"], maths:[], practical:[]},
    {id:"5.4", max:2, focus:"Weak vs strong acid: ionisation & [H⁺]", ao:{AO1:2}, content:["Acids & pH"], maths:[], practical:[]},
    {id:"5.5", max:3, focus:"Bond energies: overall energy change", ao:{AO2:3}, content:["Energy changes"], maths:["Multi-step calculations","Using data (bond energies)"], practical:[]},

    // Q6
    {id:"6.1", max:1, focus:"Why Bunsen burner instead of water bath", ao:{AO3:1}, content:["Working scientifically"], maths:[], practical:["Methods & apparatus"]},
    // Mixed AO: 2 marks AO2, 2 marks AO3
    {id:"6.2", max:4, focus:"Explain mass trends when heating Mg and MgCO₃", ao:{AO2:2, AO3:2}, content:["Conservation of mass & reactions"], maths:["Graph/data interpretation"], practical:["Analysis"]},
    {id:"6.3", max:1, focus:"Explain why final masses are the same (moles reasoning)", ao:{AO3:1}, content:["Conservation of mass & reactions","Quantitative chemistry"], maths:["Moles reasoning"], practical:[]},
    {id:"6.4", max:1, focus:"Evaluate conclusion using evidence (predicted vs actual)", ao:{AO3:1}, content:["Working scientifically","Conservation of mass & reactions"], maths:["Graph/data interpretation"], practical:["Evaluation"]},
    {id:"6.5", max:4, focus:"Mole ratio → formula → balanced equation", ao:{AO2:4}, content:["Quantitative chemistry"], maths:["Stoichiometry (mole ratio)","Balancing equations"], practical:[]},

    // Q7
    {id:"7.1", max:2, focus:"Limitations of a particle model (NaCl)", ao:{AO3:2}, content:["Bonding & structure"], maths:[], practical:["Using models"]},
    {id:"7.2", max:1, focus:"Ionic formula from charges (Al³⁺, SO₄²⁻)", ao:{AO2:1}, content:["Bonding & structure"], maths:["Ratio & charges"], practical:[]},
    {id:"7.3", max:1, focus:"Metallic bonding: why Al conducts better than Na", ao:{AO2:1}, content:["Bonding & structure"], maths:[], practical:[]},
    {id:"7.4", max:4, focus:"Compare SiO₂ and poly(ethene): structure & bonding", ao:{AO1:4}, content:["Bonding & structure"], maths:[], practical:[]},
  ];

  // Friendly strand descriptions for the report
  const CONTENT_INFO = {
    "Working scientifically": "Planning methods, safety, variables, evaluation, and using evidence from data.",
    "Electrolysis & reactivity": "Predicting products at electrodes and explaining using the reactivity series.",
    "Quantitative chemistry": "Concentration, formula mass, moles, ratios, and balancing from numerical data.",
    "Energy changes": "Exothermic reactions, bond energies, and energy/cost links in processes.",
    "Atomic structure & ions": "Nuclear model, ions vs atoms, and particle notation.",
    "Periodic trends (Group 7)": "Trends down Group 7 and displacement reactions.",
    "Metals & extraction": "Reactivity, reduction/oxidation, electrolysis, and extraction costs.",
    "Bonding & structure": "Ionic/covalent/metallic bonding, structures, properties, and models.",
    "Acids & pH": "State symbols, pH and [H+], and weak vs strong acids.",
    "Conservation of mass & reactions": "Explaining mass changes in reactions and linking to products/gases."
  };

  const MATH_INFO = {
    "Units & conversions": "Convert units correctly (e.g., cm³ → dm³) and scale quantities.",
    "Using equations": "Rearrange and apply relationships like concentration = mass/volume.",
    "Percentages": "Calculate % by mass from formula mass.",
    "Using formula mass": "Build Mr from Ar values and use it in calculations.",
    "Graphing & best fit": "Plot accurately, choose scales, and draw a sensible line of best fit.",
    "Graph/data interpretation": "Describe patterns and link them to chemical explanations.",
    "Standard form / powers of ten": "Work confidently with pH and standard form values.",
    "Multi-step calculations": "Keep track of steps, signs, and rounding in longer calculations.",
    "Using data (bond energies)": "Select correct values from a table and use them logically.",
    "Stoichiometry (mole ratio)": "Convert moles into ratios, formulas, and balanced equations.",
    "Balancing equations": "Balance atoms/charge accurately (including half-equations).",
    "Interpreting tables": "Use table evidence to justify conclusions.",
    "Moles reasoning": "Use moles to compare amounts and explain outcomes.",
    "Ratio & charges": "Use ionic charges to form correct formulas."
  };

  const AO_INFO = {
    "AO1":"Knowledge & understanding (definitions, explanations, trends)",
    "AO2":"Apply knowledge (calculations, representations, equations)",
    "AO3":"Analyse & evaluate (methods, evidence, interpreting data)"
  };

  // ---------- Build input table ----------
  const rows = document.getElementById("rows");

  function badgeAO(aoKey){
    const cls = aoKey.toLowerCase();
    return `<span class="badge ${cls}">${aoKey}</span>`;
  }
  function badge(text){
    return `<span class="badge">${text}</span>`;
  }

  function renderRows(){
    rows.innerHTML = ITEMS.map(it => {
      const aoTags = Object.keys(it.ao).map(k => badgeAO(k)).join("");
      const otherTags = []
        .concat(it.maths.map(m => badge("Math: "+m)))
        .concat(it.practical.map(p => badge("Skill: "+p)))
        .slice(0, 4)
        .join("");
      return `
        <tr>
          <td class="qtag">${it.id}</td>
          <td>
            <div style="font-weight:900;">${escapeHtml(it.focus)}</div>
            <div class="small">
              <span style="color:rgba(231,238,252,.82); font-weight:800;">Content:</span>
              ${it.content.map(c => `<span style="color:var(--muted);"> ${escapeHtml(c)} </span>`).join(" • ")}
            </div>
          </td>
          <td><span class="qtag">${it.max}</span></td>
          <td>
            <input type="number" inputmode="numeric" min="0" max="${it.max}" step="1" id="m_${it.id.replace('.','_')}" value="0" />
          </td>
          <td>
            <div class="badgetray">
              ${aoTags}
              ${otherTags}
            </div>
          </td>
        </tr>
      `;
    }).join("");
  }

  // ---------- Scoring helpers ----------
  const totalMax = ITEMS.reduce((a,b)=>a+b.max,0);

  function clamp(n, lo, hi){
    n = Number.isFinite(n) ? n : 0;
    return Math.max(lo, Math.min(hi, n));
  }

  function readMarks(){
    const marks = {};
    ITEMS.forEach(it=>{
      const el = document.getElementById("m_"+it.id.replace('.','_'));
      let v = parseInt(el.value, 10);
      if (Number.isNaN(v)) v = 0;
      v = clamp(v, 0, it.max);
      el.value = v;
      marks[it.id] = v;
    });
    return marks;
  }

  function pickMeterClass(pct){
    if (pct >= 75) return "good";
    if (pct >= 45) return "warn";
    return "bad";
  }

  function pctText(pct){
    if (!Number.isFinite(pct)) return "–";
    return `${Math.round(pct)}%`;
  }

  function scoreByCategory(getCats){
    const marks = readMarks();
    const out = {};
    ITEMS.forEach(it=>{
      const got = marks[it.id] || 0;
      const cats = getCats(it);
      cats.forEach(cat => {
        if (!out[cat]) out[cat] = {score:0, max:0, pct:0};
        out[cat].max += it.max;
        out[cat].score += got;
      });
    });
    Object.keys(out).forEach(cat=>{
      out[cat].pct = out[cat].max ? (out[cat].score / out[cat].max * 100) : 0;
    });
    return out;
  }

  function scoreByAO(){
    const marks = readMarks();
    const out = {AO1:{score:0,max:0,pct:0}, AO2:{score:0,max:0,pct:0}, AO3:{score:0,max:0,pct:0}};
    ITEMS.forEach(it=>{
      const got = marks[it.id] || 0;
      const weights = it.ao;
      const denom = Object.values(weights).reduce((a,b)=>a+b,0) || 1;
      Object.entries(weights).forEach(([ao,w])=>{
        out[ao].max += w;
        out[ao].score += (got * (w/denom));
      });
    });
    Object.keys(out).forEach(ao=> out[ao].pct = out[ao].max ? (out[ao].score/out[ao].max*100) : 0);
    return out;
  }

  function barsHtml(titleToObj, infoMap){
    const entries = Object.entries(titleToObj)
      .sort((a,b)=> (b[1].pct - a[1].pct) || (b[1].max - a[1].max));
    return entries.map(([name, s])=>{
      const cls = pickMeterClass(s.pct);
      return `
        <div class="li" style="align-items:center;">
          <div class="ico ${cls==='good'?'g':cls==='warn'?'w':'r'}">${pctText(s.pct).replace('%','')}</div>
          <div style="flex:1;">
            <div class="rowflex" style="justify-content:space-between;">
              <b>${escapeHtml(name)}</b>
              <span class="small"><span class="qtag">${Math.round(s.score*10)/10}</span> / ${s.max}</span>
            </div>
            <div class="meter ${cls}" style="margin-top:8px;"><i style="width:${Math.max(0,Math.min(100,s.pct))}%;"></i></div>
            <div class="mini">${escapeHtml(infoMap?.[name] || "")}</div>
          </div>
        </div>
      `;
    }).join("");
  }

  function topBottom(listObj, n=3){
    const arr = Object.entries(listObj).map(([k,v])=>({k,...v}));
    arr.sort((a,b)=> (b.pct - a.pct) || (b.max - a.max));
    const top = arr.slice(0,n);
    const bottom = arr.slice().reverse().slice(0,n).reverse();
    return {top, bottom};
  }

  function strengthLi(item){
    const cls = pickMeterClass(item.pct);
    const label = `${Math.round(item.score*10)/10}/${item.max} (${Math.round(item.pct)}%)`;
    return `
      <li class="li">
        <div class="ico ${cls==='good'?'g':cls==='warn'?'w':'r'}">★</div>
        <div>
          <b>${escapeHtml(item.k)}</b>
          <div class="mini">${escapeHtml(label)}${CONTENT_INFO[item.k] ? " — "+escapeHtml(CONTENT_INFO[item.k]) : ""}</div>
        </div>
      </li>
    `;
  }

  function priorityLi(item){
    const cls = pickMeterClass(item.pct);
    const label = `${Math.round(item.score*10)/10}/${item.max} (${Math.round(item.pct)}%)`;
    return `
      <li class="li">
        <div class="ico ${cls==='good'?'g':cls==='warn'?'w':'r'}">!</div>
        <div>
          <b>${escapeHtml(item.k)}</b>
          <div class="mini">${escapeHtml(label)}${CONTENT_INFO[item.k] ? " — "+escapeHtml(CONTENT_INFO[item.k]) : ""}</div>
        </div>
      </li>
    `;
  }

  function overallBand(pct){
    if (pct >= 85) return "Excellent — keep stretching with higher-mark explanations.";
    if (pct >= 70) return "Strong — polish explanations and reduce avoidable slips.";
    if (pct >= 55) return "Secure — focus on weak strands and exam technique.";
    if (pct >= 40) return "Developing — prioritise core skills and high-frequency content.";
    return "Priority support — go back to fundamentals and practise little-and-often.";
  }

  function buildPlan(contentScores, aoScores, mathScores){
    const {bottom: weakContent} = topBottom(contentScores, 3);
    const {bottom: weakMath} = topBottom(mathScores, 2);
    const aoArr = Object.entries(aoScores).map(([k,v])=>({k,...v})).sort((a,b)=>a.pct-b.pct);
    const weakestAO = aoArr[0];

    const lines = [];
    lines.push("Action plan (write at least 3 clear bullet points):");
    lines.push("");
    lines.push("1) Content strands to target:");
    weakContent.forEach((w)=>{
      lines.push(`   • ${w.k} — redo linked questions and write a full model answer without looking.`);
    });
    lines.push("");
    lines.push("2) Skills focus:");
    lines.push(`   • ${weakestAO.k}: ${AO_INFO[weakestAO.k]} — practise 3–6 mark answers with Point → Explain → Evidence → Link.`);
    if (weakMath.length){
      lines.push("   • Maths practice:");
      weakMath.forEach(m=>{
        lines.push(`     – ${m.k}: ${MATH_INFO[m.k] || ""}`.trim());
      });
    }
    lines.push("");
    lines.push("3) Evidence of improvement:");
    lines.push("   • Retest yourself on your weakest 2 strands after 3 days and again after 7 days.");
    lines.push("   • Bring corrected answers to your next lesson for feedback.");
    lines.push("");
    lines.push("Next check-in date: ____________________");
    return lines.join("\n");
  }

  function update(){
    const marks = readMarks();
    const total = Object.values(marks).reduce((a,b)=>a+b,0);
    const pct = totalMax ? (total/totalMax*100) : 0;

    document.getElementById("totalScore").innerHTML = `<span class="qtag">${total}</span> <small>/ ${totalMax}</small>`;
    document.getElementById("totalPct").innerHTML = `${Math.round(pct)}<small>%</small>`;
    document.getElementById("totalHint").textContent = "This is based on the marks you entered.";
    document.getElementById("totalBand").textContent = overallBand(pct);

    // Content
    const contentScores = scoreByCategory(it => it.content);
    document.getElementById("contentBars").innerHTML = barsHtml(contentScores, CONTENT_INFO);

    // AO
    const aoScores = scoreByAO();
    const aoBarsObj = {};
    Object.entries(aoScores).forEach(([k,v])=> aoBarsObj[k]=v);
    document.getElementById("aoBars").innerHTML = barsHtml(aoBarsObj, AO_INFO);

    // Maths (exclude non-maths items)
    const mathScores = scoreByCategory(it => it.maths.length ? it.maths : ["(No maths strand)"]);
    const filteredMath = {};
    Object.entries(mathScores).forEach(([k,v])=>{
      if (k !== "(No maths strand)") filteredMath[k]=v;
    });
    document.getElementById("mathBars").innerHTML = barsHtml(filteredMath, MATH_INFO);

    // Strengths/Priorities from content strands
    const {top, bottom} = topBottom(contentScores, 3);
    document.getElementById("strengths").innerHTML = top.map(strengthLi).join("");
    document.getElementById("priorities").innerHTML = bottom.map(priorityLi).join("");

    // Plan (only auto-fill if empty OR user hasn't started writing)
    const planEl = document.getElementById("plan");
    if (!planEl.dataset.userEdited || planEl.value.trim().length === 0){
      planEl.value = buildPlan(contentScores, aoScores, filteredMath);
    }
  }

  // ---------- Controls ----------
  document.getElementById("btnUpdate").addEventListener("click", update);
  document.getElementById("btnClear").addEventListener("click", ()=>{
    ITEMS.forEach(it=> document.getElementById("m_"+it.id.replace('.','_')).value = 0);
    // Don't wipe name/grade/plan
    update();
  });
  document.getElementById("btnMax").addEventListener("click", ()=>{
    ITEMS.forEach(it=> document.getElementById("m_"+it.id.replace('.','_')).value = it.max);
    update();
  });
  document.getElementById("btnPrint").addEventListener("click", ()=> window.print());

  // Auto update on marks input, compact debounce
  let t = null;
  document.addEventListener("input", (e)=>{
    if (e.target && e.target.matches('input[type="number"]')){
      clearTimeout(t);
      t = setTimeout(update, 180);
    }
    if (e.target && e.target.id === "plan"){
      e.target.dataset.userEdited = "1";
    }
  });

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // Init
  renderRows();
  update();
</script>
</body>
</html>
