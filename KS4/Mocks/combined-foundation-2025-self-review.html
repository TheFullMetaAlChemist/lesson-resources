<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AQA Trilogy Chemistry Paper 1F (June 2025) – Question Level Analysis</title>
  <style>
    :root{
      --bg:#f6f8fc;
      --panel:#ffffff;
      --panel2:#f1f5ff;
      --text:#0f172a;
      --muted:#475569;
      --muted2:#64748b;
      --line:rgba(15,23,42,.10);
      --shadow: 0 10px 24px rgba(15,23,42,.08);
      --radius: 16px;
      --radius2: 20px;

      --accent:#2563eb;    /* blue */
      --accent2:#7c3aed;   /* purple */
      --good:#16a34a;      /* green */
      --warn:#d97706;      /* amber */
      --bad:#dc2626;       /* red */

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: var(--sans);
      background: radial-gradient(1000px 600px at 10% -10%, rgba(37,99,235,.10), transparent 60%),
                  radial-gradient(900px 500px at 90% 0%, rgba(124,58,237,.09), transparent 55%),
                  var(--bg);
      color: var(--text);
    }

    header{
      max-width: 1220px;
      margin: 0 auto;
      padding: 22px 18px 10px;
    }
    h1{
      margin:0;
      font-size: clamp(20px, 2.3vw, 30px);
      letter-spacing:.2px;
      line-height:1.15;
    }
    .sub{
      margin:8px 0 0;
      max-width: 980px;
      color: var(--muted);
      line-height:1.45;
      font-size: 13px;
    }

    main{
      max-width: 1220px;
      margin: 0 auto;
      padding: 10px 18px 60px;
      display:grid;
      grid-template-columns: 1.25fr .95fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
    }

    .card{
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardhead{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(241,245,255,.9), rgba(255,255,255,.7));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .cardhead h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .cardbody{ padding: 12px 14px 14px; }

    .btnrow{ display:flex; gap:8px; flex-wrap:wrap; }
    button{
      border:1px solid rgba(15,23,42,.16);
      background: #fff;
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 800;
      letter-spacing:.2px;
      box-shadow: 0 2px 0 rgba(15,23,42,.08);
      transition: transform .05s ease, background .2s ease, border-color .2s ease;
      font-size: 12.5px;
    }
    button:hover{ background: rgba(241,245,255,.75); border-color: rgba(15,23,42,.24); }
    button:active{ transform: translateY(1px); }
    button.primary{
      background: linear-gradient(180deg, rgba(37,99,235,.12), rgba(37,99,235,.06));
      border-color: rgba(37,99,235,.28);
    }

    .tablewrap{
      overflow:auto;
      border-radius: 14px;
      border:1px solid rgba(15,23,42,.10);
      background: #fff;
    }
    table{
      border-collapse: collapse;
      width:100%;
      min-width: 880px;
      font-size: 12.8px;
    }
    th, td{
      padding: 9px 9px;
      border-bottom: 1px solid rgba(15,23,42,.08);
      vertical-align: middle;
    }
    th{
      text-align:left;
      color: var(--muted2);
      font-weight: 900;
      letter-spacing:.25px;
      background: rgba(241,245,255,.8);
      position: sticky;
      top:0;
      z-index:2;
    }
    tr:hover td{ background: rgba(241,245,255,.45); }

    .qtag{
      font-family: var(--mono);
      font-weight: 900;
      font-size: 12px;
      color: rgba(15,23,42,.92);
      letter-spacing:.2px;
      white-space: nowrap;
    }
    .small{
      color: var(--muted2);
      font-size: 12px;
      line-height:1.25;
    }

    .badgetray{ display:flex; gap:6px; flex-wrap:wrap; }
    .badge{
      font-size: 10.5px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,.14);
      color: rgba(15,23,42,.86);
      background: rgba(241,245,255,.60);
      white-space: nowrap;
      font-weight: 800;
    }
    .badge.ao1{ border-color: rgba(124,58,237,.24); background: rgba(124,58,237,.07); }
    .badge.ao2{ border-color: rgba(37,99,235,.24); background: rgba(37,99,235,.07); }
    .badge.ao3{ border-color: rgba(22,163,74,.22); background: rgba(22,163,74,.06); }

    input[type="number"]{
      width: 78px;
      padding: 7px 9px;
      border-radius: 12px;
      border:1px solid rgba(15,23,42,.16);
      background: #fff;
      color: var(--text);
      font-weight: 900;
      outline: none;
      font-size: 13px;
    }
    input[type="number"]:focus{
      border-color: rgba(37,99,235,.45);
      box-shadow: 0 0 0 4px rgba(37,99,235,.12);
    }

    .statgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 540px){
      .statgrid{ grid-template-columns: 1fr; }
    }
    .stat{
      padding: 10px 10px;
      border-radius: 16px;
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(241,245,255,.55);
    }
    .stat .k{ color: var(--muted2); font-size: 12px; font-weight: 900; }
    .stat .v{ font-size: 18px; font-weight: 950; margin-top: 4px; letter-spacing:.2px; }
    .stat .v small{ font-size: 12px; color: var(--muted2); font-weight: 900; }

    .meter{
      height: 9px;
      background: rgba(15,23,42,.08);
      border-radius: 999px;
      overflow: hidden;
      border:1px solid rgba(15,23,42,.08);
    }
    .meter > i{ display:block; height:100%; width:0%; background: linear-gradient(90deg, rgba(37,99,235,.95), rgba(124,58,237,.85)); }
    .meter.good > i{ background: linear-gradient(90deg, rgba(22,163,74,.95), rgba(37,99,235,.75)); }
    .meter.warn > i{ background: linear-gradient(90deg, rgba(217,119,6,.95), rgba(37,99,235,.60)); }
    .meter.bad  > i{ background: linear-gradient(90deg, rgba(220,38,38,.95), rgba(124,58,237,.55)); }

    .list{
      margin: 8px 0 0;
      padding: 0;
      list-style: none;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .li{
      border:1px solid rgba(15,23,42,.10);
      background: rgba(241,245,255,.55);
      border-radius: 16px;
      padding: 9px 9px;
      display:flex;
      align-items:flex-start;
      gap:10px;
    }
    .li b{ font-size: 12.8px; }
    .li .mini{ color: var(--muted2); font-size: 11.7px; margin-top:2px; line-height:1.25; }
    .ico{
      width: 26px;
      height: 26px;
      border-radius: 10px;
      display:grid;
      place-items:center;
      background: rgba(37,99,235,.08);
      border:1px solid rgba(37,99,235,.18);
      flex: 0 0 auto;
      font-weight: 950;
      font-family: var(--mono);
      color: rgba(15,23,42,.88);
    }
    .ico.g{ background: rgba(22,163,74,.08); border-color: rgba(22,163,74,.18); }
    .ico.w{ background: rgba(217,119,6,.08); border-color: rgba(217,119,6,.18); }
    .ico.r{ background: rgba(220,38,38,.08); border-color: rgba(220,38,38,.18); }

    .fields{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-bottom: 10px;
    }
    @media (max-width: 540px){
      .fields{ grid-template-columns: 1fr; }
    }
    .field{
      border:1px solid rgba(15,23,42,.10);
      background: rgba(241,245,255,.55);
      border-radius: 16px;
      padding: 10px 10px;
    }
    .field label{
      display:block;
      color: var(--muted2);
      font-size: 12px;
      font-weight: 900;
      margin-bottom: 6px;
    }
    input[type="text"]{
      width:100%;
      padding: 9px 10px;
      border-radius: 12px;
      border:1px solid rgba(15,23,42,.16);
      background: #fff;
      color: var(--text);
      font-weight: 900;
      outline: none;
      font-size: 13px;
    }
    input[type="text"]:focus{
      border-color: rgba(124,58,237,.45);
      box-shadow: 0 0 0 4px rgba(124,58,237,.12);
    }

    .reportGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top: 10px;
      align-items:start;
    }
    @media (max-width: 980px){
      .reportGrid{ grid-template-columns: 1fr; }
    }
    .sectionTitle{
      margin:0 0 8px;
      font-size: 13px;
      letter-spacing:.2px;
      font-weight: 950;
      color: rgba(15,23,42,.92);
    }

    textarea{
      width:100%;
      min-height: 190px;
      resize: vertical;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(15,23,42,.12);
      background: #fff;
      color: var(--text);
      line-height: 1.35;
      outline:none;
      font-size: 13px;
    }
    textarea:focus{
      border-color: rgba(124,58,237,.45);
      box-shadow: 0 0 0 4px rgba(124,58,237,.12);
    }

    /* Print: hide inputs, start with results, keep 2 columns to save pages */
    @media print{
      body{ background:#fff; }
      header{ display:none !important; }
      main{
        max-width: 980px;
        margin:0;
        padding:0;
        grid-template-columns: 1fr;
      }
      #inputCard{ display:none !important; }
      .card{ box-shadow:none; border:1px solid #ddd; }
      .cardhead{ background:#f5f7ff; border-bottom:1px solid #ddd; }
      .badge, .li, .stat, .field{ background:#fff; border:1px solid #ddd; }
      .meter{ background:#eee; border-color:#ddd; }
      .meter > i{ background:#444 !important; }
      button{ display:none !important; }
      .reportGrid{ grid-template-columns: 1fr 1fr; }
      textarea{ min-height: 230px; }
    }
  </style>
</head>
<body>

<header>
  <h1>AQA Trilogy Chemistry Paper 1F (June 2025) – Question Level Analysis</h1>
  <p class="sub">
    Enter your marks for each sub-question. The report gives feedback on <b>content strands</b> (mid-granularity),
    plus a <b>skills audit</b> (AO1/AO2/AO3 + maths + practical/WS skills), and a printable revision plan.
  </p>
</header>

<main>
  <!-- Inputs -->
  <section class="card" id="inputCard">
    <div class="cardhead">
      <h2>1) Enter your marks</h2>
      <div class="btnrow">
        <button type="button" id="btnClear">Clear</button>
        <button type="button" id="btnMax">Fill with max</button>
        <button type="button" class="primary" id="btnUpdate">Update analysis</button>
      </div>
    </div>
    <div class="cardbody">
      <div class="tablewrap">
        <table>
          <thead>
            <tr>
              <th style="width:95px;">Sub-Q</th>
              <th>Focus</th>
              <th style="width:70px;">Max</th>
              <th style="width:130px;">Your marks</th>
              <th style="width:280px;">Skills tags</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
      <p class="small" style="margin:10px 0 0;">
        Tip: for multi-mark questions, enter the number of marks you got (e.g. 0–6).
      </p>
    </div>
  </section>

  <!-- Results -->
  <aside class="card" id="reportCard">
    <div class="cardhead">
      <h2>2) Results & revision plan</h2>
      <div class="btnrow">
        <button type="button" class="primary" id="btnPrint">Print summary</button>
      </div>
    </div>

    <div class="cardbody" id="report">
      <div class="fields">
        <div class="field">
          <label for="studentName">Student name</label>
          <input id="studentName" type="text" placeholder="e.g. Alex Turner" />
        </div>
        <div class="field">
          <label for="studentGrade">Mock grade / score</label>
          <input id="studentGrade" type="text" placeholder="e.g. 5 or 44/70" />
        </div>
      </div>

      <div class="statgrid">
        <div class="stat">
          <div class="k">Total score</div>
          <div class="v" id="totalScore">–</div>
          <div class="small" id="totalHint">Enter marks to see your total.</div>
        </div>
        <div class="stat">
          <div class="k">Overall percentage</div>
          <div class="v" id="totalPct">–</div>
          <div class="small" id="totalBand"></div>
        </div>
      </div>

      <div class="reportGrid">
        <div>
          <h3 class="sectionTitle">Content strands</h3>
          <div id="contentBars"></div>

          <div style="margin-top:10px;">
            <h3 class="sectionTitle">Your top strengths</h3>
            <ul class="list" id="strengths"></ul>
          </div>

          <div style="margin-top:10px;">
            <h3 class="sectionTitle">Your priorities</h3>
            <ul class="list" id="priorities"></ul>
          </div>
        </div>

        <div>
          <h3 class="sectionTitle">AO skills audit</h3>
          <div id="aoBars"></div>

          <div style="margin-top:10px;">
            <h3 class="sectionTitle">Maths skills audit</h3>
            <div id="mathBars"></div>
          </div>

          <div style="margin-top:10px;">
            <h3 class="sectionTitle">Practical / Working scientifically</h3>
            <div id="wsBars"></div>
          </div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <h3 class="sectionTitle">Revision plan (editable)</h3>
        <textarea id="plan" placeholder="Write at least 3 clear action points:
• What will you revise?
• How will you practise it?
• When will you check progress?"></textarea>
        <div class="small" style="margin-top:6px;">
          This plan prints with your name and grade at the top.
        </div>
      </div>

      <div style="margin-top:10px;">
        <h3 class="sectionTitle">What to do next</h3>
        <div class="small" id="nextSteps">
          Use the model answers file to correct missed marks. Then practise your weakest strands using short, targeted questions.
        </div>
      </div>
    </div>
  </aside>
</main>

<script>
  // --------- Mid-granularity strand descriptions ----------
  const CONTENT_INFO = {
    "Atomic structure basics": "Particles in atoms, nucleus, charges, atomic number.",
    "Isotopes & relative atomic mass": "Using isotope data to calculate relative atomic mass (weighted mean + rounding).",
    "Electron configuration": "Writing electron configurations for atoms/ions (e.g., 2,6).",
    "Ionic lattice models": "Evaluating how models represent ionic lattices (3D, scale, repetition).",

    "Periodic table basics & metallic bonding": "Symbols, metals, delocalised electrons and metallic structure ideas.",
    "Particle diagrams & states": "Interpreting particle models for elements/compounds and states (solid/liquid/gas).",
    "Carbon structures": "Identifying allotropes and linking structure to properties.",
    "Formula mass & bonding electrons": "Mr calculations and counting shared electrons in covalent bonds.",
    "Ionic naming & noble gases": "Naming ionic compounds (e.g., nitride) and stability of noble gases.",

    "Oxidation in terms of oxygen": "Oxidation as gain of oxygen; word equations for reactions with oxygen.",
    "Mass change calculations & explanations": "Using mass data and explaining increases/decreases using gases entering/leaving.",
    "Data handling (anomalies & mean)": "Spotting anomalies, calculating a mean, improving reliability.",
    "Evaluating methods": "Explaining limitations/choices in methods and why results may differ.",

    "Reactivity & extraction basics": "Metals as compounds, reduction/extraction linked to reactivity.",
    "Aluminium electrolysis basics": "Cryolite, energy, anode reactions in aluminium extraction.",
    "Alloys & hardness": "How alloys differ from pure metals and why they are harder/stronger.",
    "Describing trends from graphs": "Using graph values to describe trends and changes clearly.",

    "Improving methods (neutralisation)": "Improving accuracy/reliability (volumes, repeats/mean, endpoint judgement).",
    "Neutralisation, pH & ions": "pH 7 neutral, neutralisation, acids contain H+.",
    "Making salts (nitrates)": "Choosing the correct acid/alkali to make a named salt.",
    "Reaction profiles": "Interpreting reaction profiles and labelling axes/energy changes.",
    "Filtration": "Separating excess solid from solution; residue vs filtrate.",
    "Metal + acid reactions": "Recognising metals reacting with acids to make salts + hydrogen.",

    "Electrolysis practical risk control": "Risk reduction for chlorine; safe working.",
    "Graph plotting & best fit": "Plotting points accurately and drawing a best-fit line.",
    "Using data to test a claim": "Using evidence to support/reject a statement about trends/changes.",
    "Concentration & unit conversion": "g/dm3 from mass and volume; cm3 to dm3 conversion.",
    "Reactivity applied to electrolysis products": "Predicting products using reactivity (e.g., H2 forms not K).",

    "Energy changes definition": "Exothermic definition: releases energy to surroundings, temperature rises.",
    "Percentage composition": "Calculating % by mass from formula mass and Ar values.",
    "Planning investigations": "IV/DV, control variables, method steps, repeats/mean, safety."
  };

  const AO_INFO = {
    "AO1":"Knowledge & understanding (definitions, facts, explanations).",
    "AO2":"Apply knowledge (calculations, equations, using models).",
    "AO3":"Analyse & evaluate (methods, evidence, interpreting models/data)."
  };

  const MATH_INFO = {
    "Weighted mean (Ar)": "Multiply each isotope mass by abundance, add, then divide by total; round correctly.",
    "Rounding (dp)": "Round to the required decimal places.",
    "Mr calculation": "Add Ar values using the formula (including brackets/subscripts).",
    "Subtraction (mass difference)": "Use subtraction correctly to find a mass from two measurements.",
    "Mean (average)": "Add results and divide by number of results (ignore anomalies if instructed).",
    "Anomalies": "Identify a point that does not fit the pattern/trend.",
    "Describe trend using data": "Use numbers from a graph/table to describe changes.",
    "Plotting points": "Accurate points with sensible scales and labelled axes.",
    "Line of best fit": "A single best-fit line/curve that matches the overall pattern.",
    "Units & conversions": "cm³ to dm³, and keeping units consistent.",
    "Ratio/scale-up": "Scaling from a small volume to 1 dm³ correctly.",
    "% composition": "(mass of element ÷ Mr) × 100."
  };

  const WS_INFO = {
    "Model evaluation":"Comparing model vs reality (3D lattice, scale, repetition).",
    "Method improvement":"Suggesting practical changes to increase accuracy/reliability.",
    "Filtration technique":"Choosing correct apparatus and identifying residue/filtrate.",
    "Risk control":"Identifying hazards and suitable control measures.",
    "Planning":"IV/DV, controls, method steps, repeats, safety.",
    "Reliability (repeat/mean)":"Repeats and means improve confidence in results.",
    "Data interpretation":"Using evidence from graphs/tables to make conclusions."
  };

  // --------- Sub-question map (Paper 1F June 2025) ----------
  // Each item: id, max, focus, ao, content (strand tags), maths tags, ws/practical tags
  const ITEMS = [
    // Q1 (11)
    {id:"1.1", max:1, focus:"First subatomic particle discovered (electron)", ao:{AO1:1}, content:["Atomic structure basics"], maths:[], ws:[]},
    {id:"1.2", max:1, focus:"Name the centre of the atom (nucleus)", ao:{AO1:1}, content:["Atomic structure basics"], maths:[], ws:[]},
    {id:"1.3", max:2, focus:"Charges of subatomic particles (matching)", ao:{AO1:2}, content:["Atomic structure basics"], maths:[], ws:[]},
    {id:"1.4", max:1, focus:"Atomic number definition (protons only)", ao:{AO1:1}, content:["Atomic structure basics"], maths:[], ws:[]},
    {id:"1.5", max:3, focus:"Relative atomic mass from isotope data (weighted mean, 1 dp)", ao:{AO2:3}, content:["Isotopes & relative atomic mass"], maths:["Weighted mean (Ar)","Rounding (dp)"], ws:[]},
    {id:"1.6", max:1, focus:"Electron configuration of oxygen (2,6)", ao:{AO2:1}, content:["Electron configuration"], maths:[], ws:[]},
    {id:"1.7", max:2, focus:"Limitations/advantages of ionic lattice models (3D, scale)", ao:{AO3:2}, content:["Ionic lattice models"], maths:[], ws:["Model evaluation"]},

    // Q2 (12)
    {id:"2.1", max:1, focus:"Symbol of lithium (Li)", ao:{AO1:1}, content:["Periodic table basics & metallic bonding"], maths:[], ws:[]},
    {id:"2.2", max:1, focus:"Metallic bonding: delocalised outer electrons", ao:{AO1:1}, content:["Periodic table basics & metallic bonding"], maths:[], ws:[]},
    {id:"2.3", max:3, focus:"Match substances to particle diagrams (Li, F2, LiF)", ao:{AO3:3}, content:["Particle diagrams & states"], maths:[], ws:["Data interpretation"]},
    {id:"2.4", max:1, focus:"Ionic conductivity pattern (LiF: poor solid/good liquid)", ao:{AO3:1}, content:["Particle diagrams & states"], maths:[], ws:["Data interpretation"]},
    {id:"2.5", max:1, focus:"Identify carbon allotrope from diagram (diamond)", ao:{AO1:1}, content:["Carbon structures"], maths:[], ws:[]},
    {id:"2.6", max:2, focus:"Mr of CF4 (formula mass)", ao:{AO2:2}, content:["Formula mass & bonding electrons"], maths:["Mr calculation"], ws:[]},
    {id:"2.7", max:1, focus:"Shared electrons in N≡N (6 / 3 pairs)", ao:{AO2:1}, content:["Formula mass & bonding electrons"], maths:[], ws:[]},
    {id:"2.8", max:1, focus:"Name Li3N (nitride)", ao:{AO2:1}, content:["Ionic naming & noble gases"], maths:[], ws:[]},
    {id:"2.9", max:1, focus:"Noble gas stability (neon stable arrangement)", ao:{AO1:1}, content:["Ionic naming & noble gases"], maths:[], ws:[]},

    // Q3 (9)
    {id:"3.1", max:1, focus:"Word equation: Mg + O2 → MgO", ao:{AO2:1}, content:["Oxidation in terms of oxygen"], maths:[], ws:[]},
    {id:"3.2", max:1, focus:"Redox language: Mg is oxidised", ao:{AO1:1}, content:["Oxidation in terms of oxygen"], maths:[], ws:[]},
    {id:"3.3", max:1, focus:"Mass of Mg by subtraction", ao:{AO2:1}, content:["Mass change calculations & explanations"], maths:["Subtraction (mass difference)"], ws:[]},
    {id:"3.4", max:1, focus:"Explain mass increase: solid + gas → solid", ao:{AO3:1}, content:["Mass change calculations & explanations"], maths:[], ws:["Data interpretation"]},
    {id:"3.5", max:1, focus:"Identify anomalous point on graph", ao:{AO3:1}, content:["Data handling (anomalies & mean)"], maths:["Anomalies"], ws:["Data interpretation"]},
    {id:"3.6", max:2, focus:"Calculate mean (average) result", ao:{AO2:2}, content:["Data handling (anomalies & mean)"], maths:["Mean (average)"], ws:["Reliability (repeat/mean)"]},
    {id:"3.7", max:1, focus:"Evaluate method: water bath not hot enough", ao:{AO3:1}, content:["Evaluating methods"], maths:[], ws:["Method improvement"]},
    {id:"3.8", max:1, focus:"Explain different results (incomplete reaction / not fully heated)", ao:{AO3:1}, content:["Evaluating methods"], maths:[], ws:["Data interpretation"]},

    // Q4 (8)
    {id:"4.1", max:1, focus:"Metals usually found as compounds", ao:{AO1:1}, content:["Reactivity & extraction basics"], maths:[], ws:[]},
    {id:"4.2", max:1, focus:"Iron less reactive than carbon → reduction works", ao:{AO1:1}, content:["Reactivity & extraction basics"], maths:[], ws:[]},
    {id:"4.3", max:1, focus:"Cryolite lowers melting point → less energy", ao:{AO1:1}, content:["Aluminium electrolysis basics"], maths:[], ws:[]},
    {id:"4.4", max:1, focus:"Anode reacts with oxygen gas (electrodes wear away)", ao:{AO1:1}, content:["Aluminium electrolysis basics"], maths:[], ws:[]},
    {id:"4.5", max:1, focus:"Alloy harder than pure metal", ao:{AO1:1}, content:["Alloys & hardness"], maths:[], ws:[]},
    {id:"4.6", max:3, focus:"Describe melting point changes with % silver using data", ao:{AO2:3}, content:["Describing trends from graphs"], maths:["Describe trend using data"], ws:["Data interpretation"]},

    // Q5 (11)
    {id:"5.1", max:2, focus:"Improve method for volume of alkali / reliability", ao:{AO3:2}, content:["Improving methods (neutralisation)"], maths:[], ws:["Method improvement","Reliability (repeat/mean)"]},
    {id:"5.2", max:1, focus:"Green UI = pH 7", ao:{AO1:1}, content:["Neutralisation, pH & ions"], maths:[], ws:[]},
    {id:"5.3", max:1, focus:"Acid + alkali = neutralisation", ao:{AO1:1}, content:["Neutralisation, pH & ions"], maths:[], ws:[]},
    {id:"5.4", max:1, focus:"All acids contain H+ ions", ao:{AO1:1}, content:["Neutralisation, pH & ions"], maths:[], ws:[]},
    {id:"5.5", max:1, focus:"Acid to make sodium nitrate with NaOH = nitric acid", ao:{AO2:1}, content:["Making salts (nitrates)"], maths:[], ws:[]},
    {id:"5.6", max:2, focus:"Reaction profile labels (A energy change; B progress of reaction)", ao:{AO1:2}, content:["Reaction profiles"], maths:[], ws:["Data interpretation"]},
    {id:"5.7", max:2, focus:"Filtration setup (separate excess solid; collect filtrate)", ao:{AO1:2}, content:["Filtration"], maths:[], ws:["Filtration technique"]},
    {id:"5.8", max:1, focus:"Metal reacting with HCl to make ZnCl2 + H2 = zinc", ao:{AO2:1}, content:["Metal + acid reactions"], maths:[], ws:[]},

    // Q6 (9)
    {id:"6.1", max:1, focus:"Reduce risk from chlorine gas (fume cupboard/ventilation)", ao:{AO3:1}, content:["Electrolysis practical risk control"], maths:[], ws:["Risk control"]},
    {id:"6.2", max:3, focus:"Plot 6 points + best fit line", ao:{AO2:3}, content:["Graph plotting & best fit"], maths:["Plotting points","Line of best fit"], ws:["Data interpretation"]},
    {id:"6.3", max:1, focus:"Use data to reject ‘constant increase every 60 s’", ao:{AO3:1}, content:["Using data to test a claim"], maths:["Describe trend using data"], ws:["Data interpretation"]},
    {id:"6.4", max:3, focus:"Concentration in g/dm3 (unit conversion + scale-up)", ao:{AO2:3}, content:["Concentration & unit conversion"], maths:["Units & conversions","Ratio/scale-up"], ws:[]},
    {id:"6.5", max:1, focus:"H2 forms at cathode in aqueous KCl because H less reactive than K", ao:{AO2:1}, content:["Reactivity applied to electrolysis products"], maths:[], ws:[]},

    // Q7 (10)
    {id:"7.1", max:1, focus:"Define exothermic reaction", ao:{AO1:1}, content:["Energy changes definition"], maths:[], ws:[]},
    {id:"7.2", max:3, focus:"% oxygen in Ca(OH)2", ao:{AO2:3}, content:["Percentage composition"], maths:["% composition"], ws:[]},
    {id:"7.3", max:6, focus:"Plan investigation: CaO mass vs temperature change", ao:{AO1:6}, content:["Planning investigations"], maths:[], ws:["Planning","Risk control","Reliability (repeat/mean)"]}
  ];

  // --------- Build input table ----------
  const rows = document.getElementById("rows");

  function badgeAO(aoKey){
    const cls = aoKey.toLowerCase();
    return `<span class="badge ${cls}">${aoKey}</span>`;
  }
  function badge(text){
    return `<span class="badge">${escapeHtml(text)}</span>`;
  }

  function renderRows(){
    rows.innerHTML = ITEMS.map(it => {
      const aoTags = Object.keys(it.ao).map(k => badgeAO(k)).join("");
      const otherTags = []
        .concat(it.maths.map(m => badge("Math: " + m)))
        .concat(it.ws.map(w => badge("WS: " + w)))
        .slice(0, 4)
        .join("");
      return `
        <tr>
          <td class="qtag">${it.id}</td>
          <td>
            <div style="font-weight:950;">${escapeHtml(it.focus)}</div>
            <div class="small">
              <span style="font-weight:900; color:rgba(15,23,42,.85);">Strand:</span>
              ${it.content.map(c => `<span style="color:var(--muted2);"> ${escapeHtml(c)} </span>`).join(" • ")}
            </div>
          </td>
          <td><span class="qtag">${it.max}</span></td>
          <td><input type="number" inputmode="numeric" min="0" max="${it.max}" step="1" id="m_${it.id.replace('.','_')}" value="0" /></td>
          <td><div class="badgetray">${aoTags}${otherTags}</div></td>
        </tr>
      `;
    }).join("");
  }

  // --------- Scoring helpers ----------
  const totalMax = ITEMS.reduce((a,b)=>a+b.max,0);

  function clamp(n, lo, hi){
    n = Number.isFinite(n) ? n : 0;
    return Math.max(lo, Math.min(hi, n));
  }

  function readMarks(){
    const marks = {};
    ITEMS.forEach(it=>{
      const el = document.getElementById("m_" + it.id.replace('.','_'));
      let v = parseInt(el.value, 10);
      if (Number.isNaN(v)) v = 0;
      v = clamp(v, 0, it.max);
      el.value = v;
      marks[it.id] = v;
    });
    return marks;
  }

  function pickMeterClass(pct){
    if (pct >= 75) return "good";
    if (pct >= 45) return "warn";
    return "bad";
  }

  function scoreByCategory(getCats){
    const marks = readMarks();
    const out = {};
    ITEMS.forEach(it=>{
      const got = marks[it.id] || 0;
      const cats = getCats(it);
      cats.forEach(cat=>{
        if(!out[cat]) out[cat] = {score:0, max:0, pct:0};
        out[cat].max += it.max;
        out[cat].score += got;
      });
    });
    Object.keys(out).forEach(cat=>{
      out[cat].pct = out[cat].max ? (out[cat].score/out[cat].max*100) : 0;
    });
    return out;
  }

  function scoreByAO(){
    const marks = readMarks();
    const out = {AO1:{score:0,max:0,pct:0}, AO2:{score:0,max:0,pct:0}, AO3:{score:0,max:0,pct:0}};
    ITEMS.forEach(it=>{
      const got = marks[it.id] || 0;
      const weights = it.ao;
      const denom = Object.values(weights).reduce((a,b)=>a+b,0) || 1;
      Object.entries(weights).forEach(([ao,w])=>{
        out[ao].max += w;
        out[ao].score += (got * (w/denom));
      });
    });
    Object.keys(out).forEach(ao=>{
      out[ao].pct = out[ao].max ? (out[ao].score/out[ao].max*100) : 0;
    });
    return out;
  }

  function barsHtml(obj, infoMap){
    const entries = Object.entries(obj)
      .sort((a,b)=> (b[1].pct - a[1].pct) || (b[1].max - a[1].max));
    return entries.map(([name, s])=>{
      const cls = pickMeterClass(s.pct);
      return `
        <div class="li" style="align-items:center;">
          <div class="ico ${cls==='good'?'g':cls==='warn'?'w':'r'}">${Math.round(s.pct)}</div>
          <div style="flex:1;">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
              <b>${escapeHtml(name)}</b>
              <span class="small"><span class="qtag">${round1(s.score)}</span> / ${s.max}</span>
            </div>
            <div class="meter ${cls}" style="margin-top:8px;"><i style="width:${clamp(s.pct,0,100)}%;"></i></div>
            <div class="mini">${escapeHtml(infoMap?.[name] || "")}</div>
          </div>
        </div>
      `;
    }).join("");
  }

  function topBottom(obj, n=3){
    const arr = Object.entries(obj).map(([k,v])=>({k,...v}));
    arr.sort((a,b)=> (b.pct - a.pct) || (b.max - a.max));
    const top = arr.slice(0,n);
    const bottom = arr.slice().reverse().slice(0,n).reverse();
    return {top, bottom};
  }

  function strengthLi(item){
    const cls = pickMeterClass(item.pct);
    const label = `${round1(item.score)}/${item.max} (${Math.round(item.pct)}%)`;
    return `
      <li class="li">
        <div class="ico ${cls==='good'?'g':cls==='warn'?'w':'r'}">★</div>
        <div>
          <b>${escapeHtml(item.k)}</b>
          <div class="mini">${escapeHtml(label)} — ${escapeHtml(CONTENT_INFO[item.k] || "")}</div>
        </div>
      </li>
    `;
  }

  function priorityLi(item){
    const cls = pickMeterClass(item.pct);
    const label = `${round1(item.score)}/${item.max} (${Math.round(item.pct)}%)`;
    return `
      <li class="li">
        <div class="ico ${cls==='good'?'g':cls==='warn'?'w':'r'}">!</div>
        <div>
          <b>${escapeHtml(item.k)}</b>
          <div class="mini">${escapeHtml(label)} — ${escapeHtml(CONTENT_INFO[item.k] || "")}</div>
        </div>
      </li>
    `;
  }

  function overallBand(pct){
    if (pct >= 85) return "Excellent — keep stretching with full explanations and checking units/steps.";
    if (pct >= 70) return "Strong — polish explanations and reduce avoidable slips.";
    if (pct >= 55) return "Secure — prioritise weaker strands and practise exam technique.";
    if (pct >= 40) return "Developing — focus on core ideas and repeat key question types.";
    return "Priority support — rebuild fundamentals and practise little-and-often.";
  }

  function buildPlan(contentScores, aoScores, mathScores, wsScores){
    const {bottom: weakContent} = topBottom(contentScores, 3);
    const {bottom: weakMath} = topBottom(mathScores, 2);
    const {bottom: weakWS} = topBottom(wsScores, 2);

    const aoArr = Object.entries(aoScores).map(([k,v])=>({k,...v})).sort((a,b)=>a.pct-b.pct);
    const weakestAO = aoArr[0];

    const lines = [];
    lines.push("Action plan (write at least 3 bullet points):");
    lines.push("");
    lines.push("1) Content strands to target:");
    weakContent.forEach(w=>{
      lines.push(`   • ${w.k} — redo the linked questions and write a full model answer without looking.`);
    });
    lines.push("");
    lines.push("2) Skills focus:");
    lines.push(`   • ${weakestAO.k}: ${AO_INFO[weakestAO.k]} — use Point → Explain → Evidence → Link for 2–6 mark answers.`);
    if (weakMath.length){
      lines.push("   • Maths practice:");
      weakMath.forEach(m=>{
        lines.push(`     – ${m.k}: ${MATH_INFO[m.k] || ""}`.trim());
      });
    }
    if (weakWS.length){
      lines.push("   • Practical/WS focus:");
      weakWS.forEach(w=>{
        lines.push(`     – ${w.k}: ${WS_INFO[w.k] || ""}`.trim());
      });
    }
    lines.push("");
    lines.push("3) Evidence of improvement:");
    lines.push("   • Correct the weakest 2 strands using the model answers, then retest after 3 days and 7 days.");
    lines.push("   • Bring corrected answers to your next lesson for feedback.");
    lines.push("");
    lines.push("Next check-in date: ____________________");
    return lines.join("\n");
  }

  function update(){
    const marks = readMarks();
    const total = Object.values(marks).reduce((a,b)=>a+b,0);
    const pct = totalMax ? (total/totalMax*100) : 0;

    document.getElementById("totalScore").innerHTML = `<span class="qtag">${total}</span> <small>/ ${totalMax}</small>`;
    document.getElementById("totalPct").innerHTML = `${Math.round(pct)}<small>%</small>`;
    document.getElementById("totalHint").textContent = "This is based on the marks you entered.";
    document.getElementById("totalBand").textContent = overallBand(pct);

    const contentScores = scoreByCategory(it => it.content);
    document.getElementById("contentBars").innerHTML = barsHtml(contentScores, CONTENT_INFO);

    const aoScores = scoreByAO();
    document.getElementById("aoBars").innerHTML = barsHtml(aoScores, AO_INFO);

    const mathScoresRaw = scoreByCategory(it => it.maths.length ? it.maths : ["(No maths strand)"]);
    const mathScores = {};
    Object.entries(mathScoresRaw).forEach(([k,v])=>{ if(k!=="(No maths strand)") mathScores[k]=v; });
    document.getElementById("mathBars").innerHTML = barsHtml(mathScores, MATH_INFO);

    const wsScoresRaw = scoreByCategory(it => it.ws.length ? it.ws : ["(No WS strand)"]);
    const wsScores = {};
    Object.entries(wsScoresRaw).forEach(([k,v])=>{ if(k!=="(No WS strand)") wsScores[k]=v; });
    document.getElementById("wsBars").innerHTML = barsHtml(wsScores, WS_INFO);

    const {top, bottom} = topBottom(contentScores, 3);
    document.getElementById("strengths").innerHTML = top.map(strengthLi).join("");
    document.getElementById("priorities").innerHTML = bottom.map(priorityLi).join("");

    const planEl = document.getElementById("plan");
    if (!planEl.dataset.userEdited || planEl.value.trim().length === 0){
      planEl.value = buildPlan(contentScores, aoScores, mathScores, wsScores);
    }
  }

  // --------- Controls ----------
  document.getElementById("btnUpdate").addEventListener("click", update);
  document.getElementById("btnClear").addEventListener("click", ()=>{
    ITEMS.forEach(it => document.getElementById("m_"+it.id.replace('.','_')).value = 0);
    update();
  });
  document.getElementById("btnMax").addEventListener("click", ()=>{
    ITEMS.forEach(it => document.getElementById("m_"+it.id.replace('.','_')).value = it.max);
    update();
  });
  document.getElementById("btnPrint").addEventListener("click", ()=> window.print());

  let t = null;
  document.addEventListener("input", (e)=>{
    if (e.target && e.target.matches('input[type="number"]')){
      clearTimeout(t);
      t = setTimeout(update, 160);
    }
    if (e.target && e.target.id === "plan"){
      e.target.dataset.userEdited = "1";
    }
  });

  function round1(x){ return Math.round(x*10)/10; }
  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // Init
  renderRows();
  update();
</script>
</body>
</html>
