<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCSE Chemistry: Instrumental Methods & Flame Emission Spectroscopy</title>
    <style>
        /* Basic Reset & Body Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #f4f7f6;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align top for longer content */
            min-height: 100vh;
            padding: 20px;
        }

        /* Main Container */
        .container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 100%;
            max-width: 950px; /* Slightly wider */
            margin-top: 20px; /* Add margin top */
            margin-bottom: 20px;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            background-color: #005a87; /* Professional blue */
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }

        .tab-button {
            padding: 15px 18px; /* Adjust padding slightly */
            cursor: pointer;
            background-color: #005a87;
            color: #ffffff;
            border: none;
            outline: none;
            font-size: 0.95em; /* Slightly smaller for more tabs */
            transition: background-color 0.3s ease;
            flex-grow: 1; /* Make buttons fill space */
            text-align: center;
            border-bottom: 3px solid transparent;
            min-width: 100px; /* Ensure buttons don't get too small */
        }

        .tab-button:hover {
            background-color: #0077b3;
        }

        .tab-button.active {
            background-color: #ffffff;
            color: #005a87;
            border-bottom: 3px solid #f39c12; /* Highlight color */
        }

        /* Tab Content Panes */
        .tab-content {
            padding: 25px 30px;
            min-height: 480px; /* Ensure consistent height */
            display: none; /* Hide all tabs by default */
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block; /* Show active tab */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Headings and Text */
        h1, h2, h3 {
            color: #005a87;
            margin-bottom: 15px;
        }
        h1 { font-size: 1.8em; text-align: center; margin-bottom: 20px;}
        h2 { font-size: 1.5em; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        h3 { font-size: 1.2em; }

        p { margin-bottom: 15px; }
        ul, ol { margin-left: 25px; margin-bottom: 15px; }
        li { margin-bottom: 8px; }
        strong { color: #004160; }
        code { background-color: #e8e8e8; padding: 2px 5px; border-radius: 3px; font-family: Consolas, monospace;}

        /* Interactive Elements & Buttons */
        .button, button.game-option { /* Apply styles also to game buttons */
            display: inline-block;
            background-color: #f39c12; /* Orange accent */
            color: #ffffff;
            padding: 10px 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color 0.3s ease, transform 0.1s ease;
            margin-top: 10px;
            margin-right: 10px;
            vertical-align: middle; /* Align buttons better */
        }
        .button:hover, button.game-option:hover {
            background-color: #d8890b;
            transform: translateY(-1px);
        }
        .button:active, button.game-option:active {
             transform: translateY(0px);
        }
        button:disabled { /* Style for disabled buttons */
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: 5px;
            font-weight: bold;
            display: none; /* Hidden initially */
            border: 1px solid transparent;
        }
        .feedback.correct {
            background-color: #d4edda; color: #155724; border-color: #c3e6cb; display: block;
        }
        .feedback.incorrect {
            background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; display: block;
        }
        .feedback.info { /* For general info feedback */
             background-color: #fff3cd; color: #856404; border-color: #ffeeba; display: block;
        }

        /* --- Specific Section Styles --- */

        /* Advantages Section */
        .advantages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Adjust minmax */
            gap: 20px;
            margin-top: 20px;
        }
        .advantage-card {
            background-color: #e7f3f8; padding: 20px; border-radius: 8px; border-left: 5px solid #0077b3;
            display: flex; flex-direction: column;
        }
        .advantage-card h3 { margin-bottom: 10px; color: #005a87; font-size: 1.1em;}
        .advantage-card p { font-size: 0.95em; flex-grow: 1;} /* Allow text to fill space */

        /* FES Section - Original Diagram */
        .fes-diagram {
            display: flex; flex-direction: column; align-items: center; gap: 15px;
            margin: 25px 0; padding: 20px; background-color: #f0f0f0; border-radius: 8px;
        }
        .flame-animation-container { width: 100px; height: 150px; position: relative; margin: 0 auto 10px auto; display: flex; justify-content: center; align-items: flex-end; }
        .bunsen-burner { width: 30px; height: 50px; background-color: #aaa; border-radius: 5px 5px 0 0; position: relative; z-index: 1; }
        .bunsen-burner::before { content: ''; position: absolute; bottom: -10px; left: -10px; width: 50px; height: 10px; background-color: #888; border-radius: 3px; }
        .flame { width: 40px; height: 100px; background: linear-gradient(to top, rgba(0, 191, 255, 0.7), rgba(135, 206, 250, 0.8)); border-radius: 50% 50% 0 0 / 80% 80% 0 0; position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); animation: flicker 0.5s infinite alternate; transition: background 0.5s ease; z-index: 0; }
        @keyframes flicker { 0% { transform: translateX(-50%) scaleY(1) scaleX(1); opacity: 0.9; } 50% { transform: translateX(-50%) scaleY(1.05) scaleX(1.02); opacity: 1; } 100% { transform: translateX(-50%) scaleY(0.98) scaleX(0.98); opacity: 0.85; } }
        .spectroscope-box { width: 120px; height: 60px; background-color: #555; color: white; display: flex; justify-content: center; align-items: center; border-radius: 5px; font-size: 0.9em; text-align: center; }
        .line-spectrum { width: 100%; max-width: 300px; height: 40px; background: black; position: relative; margin-top: 10px; border-radius: 3px; overflow: hidden; }
        .spectrum-line { position: absolute; top: 0; bottom: 0; width: 3px; /* Width of the spectral line */ }
        /* Example spectrum line colors and positions (percentage) - Keep these consistent */
        .line-na-1 { background-color: #ffd700; left: 50%; } .line-na-2 { background-color: #ffd700; left: 51%; }
        .line-k-1 { background-color: #dda0dd; left: 30%; } .line-k-2 { background-color: #ff0000; left: 75%; }
        .line-li-1 { background-color: #ff0000; left: 65%; }
        .line-cu-1 { background-color: #00ff00; left: 40%; } .line-cu-2 { background-color: #0000ff; left: 60%; }
        .line-ca-1 { background-color: #ff4500; left: 58%; } .line-ca-2 { background-color: #ff8c00; left: 62%; }
        .metal-buttons button { margin: 5px; }

        /* --- NEW FES Atomic Animation Section --- */
        #fes-atomic-animation {
            margin-top: 30px; padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #f9f9f9; text-align: center;
        }
        .atom-container {
            width: 250px; height: 250px; margin: 20px auto; position: relative; border: 0px dashed #ddd; /* For visual aid during dev */
        }
        .atom-nucleus {
            width: 30px; height: 30px; background-color: #005a87; border-radius: 50%;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; font-size: 0.8em;
        }
        .energy-level {
            border: 2px solid #ccc; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        .level-1 { width: 100px; height: 100px; }
        .level-2 { width: 170px; height: 170px; }
        .level-3 { width: 240px; height: 240px; }
        .electron {
            width: 15px; height: 15px; background-color: #f39c12; border-radius: 50%;
            position: absolute; top: 50%; left: 50%;
            /* Initial position on level 1 (e.g., top) */
            transform: translate(-50%, -50px); /* 50px = radius of level-1 */
            transition: transform 0.8s ease-in-out; /* Smooth transition for jump */
        }
        .heat-input {
            position: absolute; top: 60%; left: -20px; font-size: 2.5em; color: #ff4500; opacity: 0;
            animation: pulse-heat 1.5s ease-out forwards; /* Forwards keeps final state */
            animation-play-state: paused; /* Start paused */
        }
        .photon {
            width: 12px; height: 12px; border-radius: 50%;
            position: absolute; top: 50%; left: 50%;
            /* Start near excited electron position */
            transform: translate(72.5px, -35px); /* Approx. on level 3 after jump up */
            opacity: 0;
            /* Different animation for emission */
            animation: emit-light 1s ease-out forwards;
            animation-play-state: paused;
        }
         .photon.red { background: radial-gradient(circle, white 10%, #ff0000 70%); box-shadow: 0 0 8px #ff0000; }
         .photon.yellow { background: radial-gradient(circle, white 10%, #ffd700 70%); box-shadow: 0 0 8px #ffd700; }
         .photon.green { background: radial-gradient(circle, white 10%, #00ff00 70%); box-shadow: 0 0 8px #00ff00; }

         .annotation {
            position: absolute; background: rgba(255, 255, 255, 0.8); padding: 5px 8px; border-radius: 4px; font-size: 0.9em; opacity: 0; transition: opacity 0.5s ease; text-align: left;
         }
         #annotation-heat { top: 10%; left: 5%; }
         #annotation-jump { top: 10%; right: 5%; }
         #annotation-fall { bottom: 10%; right: 5%; }
         #annotation-emit { bottom: 10%; left: 5%; }

        /* Animation Keyframes */
        @keyframes pulse-heat {
             0% { opacity: 0; transform: scale(0.8); }
             50% { opacity: 0.8; transform: scale(1.1); }
             100% { opacity: 0; transform: scale(1); } /* Fade out heat symbol */
        }

        /* Keyframes for electron jump - NOW CONTROLLED BY JS CLASS TOGGLE */
        /* No keyframe needed, just transition on .electron */

        @keyframes emit-light {
            0% { opacity: 1; transform: translate(72.5px, -35px) scale(1); } /* Start near excited pos */
            100% { opacity: 0; transform: translate(150px, -80px) scale(0.5); } /* Move away and fade */
        }

        /* --- Interpreting Results Section --- */
        .spectra-comparison { display: flex; flex-direction: column; gap: 25px; margin-top: 20px; }
        .spectrum-display { background: #f9f9f9; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .spectrum-display h4 { margin-bottom: 10px; color: #333; font-size: 1em;}

        /* --- Quiz Section --- */
        .quiz-question { background-color: #e7f3f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid #0077b3; }
        .quiz-question p { margin-bottom: 10px; font-weight: bold; }
        .quiz-options label { display: block; margin-bottom: 8px; cursor: pointer; padding: 5px; border-radius: 4px; transition: background-color 0.2s; }
        .quiz-options label:hover { background-color: #d0e8f2; }
        .quiz-options input[type="radio"] { margin-right: 10px; vertical-align: middle;}
        .quiz-feedback { margin-top: 10px; font-style: italic; padding-left: 5px;}
        #quiz-result { font-size: 1.2em; font-weight: bold; margin-top: 25px; text-align: center; }

        /* --- Game Section --- */
        #game-area { text-align: center; }
        #game-spectrum-display { width: 80%; max-width: 400px; height: 50px; background: black; position: relative; margin: 25px auto; border-radius: 5px; overflow: hidden; border: 1px solid #555; }
        #game-options { margin-top: 15px; margin-bottom: 15px; min-height: 40px; }
        #game-feedback { margin-top: 15px; font-weight: bold; min-height: 25px; /* Prevent layout shift */ }
        #game-score { margin-top: 10px; font-size: 1.1em; color: #005a87;}

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body { padding: 0;} /* Remove body padding */
             .container { border-radius: 0; margin: 0; max-width: 100%; box-shadow: none; }
            .tab-nav { flex-direction: row; overflow-x: auto; /* Allow horizontal scroll if needed */ }
            .tab-button { flex-grow: 0; /* Don't force fill */ flex-shrink: 0; /* Don't shrink */}
             .tab-content { padding: 20px 15px;}
             .advantages-grid { grid-template-columns: 1fr; /* Stack cards */ }
             .atom-container { width: 200px; height: 200px;} /* Scale down animation */
             .level-1 { width: 80px; height: 80px; }
             .level-2 { width: 130px; height: 130px; }
             .level-3 { width: 180px; height: 180px; }
             .electron { width: 12px; height: 12px; transform: translate(-50%, -40px);} /* Adjust initial pos */
             .photon { width: 10px; height: 10px;}
             h1 { font-size: 1.6em;}
             h2 { font-size: 1.3em;}
        }
         @media (max-width: 480px) {
             .tab-button { font-size: 0.85em; padding: 12px 10px;}
             .button, button.game-option { padding: 8px 12px; font-size: 0.9em;}
             #game-spectrum-display { height: 40px; }
             .atom-container { width: 180px; height: 180px;} /* Further scale down animation */
             .level-1 { width: 70px; height: 70px; }
             .level-2 { width: 110px; height: 110px; }
             .level-3 { width: 150px; height: 150px; }
             .electron { width: 10px; height: 10px; transform: translate(-50%, -35px);} /* Adjust initial pos */
             .photon { width: 8px; height: 8px;}
             .annotation { font-size: 0.8em;}
         }

    </style>
</head>
<body>

    <div class="container">
        <nav class="tab-nav">
            <button class="tab-button active" data-tab="intro">Introduction</button>
            <button class="tab-button" data-tab="advantages">Advantages</button>
            <button class="tab-button" data-tab="fes">Flame Emission Spectroscopy</button>
            <button class="tab-button" data-tab="results">Interpreting Results</button>
            <button class="tab-button" data-tab="quiz">Quiz</button>
            <button class="tab-button" data-tab="game">Game</button>
        </nav>

        <!-- Introduction Tab -->
        <div id="intro" class="tab-content active">
            <h1>Welcome to Instrumental Methods!</h1>
            <p>In chemistry, we often need to figure out exactly what substances are present in a sample (qualitative analysis) and how much of each substance there is (quantitative analysis).</p>
            <p>While you've learned about chemical tests (like using litmus paper or testing for gases), scientists often use sophisticated machines for this job. These techniques are called <strong>Instrumental Methods</strong>.</p>

            <h2>What are Instrumental Methods?</h2>
            <p>Instrumental methods use specialised equipment (instruments) to analyse samples. These instruments measure physical or chemical properties of the substance, such as:</p>
            <ul>
                <li>How it interacts with light (like in spectroscopy)</li>
                <li>Its mass</li>
                <li>Its electrical properties</li>
            </ul>
            <p>These measurements allow us to <strong>detect</strong> (find out if something is there) and <strong>identify</strong> (work out exactly what it is) elements and compounds very effectively.</p>
            <p><strong>Key takeaway:</strong> Instrumental methods use machines to analyse substances, providing detailed information about their composition.</p>

            <div class="interactive-check">
                <h3>Quick Check</h3>
                <p>Which of the following best describes an instrumental method?</p>
                <select id="intro-q1" style="padding: 5px; margin-right: 5px; min-width: 200px;">
                    <option value="">-- Select an answer --</option>
                    <option value="incorrect">Adding acid to a carbonate to see if it fizzes.</option>
                    <option value="correct">Using a machine that passes light through a sample to identify a metal.</option>
                    <option value="incorrect">Observing the colour change of universal indicator.</option>
                </select>
                <button class="button" onclick="checkAnswer('intro-q1', 'correct', 'intro-f1')">Check Answer</button>
                <div id="intro-f1" class="feedback"></div>
            </div>
        </div>

        <!-- Advantages Tab -->
        <div id="advantages" class="tab-content">
            <h1>Advantages of Instrumental Methods</h1>
            <p>Compared to the simple chemical tests you might do in the lab (like testing for gases or using indicators), instrumental methods offer significant advantages:</p>

            <div class="advantages-grid">
                <div class="advantage-card">
                    <h3>‚úÖ Accurate & Precise</h3>
                    <p>Instruments provide precise, numerical data. This removes subjective interpretation common in visual tests (e.g., judging subtle colour changes).</p>
                </div>
                <div class="advantage-card">
                    <h3>‚úÖ Highly Sensitive</h3>
                    <p>They can detect very tiny amounts (trace concentrations) of a substance, far smaller than what most simple chemical tests can reveal.</p>
                </div>
                <div class="advantage-card">
                    <h3>‚úÖ Rapid Analysis</h3>
                    <p>Analyses can often be performed very quickly, sometimes in seconds or minutes, allowing for efficient testing of many samples.</p>
                </div>
                 <div class="advantage-card">
                    <h3>‚úÖ Small Sample Size</h3>
                    <p>Often, only a minuscule amount of the sample is needed, preserving valuable or limited material.</p>
                </div>
                 <div class="advantage-card">
                    <h3>‚úÖ Automation & Data Logging</h3>
                    <p>Many instruments can run automatically and record results electronically, reducing human error and enabling continuous monitoring.</p>
                </div>
                 <div class="advantage-card">
                    <h3>‚úÖ Can Analyse Complex Mixtures</h3>
                    <p>Some instrumental methods can identify multiple components in a mixture simultaneously, which is difficult with simple tests.</p>
                </div>
            </div>

             <div class="interactive-check" style="margin-top: 25px;">
                <h3>Quick Check</h3>
                <p>A food safety lab needs to check for a tiny trace of a banned pesticide in hundreds of samples daily. Why is an instrumental method the best choice?</p>
                <select id="adv-q1" style="padding: 5px; margin-right: 5px; min-width: 200px;">
                    <option value="">-- Select an answer --</option>
                    <option value="incorrect">Because instrumental methods are cheaper to set up.</option>
                    <option value="incorrect">Because simple chemical tests are more sensitive.</option>
                    <option value="correct">Because they are sensitive (detect trace amounts), rapid (handle many samples), and can be automated.</option>
                     <option value="incorrect">Because instrumental methods use larger samples.</option>
                </select>
                <button class="button" onclick="checkAnswer('adv-q1', 'correct', 'adv-f1')">Check Answer</button>
                <div id="adv-f1" class="feedback"></div>
            </div>
        </div>

        <!-- Flame Emission Spectroscopy Tab -->
        <div id="fes" class="tab-content">
            <h1>Flame Emission Spectroscopy (FES)</h1>
            <p>Flame Emission Spectroscopy is a specific type of instrumental method used primarily to <strong>identify metal ions</strong> in solutions and often to measure their concentrations.</p>

            <h2>How FES Works: The Process</h2>
            <ol>
                <li><strong>Sample Introduction:</strong> A solution containing metal ions is sprayed into a hot flame.</li>
                <li><strong>Atomisation & Excitation:</strong> The heat evaporates the solvent and breaks down compounds, freeing metal atoms/ions. The intense heat energy excites electrons within these atoms/ions, causing them to jump to higher, unstable energy levels.</li>
                <li><strong>Emission:</strong> Excited electrons quickly fall back to lower, more stable energy levels. As they fall, they release the absorbed energy as photons (particles of light).</li>
                <li><strong>Specific Wavelengths:</strong> The energy difference between the high and low levels is fixed for a given electron transition in a specific element. This means the emitted photons have specific energies, corresponding to specific wavelengths (colours) of light. Each metal has a unique set of possible transitions, resulting in a unique pattern of emitted light.</li>
                <li><strong>Spectroscope/Detector:</strong> The light from the flame passes through a device (spectroscope or monochromator + detector) that separates the light by wavelength.</li>
                <li><strong>Line Spectrum:</strong> The separated light is detected, producing a <strong>line spectrum</strong> ‚Äì a series of sharp lines at specific wavelengths, unique to the metal(s) present.</li>
            </ol>

             <!-- NEW Atomic Level Animation -->
            <div id="fes-atomic-animation">
                <h3>Atomic Level View: Excitation & Emission</h3>
                <div class="atom-container">
                    <div class="atom-nucleus">Atom</div>
                    <div class="energy-level level-1"></div>
                    <div class="energy-level level-2"></div>
                    <div class="energy-level level-3"></div>
                    <div id="fes-electron" class="electron"></div>
                    <div id="heat-symbol" class="heat-input">üî•</div>
                    <div id="photon-emitted" class="photon"></div>

                    <!-- Annotations -->
                    <div id="annotation-heat" class="annotation">Heat energy absorbed</div>
                    <div id="annotation-jump" class="annotation">Electron jumps to higher energy level (excited state)</div>
                    <div id="annotation-fall" class="annotation">Electron falls back to lower energy level (ground state)</div>
                    <div id="annotation-emit" class="annotation">Photon of specific energy (light) emitted</div>
                </div>
                <button class="button" id="play-atomic-animation">Play Animation</button>
                 <select id="photon-color-select" style="padding: 5px; margin-left: 10px;">
                     <option value="red">Emit Red Light (e.g., Li)</option>
                     <option value="yellow">Emit Yellow Light (e.g., Na)</option>
                     <option value="green">Emit Green Light (e.g., Cu)</option>
                 </select>
                <p style="font-size: 0.9em; margin-top: 10px;">(Simplified model: shows one electron transition)</p>
            </div>

            <h2>Visualising the Instrument Output</h2>
            <p>The overall process from sample to spectrum:</p>
            <div class="fes-diagram">
                 <p>1. Sample enters flame & atoms emit light:</p>
                 <div class="flame-animation-container">
                     <div class="bunsen-burner"></div>
                     <div id="animated-flame" class="flame"></div>
                 </div>
                 <div class="metal-buttons">
                     <button class="button" onclick="setFlame('Na')">Sodium (Na)</button>
                     <button class="button" onclick="setFlame('K')">Potassium (K)</button>
                     <button class="button" onclick="setFlame('Li')">Lithium (Li)</button>
                     <button class="button" onclick="setFlame('Cu')">Copper (Cu)</button>
                     <button class="button" onclick="setFlame('Ca')">Calcium (Ca)</button>
                     <button class="button" onclick="setFlame('Default')">Reset</button>
                 </div>
                 <p style="font-size: 1.5em; margin: 5px 0;">‚¨áÔ∏è</p>
                 <p>2. Light collected & separated by spectroscope:</p>
                 <div class="spectroscope-box">Spectroscope / Detector</div>
                 <p style="font-size: 1.5em; margin: 5px 0;">‚¨áÔ∏è</p>
                 <p>3. Result: Unique Line Spectrum:</p>
                 <div id="animated-spectrum" class="line-spectrum">
                    <!-- Lines will be added here by JavaScript -->
                 </div>
            </div>
            <p>The positions of the lines identify the metal(s). The intensity (brightness) of the lines indicates the concentration.</p>

        </div>

        <!-- Interpreting Results Tab -->
        <div id="results" class="tab-content">
            <h1>Interpreting Flame Emission Spectra</h1>
            <p>The real power of FES comes from analysing the line spectrum produced. This allows for both qualitative (what's there?) and quantitative (how much?) analysis.</p>

            <h2>Identifying Metals (Qualitative Analysis)</h2>
            <p>Each metal element has a unique 'fingerprint' line spectrum ‚Äì a specific pattern of lines at characteristic wavelengths. To identify metals in an unknown sample:</p>
            <ol>
                <li>Obtain the line spectrum of the unknown sample using FES.</li>
                <li>Compare this spectrum to a database or chart of <strong>reference spectra</strong> for known elements (recorded using the same instrument and conditions).</li>
                <li>If the lines in the unknown sample's spectrum perfectly match the positions (wavelengths) of the lines in a reference spectrum for a particular metal, that metal is present in the sample.</li>
            </ol>
            <p>If lines matching multiple reference spectra are found, it indicates the presence of a mixture of those metals.</p>

            <h2>Example Comparison</h2>
            <p>Below are simplified reference line spectra for Lithium (Li), Sodium (Na), and Potassium (K), along with a spectrum from an 'Unknown Sample'.</p>

            <div class="spectra-comparison">
                <!-- Reference Spectra -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div class="spectrum-display">
                        <h4>Reference: Lithium (Li)</h4>
                        <div class="line-spectrum"><div class="spectrum-line line-li-1"></div></div>
                    </div>
                    <div class="spectrum-display">
                        <h4>Reference: Sodium (Na)</h4>
                        <div class="line-spectrum"><div class="spectrum-line line-na-1"></div><div class="spectrum-line line-na-2"></div></div>
                    </div>
                     <div class="spectrum-display">
                        <h4>Reference: Potassium (K)</h4>
                        <div class="line-spectrum"><div class="spectrum-line line-k-1"></div><div class="spectrum-line line-k-2"></div></div>
                    </div>
                </div>

                <hr style="border-top: 1px dashed #ccc; margin: 20px 0;">

                <!-- Unknown Sample -->
                <div class="spectrum-display" style="background-color: #fffadf;">
                    <h4>Unknown Sample Spectrum</h4>
                    <div class="line-spectrum">
                        <!-- Lines matching Sodium and Lithium -->
                        <div class="spectrum-line line-na-1" style="height: 100%;"></div>
                        <div class="spectrum-line line-na-2" style="height: 100%;"></div>
                        <div class="spectrum-line line-li-1" style="height: 60%; opacity: 0.8;"></div> <!-- Lower intensity Li line -->
                    </div>
                </div>
            </div>

            <div class="interactive-check" style="margin-top: 25px;">
                <h3>Identify the Metal(s)</h3>
                <p>Based on the comparison above, which metal(s) are present in the Unknown Sample?</p>
                <select id="res-q1" style="padding: 5px; margin-right: 5px; min-width: 200px;">
                    <option value="">-- Select an answer --</option>
                    <option value="incorrect">Only Lithium</option>
                    <option value="incorrect">Only Sodium</option>
                    <option value="correct">Lithium and Sodium</option>
                     <option value="incorrect">Potassium and Sodium</option>
                     <option value="incorrect">Only Potassium</option>
                </select>
                <button class="button" onclick="checkAnswer('res-q1', 'correct', 'res-f1')">Check Answer</button>
                <div id="res-f1" class="feedback"></div>
                <p id="res-f1-extra" style="display: none; margin-top: 10px; font-style: italic;">Correct! The lines in the unknown spectrum match the positions of the lines for both Sodium (strong yellow doublet) and Lithium (red line). Note the Lithium line is shown shorter/fainter, suggesting a lower concentration than Sodium.</p>
            </div>

            <h2>Measuring Concentration (Quantitative Analysis)</h2>
            <p>The <strong>intensity</strong> (brightness or measured signal strength) of a spectral line is directly related to the <strong>concentration</strong> of the metal ion that produced it. More ions in the flame mean more photons emitted at that wavelength, leading to a stronger signal.</p>
            <p>To find the exact concentration, chemists typically use a <strong>calibration curve</strong>. They prepare standard solutions with known concentrations of the metal, run them through the FES instrument, and plot a graph of line intensity vs. concentration. The intensity reading from the unknown sample can then be compared to this graph to determine its concentration.</p>

        </div>

        <!-- Quiz Tab -->
        <div id="quiz" class="tab-content">
            <h1>Check Your Understanding Quiz</h1>
            <p>Test your knowledge of instrumental methods and flame emission spectroscopy (10 Questions).</p>

            <form id="quiz-form">
                <!-- Q1 -->
                <div class="quiz-question">
                    <p>1. Which statement accurately describes a key advantage of instrumental methods like FES compared to simple chemical tests?</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q1" value="incorrect"> They require much larger sample volumes.</label>
                        <label><input type="radio" name="q1" value="correct"> They are generally more sensitive and can detect trace amounts.</label>
                        <label><input type="radio" name="q1" value="incorrect"> They rely on subjective colour observations.</label>
                        <label><input type="radio" name="q1" value="incorrect"> They are always slower but more thorough.</label>
                    </div>
                    <div class="quiz-feedback" id="q1-feedback"></div>
                </div>
                <!-- Q2 -->
                <div class="quiz-question">
                    <p>2. What is the primary purpose of the flame in Flame Emission Spectroscopy?</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q2" value="incorrect"> To melt the sample into a liquid.</label>
                        <label><input type="radio" name="q2" value="incorrect"> To chemically react with the metal ions.</label>
                        <label><input type="radio" name="q2" value="correct"> To provide energy to excite electrons in metal atoms/ions.</label>
                        <label><input type="radio" name="q2" value="incorrect"> To sterilise the sample before analysis.</label>
                    </div>
                     <div class="quiz-feedback" id="q2-feedback"></div>
                </div>
                <!-- Q3 -->
                <div class="quiz-question">
                    <p>3. When an excited electron in a metal atom falls back to a lower energy level, it releases energy in the form of:</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q3" value="incorrect"> Heat energy only</label>
                        <label><input type="radio" name="q3" value="incorrect"> Sound waves</label>
                        <label><input type="radio" name="q3" value="correct"> A photon (light) of specific energy/wavelength</label>
                        <label><input type="radio" name="q3" value="incorrect"> An electrical current</label>
                    </div>
                     <div class="quiz-feedback" id="q3-feedback"></div>
                </div>
                <!-- Q4 -->
                 <div class="quiz-question">
                    <p>4. The unique pattern of coloured lines produced by a specific metal element in FES is called its:</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q4" value="incorrect"> Continuous spectrum</label>
                        <label><input type="radio" name="q4" value="correct"> Line emission spectrum</label>
                        <label><input type="radio" name="q4" value="incorrect"> Absorption spectrum</label>
                        <label><input type="radio" name="q4" value="incorrect"> Flame colour chart</label>
                    </div>
                     <div class="quiz-feedback" id="q4-feedback"></div>
                </div>
                <!-- Q5 -->
                 <div class="quiz-question">
                    <p>5. How is a specific metal identified using the output from FES?</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q5" value="incorrect"> By measuring the total brightness of the flame.</label>
                        <label><input type="radio" name="q5" value="incorrect"> By analysing the shape of the spectral lines.</label>
                        <label><input type="radio" name="q5" value="correct"> By matching the pattern (wavelengths) of lines to known reference spectra.</label>
                        <label><input type="radio" name="q5" value="incorrect"> By weighing the ash produced in the flame.</label>
                    </div>
                     <div class="quiz-feedback" id="q5-feedback"></div>
                </div>
                 <!-- Q6 -->
                <div class="quiz-question">
                    <p>6. Instrumental methods are described as accurate, sensitive and rapid. What does 'sensitive' mean in this context?</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q6" value="incorrect"> The instrument is easily damaged.</label>
                        <label><input type="radio" name="q6" value="correct"> The instrument can detect very small quantities of a substance.</label>
                        <label><input type="radio" name="q6" value="incorrect"> The instrument gives results quickly.</label>
                        <label><input type="radio" name="q6" value="incorrect"> The instrument produces very precise numerical results.</label>
                    </div>
                    <div class="quiz-feedback" id="q6-feedback"></div>
                </div>
                 <!-- Q7 -->
                <div class="quiz-question">
                    <p>7. A sample analysed by FES produces lines matching the reference spectra for both Sodium (Na) and Potassium (K). What does this indicate?</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q7" value="incorrect"> The instrument is faulty.</label>
                        <label><input type="radio" name="q7" value="incorrect"> Only Sodium is present, Potassium lines are interference.</label>
                        <label><input type="radio" name="q7" value="correct"> Both Sodium ions and Potassium ions are present in the sample.</label>
                        <label><input type="radio" name="q7" value="incorrect"> The sample contains a compound of Sodium and Potassium.</label>
                    </div>
                    <div class="quiz-feedback" id="q7-feedback"></div>
                </div>
                 <!-- Q8 -->
                <div class="quiz-question">
                    <p>8. In FES, what does the intensity (brightness) of a specific spectral line generally indicate?</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q8" value="correct"> The concentration of the metal ion producing that line.</label>
                        <label><input type="radio" name="q8" value="incorrect"> The temperature of the flame.</label>
                        <label><input type="radio" name="q8" value="incorrect"> The identity of the metal ion.</label>
                        <label><input type="radio" name="q8" value="incorrect"> How long the analysis took.</label>
                    </div>
                    <div class="quiz-feedback" id="q8-feedback"></div>
                </div>
                 <!-- Q9 -->
                <div class="quiz-question">
                    <p>9. Which of these is NOT an advantage of instrumental methods?</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q9" value="incorrect"> Rapidity (speed)</label>
                        <label><input type="radio" name="q9" value="incorrect"> Accuracy</label>
                        <label><input type="radio" name="q9" value="incorrect"> Sensitivity</label>
                        <label><input type="radio" name="q9" value="correct"> Usually cheaper equipment than simple lab tests</label>
                    </div>
                    <div class="quiz-feedback" id="q9-feedback"></div>
                </div>
                 <!-- Q10 -->
                <div class="quiz-question">
                    <p>10. What device within an FES instrument is responsible for separating the emitted light into its different wavelengths?</p>
                    <div class="quiz-options">
                        <label><input type="radio" name="q10" value="correct"> Spectroscope (or monochromator)</label>
                        <label><input type="radio" name="q10" value="incorrect"> Flame detector</label>
                        <label><input type="radio" name="q10" value="incorrect"> Sample injector</label>
                        <label><input type="radio" name="q10" value="incorrect"> Computer display</label>
                    </div>
                    <div class="quiz-feedback" id="q10-feedback"></div>
                </div>

                <button type="button" class="button" onclick="submitQuiz()">Check All Answers</button>
                <div id="quiz-result"></div>
            </form>
        </div>

        <!-- Game Tab -->
        <div id="game" class="tab-content">
            <h1>Game: Match the Spectrum!</h1>
            <p>Identify the metal ion from its simplified line spectrum. Try to get as many right as possible!</p>

            <div id="game-area">
                <p><strong>Which metal ion produces this spectrum?</strong></p>
                <div id="game-spectrum-display">
                    <!-- Game spectrum lines appear here -->
                </div>
                <div id="game-options">
                    <!-- Buttons generated by JS -->
                </div>
                <div id="game-feedback"></div>
                <div id="game-score">Score: 0 / 0</div>
                <button class="button" id="next-spectrum-btn" onclick="startGame()">Next Spectrum</button>
            </div>
        </div>

    </div>

    <script>
        // --- Tab Navigation ---
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                const tabId = button.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // --- Simple Interactive Check Function ---
        function checkAnswer(selectId, correctAnswer, feedbackId) {
            const selectElement = document.getElementById(selectId);
            const feedbackElement = document.getElementById(feedbackId);
            const selectedValue = selectElement.value;

            feedbackElement.style.display = 'block'; // Ensure feedback is visible
            if (selectedValue === "") {
                 feedbackElement.textContent = "Please select an answer.";
                 feedbackElement.className = 'feedback info';
                 return;
            }

            if (selectedValue === correctAnswer) {
                feedbackElement.textContent = "Correct! Well done.";
                feedbackElement.className = 'feedback correct';
                if (feedbackId === 'res-f1') {
                    const extraInfo = document.getElementById('res-f1-extra');
                    if(extraInfo) extraInfo.style.display = 'block';
                }
            } else {
                feedbackElement.textContent = "Not quite. Check the information again.";
                feedbackElement.className = 'feedback incorrect';
                 if (feedbackId === 'res-f1') {
                     const extraInfo = document.getElementById('res-f1-extra');
                     if(extraInfo) extraInfo.style.display = 'none';
                 }
            }
        }


        // --- FES Flame and Spectrum Animation ---
        const animatedFlame = document.getElementById('animated-flame');
        const animatedSpectrum = document.getElementById('animated-spectrum');

        // Store metal data globally for access by FES and Game
        const metalData = {
            'Na': { name: 'Sodium', flame: 'linear-gradient(to top, rgba(255, 165, 0, 0.9), rgba(255, 215, 0, 1))', lines: ['line-na-1', 'line-na-2'] },
            'K':  { name: 'Potassium', flame: 'linear-gradient(to top, rgba(221, 160, 221, 0.8), rgba(255, 105, 180, 0.9))', lines: ['line-k-1', 'line-k-2'] },
            'Li': { name: 'Lithium', flame: 'linear-gradient(to top, rgba(255, 0, 0, 0.8), rgba(220, 20, 60, 0.9))', lines: ['line-li-1'] },
            'Cu': { name: 'Copper', flame: 'linear-gradient(to top, rgba(0, 255, 0, 0.8), rgba(60, 179, 113, 0.9))', lines: ['line-cu-1', 'line-cu-2'] },
            'Ca': { name: 'Calcium', flame: 'linear-gradient(to top, rgba(255, 69, 0, 0.8), rgba(255, 140, 0, 0.9))', lines: ['line-ca-1', 'line-ca-2'] },
            'Default': { name: 'Default', flame: 'linear-gradient(to top, rgba(0, 191, 255, 0.7), rgba(135, 206, 250, 0.8))', lines: [] }
        };

         function setFlame(metalKey) {
             const data = metalData[metalKey];
             if (animatedFlame && data) {
                 animatedFlame.style.background = data.flame;
                 updateSpectrumDisplay(animatedSpectrum, data.lines);
             }
         }

         function updateSpectrumDisplay(spectrumElement, lineClasses) {
             spectrumElement.innerHTML = ''; // Clear existing lines
             if (lineClasses && lineClasses.length > 0) {
                 lineClasses.forEach(lineClass => {
                     const lineDiv = document.createElement('div');
                     lineDiv.className = `spectrum-line ${lineClass}`;
                     spectrumElement.appendChild(lineDiv);
                 });
             }
         }
         // Initialize with default flame/spectrum
         setFlame('Default');

        // --- NEW FES Atomic Animation Logic ---
        const electron = document.getElementById('fes-electron');
        const heatSymbol = document.getElementById('heat-symbol');
        const photon = document.getElementById('photon-emitted');
        const playButton = document.getElementById('play-atomic-animation');
        const photonColorSelect = document.getElementById('photon-color-select');
        const annotations = {
            heat: document.getElementById('annotation-heat'),
            jump: document.getElementById('annotation-jump'),
            fall: document.getElementById('annotation-fall'),
            emit: document.getElementById('annotation-emit')
        };
        let isAnimating = false;

        function resetAtomicAnimation() {
            electron.style.transition = 'none'; // Disable transition for reset
            electron.style.transform = 'translate(-50%, -50px)'; // Reset position (level 1)
            photon.style.animation = 'none';
            photon.style.opacity = '0';
            heatSymbol.style.animation = 'none';
            heatSymbol.style.opacity = '0';
            Object.values(annotations).forEach(anno => anno.style.opacity = '0');
            // Force reflow/repaint before re-enabling transitions/animations
            void electron.offsetWidth;
            void photon.offsetWidth;
            void heatSymbol.offsetWidth;
            electron.style.transition = 'transform 0.8s ease-in-out'; // Re-enable
            isAnimating = false;
            playButton.disabled = false;
            playButton.textContent = "Play Animation";
        }

        playButton.addEventListener('click', () => {
            if (isAnimating) return;
            isAnimating = true;
            playButton.disabled = true;
            playButton.textContent = "Animating...";

            resetAtomicAnimation(); // Ensure clean start

            // Set photon color based on dropdown
            const selectedColor = photonColorSelect.value;
            photon.className = `photon ${selectedColor}`; // Set class for color/styling

            // Sequence the animation steps using timeouts
            setTimeout(() => { // 1. Show heat input
                heatSymbol.style.animation = 'pulse-heat 1.5s ease-out forwards';
                heatSymbol.style.animationPlayState = 'running';
                annotations.heat.style.opacity = '1';
            }, 100);

            setTimeout(() => { // 2. Electron jumps up (to level 3 example)
                annotations.heat.style.opacity = '0';
                electron.style.transform = 'translate(85px, -85px)'; // Move to ~level 3 position (adjust coords as needed)
                annotations.jump.style.opacity = '1';
            }, 800); // Start jump slightly before heat fades

            setTimeout(() => { // 3. Electron falls back (to level 1)
                annotations.jump.style.opacity = '0';
                 // Position photon near excited electron just before fall
                photon.style.transform = 'translate(72.5px, -35px)'; // Adjust start point if needed
                 // Use a different transition for the fall if desired, or same as jump
                electron.style.transform = 'translate(-50%, -50px)'; // Back to level 1
                annotations.fall.style.opacity = '1';
            }, 2000); // After jump completes

            setTimeout(() => { // 4. Photon emitted
                 annotations.fall.style.opacity = '0';
                 photon.style.animation = 'emit-light 1s ease-out forwards';
                 photon.style.animationPlayState = 'running';
                 annotations.emit.style.opacity = '1';
            }, 2200); // Shortly after fall starts

             setTimeout(() => { // 5. Clean up annotations and reset button
                 annotations.emit.style.opacity = '0';
                 resetAtomicAnimation(); // Reset for next play
            }, 3500); // After photon animation likely finishes
        });
         // Initialize animation state
         resetAtomicAnimation();

        // --- Quiz Logic ---
        const quizForm = document.getElementById('quiz-form');
        const quizResultDiv = document.getElementById('quiz-result');
        // Updated for 10 questions
        const correctAnswers = {
            q1: 'correct', q2: 'correct', q3: 'correct', q4: 'correct', q5: 'correct',
            q6: 'correct', q7: 'correct', q8: 'correct', q9: 'correct', q10: 'correct'
        };
        const totalQuestions = 10; // Updated total

        function submitQuiz() {
            let score = 0;
            let allAnswered = true;
            quizResultDiv.textContent = ''; // Clear previous result

            for (let i = 1; i <= totalQuestions; i++) {
                const qName = `q${i}`;
                const selectedAnswer = quizForm.elements[qName].value;
                const feedbackDiv = document.getElementById(`${qName}-feedback`);

                if (selectedAnswer) {
                    feedbackDiv.style.display = 'block'; // Show feedback area
                    if (selectedAnswer === correctAnswers[qName]) {
                        score++;
                        feedbackDiv.textContent = "Correct!";
                        feedbackDiv.style.color = 'green';
                    } else {
                        feedbackDiv.textContent = "Incorrect.";
                        feedbackDiv.style.color = 'red';
                    }
                } else {
                    allAnswered = false;
                    feedbackDiv.textContent = "Please select an answer.";
                    feedbackDiv.style.color = 'orange';
                    feedbackDiv.style.display = 'block'; // Show feedback area
                }
            }

            if (allAnswered) {
                quizResultDiv.textContent = `Your Score: ${score} out of ${totalQuestions}`;
                quizResultDiv.style.color = (score / totalQuestions) >= 0.7 ? 'green' : 'red'; // Color score based on performance
            } else {
                 quizResultDiv.textContent = `Please answer all questions before submitting.`;
                 quizResultDiv.style.color = 'orange';
            }
        }

        // --- Game Logic ---
        const gameSpectrumDisplay = document.getElementById('game-spectrum-display');
        const gameOptionsDiv = document.getElementById('game-options');
        const gameFeedbackDiv = document.getElementById('game-feedback');
        const gameScoreDiv = document.getElementById('game-score');
        const nextSpectrumBtn = document.getElementById('next-spectrum-btn');

        let gameMetals = ['Na', 'K', 'Li', 'Cu', 'Ca'];
        let currentGameMetalKey = '';
        let lastGameMetalKey = ''; // Keep track of the previous metal
        let gameScore = 0;
        let gameAttempts = 0;
        let optionsLocked = false;

        function startGame() {
            optionsLocked = false;
            nextSpectrumBtn.disabled = true; // Disable 'Next' until answer is checked
            gameFeedbackDiv.textContent = '';
            gameFeedbackDiv.className = 'feedback'; // Reset feedback style
            gameOptionsDiv.innerHTML = ''; // Clear previous buttons

            // --- Improved Selection Logic ---
            let possibleMetals = gameMetals.filter(metal => metal !== lastGameMetalKey); // Exclude last metal
            if (possibleMetals.length === 0) { // If only one metal left (or in case of small pool)
                possibleMetals = gameMetals; // Fallback to full list
            }
            currentGameMetalKey = possibleMetals[Math.floor(Math.random() * possibleMetals.length)];
            lastGameMetalKey = currentGameMetalKey; // Remember for next round
            // --- End Improvement ---

            // Display its spectrum
            updateSpectrumDisplay(gameSpectrumDisplay, metalData[currentGameMetalKey].lines);

            // Create shuffled answer buttons
            let options = [...gameMetals]; // Copy the array
            options.sort(() => Math.random() - 0.5); // Shuffle

            options.forEach(metalKey => {
                const button = document.createElement('button');
                button.textContent = metalData[metalKey].name; // Show full name
                button.className = 'button game-option';
                button.onclick = () => checkGameAnswer(metalKey);
                gameOptionsDiv.appendChild(button);
            });
        }

        function checkGameAnswer(selectedMetalKey) {
            if (optionsLocked) return;
            optionsLocked = true;
            gameAttempts++;

            const correct = selectedMetalKey === currentGameMetalKey;
            const correctMetalName = metalData[currentGameMetalKey].name;

            if (correct) {
                gameScore++;
                gameFeedbackDiv.textContent = `Correct! It's ${correctMetalName}.`;
                gameFeedbackDiv.className = 'feedback correct';
            } else {
                gameFeedbackDiv.textContent = `Not quite. That was the spectrum for ${correctMetalName}.`;
                gameFeedbackDiv.className = 'feedback incorrect';
            }
            gameScoreDiv.textContent = `Score: ${gameScore} / ${gameAttempts}`;

            // Highlight correct button and disable all
            document.querySelectorAll('.game-option').forEach(btn => {
                btn.disabled = true;
                 // Check button text content against the *name* of the correct metal
                 if (btn.textContent === correctMetalName) {
                     btn.style.backgroundColor = '#28a745'; // Green highlight for correct one
                     btn.style.borderColor = '#28a745';
                 } else {
                     btn.style.opacity = '0.7'; // Fade incorrect ones slightly
                 }
            });
            nextSpectrumBtn.disabled = false; // Enable 'Next' button
        }

        // Initialize Game on load
        window.addEventListener('load', startGame);

    </script>

</body>
</html>
