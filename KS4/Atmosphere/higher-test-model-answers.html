<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GCSE Chemistry – C13 The Earth’s Atmosphere | Model Answers</title>
  <style>
    :root{
      --bg: #f6f7fb;
      --card: #ffffff;
      --ink: #0f172a;
      --muted: #475569;
      --muted2:#64748b;
      --line: #e5e7eb;
      --tab: #f8fafc;
      --tabHover: #eef2ff;
      --active: #2563eb;
      --shadow: 0 10px 24px rgba(2, 6, 23, 0.08);
      --radius: 16px;
      --focus: 0 0 0 3px rgba(37, 99, 235, 0.25);
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background: radial-gradient(1200px 600px at 15% 0%, #eef2ff 0%, transparent 55%),
                  radial-gradient(900px 500px at 85% 10%, #ecfeff 0%, transparent 55%),
                  var(--bg);
      color: var(--ink);
      line-height: 1.55;
      font-size: 18px; /* accessible base */
    }

    .wrap{
      max-width: 1100px;
      margin: 32px auto;
      padding: 0 18px 48px;
    }

    /* Header */
    .header{
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 18px;
      margin-bottom: 18px;
    }

    .brand{
      display: flex;
      align-items: center;
      gap: 14px;
      min-width: 280px;
    }

    .badge{
      width: 56px;
      height: 56px;
      border-radius: 14px;
      background: linear-gradient(135deg, #dbeafe, #cffafe);
      border: 1px solid rgba(37, 99, 235, 0.18);
      display: grid;
      place-items: center;
      box-shadow: 0 8px 18px rgba(2, 6, 23, 0.08);
    }

    .badge svg{ width: 30px; height: 30px; }

    h1{
      margin: 0;
      font-size: 30px;
      letter-spacing: -0.02em;
    }

    .subtitle{
      margin: 2px 0 0;
      color: var(--muted);
      font-size: 15px;
    }

    .infoCard{
      background: rgba(255,255,255,0.9);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px 16px;
      box-shadow: var(--shadow);
      min-width: 280px;
    }
    .infoTitle{
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0 0 6px;
      font-weight: 700;
      font-size: 16px;
    }
    .infoTitle span.icon{
      width: 28px; height: 28px;
      border-radius: 10px;
      background: #eff6ff;
      border: 1px solid rgba(37,99,235,.18);
      display: grid;
      place-items: center;
      color: var(--active);
      flex: 0 0 auto;
    }
    .infoText{
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    /* Tabs */
    .tabsBar{
      background: rgba(255,255,255,0.85);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .tabsTop{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 12px 0;
      border-bottom: 1px solid var(--line);
    }

    .search{
      flex: 1;
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--tab);
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 10px 12px;
      min-width: 240px;
    }
    .search input{
      width: 100%;
      border: 0;
      outline: none;
      background: transparent;
      font-size: 15px;
      color: var(--ink);
    }
    .search svg{ width: 18px; height: 18px; color: var(--muted2); }

    .controls{
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn{
      appearance: none;
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 999px;
      padding: 10px 12px;
      font-size: 14px;
      color: var(--ink);
      cursor: pointer;
      transition: transform .04s ease, background .15s ease, border-color .15s ease;
      white-space: nowrap;
    }
    .btn:hover{ background: #f8fafc; }
    .btn:active{ transform: translateY(1px); }
    .btn:focus-visible{ outline: none; box-shadow: var(--focus); }

    .tabsRow{
      display: flex;
      gap: 8px;
      padding: 12px;
      overflow-x: auto;
      scrollbar-width: thin;
    }
    .tabsRow::-webkit-scrollbar{ height: 10px; }
    .tabsRow::-webkit-scrollbar-thumb{ background: #dbeafe; border-radius: 999px; }

    .tab{
      border: 1px solid var(--line);
      background: var(--tab);
      color: var(--muted);
      padding: 10px 12px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: background .15s ease, border-color .15s ease, color .15s ease;
      flex: 0 0 auto;
    }
    .tab:hover{ background: var(--tabHover); border-color: rgba(37,99,235,.25); }
    .tab[aria-selected="true"]{
      background: #eff6ff;
      color: var(--active);
      border-color: rgba(37,99,235,.35);
    }
    .tab:focus-visible{ outline: none; box-shadow: var(--focus); }

    /* Panel */
    .panel{
      padding: 18px 18px 22px;
    }

    .questionTitle{
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin: 0 0 10px;
    }
    .questionTitle h2{
      margin: 0;
      font-size: 22px;
      letter-spacing: -0.01em;
    }
    .marks{
      font-size: 13px;
      color: var(--muted2);
      background: #f8fafc;
      border: 1px solid var(--line);
      padding: 6px 10px;
      border-radius: 999px;
      white-space: nowrap;
    }

    .prompt{
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 16px;
    }

    .cards{
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 900px){
      .cards{ grid-template-columns: 1fr 1fr 1fr; }
    }

    details.card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: 0 6px 18px rgba(2, 6, 23, 0.06);
      overflow: hidden;
    }

    details.card summary{
      list-style: none;
      cursor: pointer;
      padding: 14px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-weight: 800;
      font-size: 15px;
      user-select: none;
    }
    details.card summary::-webkit-details-marker{ display:none; }

    .chip{
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .dot{
      width: 12px;
      height: 12px;
      border-radius: 999px;
      background: #cbd5e1;
      border: 1px solid rgba(2,6,23,.08);
    }
    .dot.answer{ background: #bfdbfe; }
    .dot.explain{ background: #a7f3d0; }
    .dot.miscon{ background: #fecaca; }

    .chev{
      width: 22px; height: 22px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      background: #f1f5f9;
      border: 1px solid var(--line);
      color: var(--muted2);
      flex: 0 0 auto;
      transition: transform .18s ease;
    }
    details[open] .chev{ transform: rotate(180deg); }

    .cardBody{
      padding: 0 14px 14px;
      border-top: 1px solid var(--line);
      color: var(--ink);
      font-size: 16px;
    }
    .cardBody p{ margin: 12px 0 0; color: var(--muted); }
    .cardBody .strong{
      color: var(--ink);
      font-weight: 800;
    }

    .footerNote{
      margin-top: 14px;
      padding: 14px 16px;
      background: rgba(255,255,255,0.8);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      color: var(--muted);
      font-size: 14px;
    }

    /* Utility */
    .hidden{ display:none !important; }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce){
      *{ scroll-behavior: auto !important; transition: none !important; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="header">
      <div class="brand">
        <div class="badge" aria-hidden="true" title="Chemistry">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M10 2h4v3l3.5 5.5A8 8 0 1 1 6.5 10.5L10 5V2Z" stroke="#2563eb" stroke-width="1.6" stroke-linejoin="round"/>
            <path d="M9 10.5h6" stroke="#0ea5e9" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M8.2 13.3c1.2 1 2.6 1.5 3.8 1.5 1.2 0 2.6-.5 3.8-1.5" stroke="#10b981" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>Chemistry</h1>
          <p class="subtitle">GCSE Chemistry – AQA Higher • C13: The Earth’s atmosphere • Model answers</p>
        </div>
      </div>

      <div class="infoCard" role="note" aria-label="How to use this page">
        <div class="infoTitle">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none">
              <path d="M12 17v-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M12 7h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
              <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke="currentColor" stroke-width="1.5"/>
            </svg>
          </span>
          Study multiple questions
        </div>
        <p class="infoText">
          Click a question tab, then reveal the <strong>Model answer</strong>, <strong>Explanation</strong>, and <strong>Common misconceptions</strong>.
        </p>
      </div>
    </div>

    <section class="tabsBar" aria-label="Question tabs and content">
      <div class="tabsTop">
        <div class="search" role="search" aria-label="Search questions">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.7"/>
            <path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
          </svg>
          <input id="searchInput" type="search" placeholder="Search (e.g. greenhouse, combustion, oxygen...)" autocomplete="off" />
        </div>

        <div class="controls">
          <button class="btn" id="expandAllBtn" type="button">Expand all (this question)</button>
          <button class="btn" id="collapseAllBtn" type="button">Collapse all</button>
        </div>
      </div>

      <div class="tabsRow" role="tablist" aria-label="Questions">
        <!-- Tabs injected by JS -->
      </div>

      <div class="panel" id="panel" role="tabpanel" tabindex="0" aria-label="Selected question content">
        <!-- Content injected by JS -->
      </div>
    </section>

    <div class="footerNote">
      Tip: For exam corrections, try to write your own answer first, then reveal the model answer and compare using the misconceptions list.
    </div>
  </div>

  <script>
    const QUESTIONS = [
      {
        id: "q1-1",
        tab: "1.1",
        title: "Q1.1",
        marks: "1 mark",
        prompt: "How much carbon dioxide was in the atmosphere 3 billion years ago?",
        keywords: ["graph", "carbon dioxide", "3 billion years", "percentage", "atmosphere"],
        answer: "About <strong>50%</strong>.",
        explanation: "From the graph, carbon dioxide levels were around half of the atmosphere 3 billion years ago.",
        misconceptions: [
          "Reading the wrong point on the graph (e.g. modern values instead of 3 billion years ago).",
          "Misreading the axis scale (especially percentage).",
          "Giving an over-precise value when an estimate is expected."
        ]
      },
      {
        id: "q1-2",
        tab: "1.2",
        title: "Q1.2",
        marks: "2 marks",
        prompt: "Use words/phrases from the box to complete the sentences (carbon dioxide decreased by ________ ; decreased by formation of ________).",
        keywords: ["photosynthesis", "sedimentary rock", "respiration", "volcanic", "algae", "plants", "limestone"],
        answer: "<strong>photosynthesis</strong>; <strong>sedimentary rock</strong>.",
        explanation: "Algae and plants remove carbon dioxide by photosynthesis. Carbon dioxide is also locked away in sedimentary rocks (e.g. limestone).",
        misconceptions: [
          "Choosing <em>respiration</em> (it releases CO₂).",
          "Choosing <em>volcanic rock</em> (volcanoes are linked with releasing gases).",
          "Writing a correct idea but not using the exact word/phrase from the box."
        ]
      },
      {
        id: "q1-3",
        tab: "1.3",
        title: "Q1.3",
        marks: "1 mark",
        prompt: "Define the term carbon footprint.",
        keywords: ["carbon footprint", "life cycle", "greenhouse gases", "product", "service", "event"],
        answer: "The <strong>total amount of greenhouse gases emitted</strong> over the <strong>full life cycle</strong> of a product, service, or event.",
        explanation: "A life cycle includes raw materials, manufacturing, transport, use, and disposal. (Often written as CO₂e.)",
        misconceptions: [
          "Only mentioning one stage (e.g. transport only).",
          "Defining it as just “carbon dioxide” rather than all greenhouse gases (CO₂e).",
          "Using vague language like “pollution” without referring to emissions over the life cycle."
        ]
      },
      {
        id: "q1-4",
        tab: "1.4",
        title: "Q1.4",
        marks: "3 marks",
        prompt: "3.25 kg of plastic has a carbon footprint of 6.50 kg CO₂e. Calculate the carbon footprint of a 32 g plastic bottle.",
        keywords: ["calculate", "CO2e", "plastic", "grams", "kilograms", "proportion", "ratio"],
        answer: "<strong>0.064 kg CO₂e</strong>.",
        explanation:
          "3.25 kg → 6.50 kg CO₂e, so 1 kg → 2.0 kg CO₂e. Convert 32 g to 0.032 kg, then 0.032 × 2.0 = 0.064 kg CO₂e.",
        misconceptions: [
          "Not converting 32 g to kilograms (0.032 kg).",
          "Setting up the proportion incorrectly.",
          "Missing working and losing method marks even if the final answer is close."
        ]
      },
      {
        id: "q1-5",
        tab: "1.5",
        title: "Q1.5",
        marks: "1 mark",
        prompt: "Give one way to reduce the carbon footprint of manufacturing plastic bottles.",
        keywords: ["reduce", "manufacture", "recycled", "use less plastic", "energy"],
        answer: "Use <strong>recycled plastic</strong> (or use <strong>less plastic</strong> to make each bottle).",
        explanation: "Recycled plastic usually needs less energy than producing plastic from crude oil, reducing emissions.",
        misconceptions: [
          "Giving a vague answer (“be greener”) without a specific method.",
          "Describing disposal (recycling after use) rather than manufacturing."
        ]
      },
      {
        id: "q2-1",
        tab: "2.1",
        title: "Q2.1",
        marks: "2 marks",
        prompt: "Name two greenhouse gases in Earth’s atmosphere.",
        keywords: ["greenhouse gases", "methane", "carbon dioxide", "water vapour", "nitrogen oxides"],
        answer: "<strong>Carbon dioxide</strong> and <strong>methane</strong>. (Water vapour and nitrogen oxides are also acceptable.)",
        explanation: "Greenhouse gases absorb infrared radiation, helping to trap heat in the atmosphere.",
        misconceptions: [
          "Naming oxygen or nitrogen (not greenhouse gases).",
          "Mixing up nitrogen gas (N₂) with nitrogen oxides (NOx)."
        ]
      },
      {
        id: "q2-2",
        tab: "2.2",
        title: "Q2.2",
        marks: "6 marks",
        prompt: "Explain how human activities are causing an increase in average global temperatures.",
        keywords: ["greenhouse effect", "infrared", "short-wave", "long-wave", "combustion", "deforestation", "methane", "landfill", "farming"],
        answer:
          "Humans increase greenhouse gases. Burning fossil fuels and deforestation increase <strong>CO₂</strong>, and farming/landfill increase <strong>methane</strong>. " +
          "Short-wave radiation from the Sun passes through the atmosphere and is absorbed by Earth. It is re-emitted as long-wave <strong>infrared</strong>, " +
          "which greenhouse gases absorb. More greenhouse gases means more energy is trapped, so global temperatures rise (global warming), contributing to climate change.",
        explanation:
          "To access the top marks, you must link: (1) human causes → (2) more greenhouse gases → (3) radiation steps (short-wave in, IR out) → (4) more IR absorbed → (5) warming.",
        misconceptions: [
          "Stating causes (cars, factories) but not explaining the greenhouse mechanism.",
          "Saying greenhouse gases “let heat in” rather than trapping heat leaving as infrared.",
          "Confusing ozone depletion with the greenhouse effect."
        ]
      },
      {
        id: "q2-3",
        tab: "2.3",
        title: "Q2.3",
        marks: "1 mark",
        prompt: "Name one way climate change is affecting the planet.",
        keywords: ["effects", "extreme weather", "ice caps", "sea level", "ecosystems"],
        answer: "For example: <strong>melting polar ice caps</strong> / <strong>sea level rise</strong> / <strong>more extreme weather events</strong> / <strong>ecosystem changes</strong>.",
        explanation: "Higher global temperatures change weather patterns and melt land ice, which can raise sea levels and disrupt ecosystems.",
        misconceptions: [
          "Giving a cause (e.g. burning fossil fuels) instead of an effect.",
          "Being too vague (“it gets hotter”) without a clear real-world effect."
        ]
      },
      {
        id: "q2-4",
        tab: "2.4",
        title: "Q2.4",
        marks: "2 marks",
        prompt: "Explain why it is difficult to accurately predict the effects of climate change.",
        keywords: ["models", "complex", "systems", "uncertainty", "variables"],
        answer: "Climate is a <strong>complex system</strong> with many interacting variables, so scientists rely on <strong>simplified models</strong>, which introduces uncertainty.",
        explanation: "Even small changes in one factor (oceans, clouds, ice, land use) can affect others, so predictions have a range rather than a single exact outcome.",
        misconceptions: [
          "Saying “scientists don’t know” without explaining complexity and modelling limits.",
          "Claiming models are “guesses” (they are evidence-based but uncertain)."
        ]
      },
      {
        id: "q3-1",
        tab: "3.1",
        title: "Q3.1",
        marks: "1 mark",
        prompt: "What is the dependent variable in this experiment?",
        keywords: ["dependent variable", "temperature", "oxygen supply", "experiment"],
        answer: "<strong>Flame temperature</strong>.",
        explanation: "The dependent variable is what you measure. Oxygen supply is what you change (independent variable).",
        misconceptions: [
          "Swapping dependent and independent variables.",
          "Answering “oxygen supply” even though it was the variable changed."
        ]
      },
      {
        id: "q3-2",
        tab: "3.2",
        title: "Q3.2",
        marks: "3 marks",
        prompt: "Calculate the mean flame temperature for limited oxygen.",
        keywords: ["mean", "average", "anomaly", "calculation", "temperature"],
        answer: "<strong>978 °C</strong>.",
        explanation: "(845 + 855 + 1234) ÷ 3 = 978. (Trial 3 is much higher and could be an anomaly, but the question asks for the mean of the three trials.)",
        misconceptions: [
          "Forgetting to divide by 3.",
          "Adding incorrectly.",
          "Excluding a value without being asked (unless the mark scheme specifically instructs it)."
        ]
      },
      {
        id: "q3-3",
        tab: "3.3",
        title: "Q3.3",
        marks: "1 mark",
        prompt: "The combustion of 1.0 kg of propane produces more carbon dioxide than 1.0 kg of methane. Suggest why.",
        keywords: ["propane", "methane", "carbon content", "percentage", "CO2"],
        answer: "Propane has a <strong>higher percentage of carbon</strong> than methane.",
        explanation: "More carbon atoms per molecule means more CO₂ formed when the fuel burns completely.",
        misconceptions: [
          "Talking about temperature or flame size instead of composition.",
          "Saying “propane is heavier” without linking to carbon content."
        ]
      },
      {
        id: "q3-4",
        tab: "3.4",
        title: "Q3.4",
        marks: "1 mark",
        prompt: "Balance the symbol equation for the incomplete combustion of propane.",
        keywords: ["balance", "equation", "incomplete combustion", "carbon monoxide", "carbon", "coefficients"],
        answer: "<strong>2C₃H₈ + 7O₂ → 2CO₂ + 8H₂O + 2CO + 2C</strong>",
        explanation: "Balancing means conserving atoms: count C, H, and O on both sides and choose coefficients so totals match.",
        misconceptions: [
          "Leaving out carbon monoxide (CO) or solid carbon (C).",
          "Only balancing some atoms (e.g. H but not O).",
          "Changing subscripts instead of coefficients."
        ]
      },
      {
        id: "q3-5",
        tab: "3.5",
        title: "Q3.5",
        marks: "1 mark",
        prompt: "Name one environmental problem that solid carbon particles produce.",
        keywords: ["carbon particles", "soot", "global dimming", "pollution"],
        answer: "<strong>Global dimming</strong>.",
        explanation: "Soot particles scatter sunlight, reducing the amount reaching Earth’s surface.",
        misconceptions: [
          "Confusing global dimming with the greenhouse effect.",
          "Naming “acid rain” (more linked to SO₂/NOx)."
        ]
      },
      {
        id: "q4-1",
        tab: "4.1",
        title: "Q4.1",
        marks: "2 marks",
        prompt: "Explain the main change to the amount of oxygen in Earth’s atmosphere.",
        keywords: ["oxygen", "photosynthesis", "algae", "plants", "early atmosphere"],
        answer: "Oxygen levels <strong>increased</strong> after algae and plants evolved and began <strong>photosynthesis</strong>, releasing oxygen into the atmosphere.",
        explanation: "Photosynthesis produces oxygen as a product, so oxygen built up over time.",
        misconceptions: [
          "Saying volcanoes produced oxygen.",
          "Not mentioning photosynthesis as the reason oxygen rose."
        ]
      },
      {
        id: "q4-2",
        tab: "4.2",
        title: "Q4.2",
        marks: "2 marks",
        prompt: "Explain the environmental impact of the main gases in air reacting together in car engines.",
        keywords: ["nitrogen", "oxygen", "nitrogen oxides", "NOx", "acid rain", "car engines"],
        answer: "Nitrogen and oxygen react at high temperatures in engines to form <strong>nitrogen oxides</strong>. Nitrogen oxides can cause <strong>acid rain</strong>.",
        explanation: "NOx gases dissolve in rainwater to form acids, damaging plants and buildings and harming aquatic life.",
        misconceptions: [
          "Talking about CO₂ here instead of nitrogen oxides.",
          "Not linking NOx to acid rain (or giving only “air pollution” with no specific impact)."
        ]
      }
    ];

    const tabRow = document.querySelector(".tabsRow");
    const panel = document.getElementById("panel");
    const searchInput = document.getElementById("searchInput");
    const expandAllBtn = document.getElementById("expandAllBtn");
    const collapseAllBtn = document.getElementById("collapseAllBtn");

    let filtered = [...QUESTIONS];
    let activeId = filtered[0]?.id ?? null;

    function escapeHTML(str){
      const div = document.createElement("div");
      div.textContent = str;
      return div.innerHTML;
    }

    function makeTab(q){
      const btn = document.createElement("button");
      btn.className = "tab";
      btn.type = "button";
      btn.setAttribute("role", "tab");
      btn.setAttribute("aria-selected", q.id === activeId ? "true" : "false");
      btn.setAttribute("aria-controls", "panel");
      btn.dataset.id = q.id;
      btn.textContent = `Q${q.tab}`;
      btn.addEventListener("click", () => setActive(q.id, true));
      return btn;
    }

    function setActive(id, focusPanel){
      activeId = id;
      renderTabs();
      renderPanel();
      if (focusPanel) panel.focus({preventScroll:false});
    }

    function renderTabs(){
      tabRow.innerHTML = "";
      filtered.forEach(q => tabRow.appendChild(makeTab(q)));
      // if active tab no longer in filtered, switch
      if (activeId && !filtered.some(q => q.id === activeId)){
        activeId = filtered[0]?.id ?? null;
        if (activeId) renderTabs();
      }
    }

    function cardDetails(title, dotClass, bodyHTML){
      return `
        <details class="card">
          <summary>
            <span class="chip"><span class="dot ${dotClass}" aria-hidden="true"></span>${title}</span>
            <span class="chev" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none">
                <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
          </summary>
          <div class="cardBody">${bodyHTML}</div>
        </details>
      `;
    }

    function renderPanel(){
      const q = filtered.find(x => x.id === activeId) || QUESTIONS.find(x => x.id === activeId);
      if (!q){
        panel.innerHTML = `
          <p class="prompt">No questions match your search.</p>
        `;
        return;
      }

      const misList = q.misconceptions.map(m => `<li>${m}</li>`).join("");
      panel.innerHTML = `
        <div class="questionTitle">
          <h2>${escapeHTML(q.title)} <span style="color: var(--muted2); font-weight:700;">(${escapeHTML(q.tab)})</span></h2>
          <div class="marks">${escapeHTML(q.marks)}</div>
        </div>
        <p class="prompt">${escapeHTML(q.prompt)}</p>

        <div class="cards" aria-label="Answer, explanation and misconceptions">
          ${cardDetails(
            "Model answer",
            "answer",
            `<p><span class="strong">Answer:</span> ${q.answer}</p>`
          )}

          ${cardDetails(
            "Explanation",
            "explain",
            `<p>${q.explanation}</p>`
          )}

          ${cardDetails(
            "Common misconceptions",
            "miscon",
            `<p class="strong">Watch out for these:</p><ul>${misList}</ul>`
          )}
        </div>
      `;
    }

    function expandOrCollapse(open){
      const details = panel.querySelectorAll("details.card");
      details.forEach(d => d.open = open);
    }

    expandAllBtn.addEventListener("click", () => expandOrCollapse(true));
    collapseAllBtn.addEventListener("click", () => expandOrCollapse(false));

    function matchesQuery(q, query){
      const hay = [
        q.title, q.prompt, q.tab,
        q.answer.replace(/<[^>]*>/g, ""),
        q.explanation,
        ...(q.keywords || []),
        ...(q.misconceptions || [])
      ].join(" ").toLowerCase();
      return hay.includes(query);
    }

    searchInput.addEventListener("input", (e) => {
      const query = e.target.value.trim().toLowerCase();
      if (!query){
        filtered = [...QUESTIONS];
      } else {
        filtered = QUESTIONS.filter(q => matchesQuery(q, query));
      }
      renderTabs();
      if (!activeId && filtered.length) activeId = filtered[0].id;
      renderPanel();
    });

    // Keyboard navigation for tabs (left/right)
    tabRow.addEventListener("keydown", (e) => {
      const tabs = Array.from(tabRow.querySelectorAll(".tab"));
      const idx = tabs.findIndex(t => t.dataset.id === activeId);
      if (idx < 0) return;

      if (e.key === "ArrowRight"){
        e.preventDefault();
        const next = tabs[Math.min(idx + 1, tabs.length - 1)];
        if (next) setActive(next.dataset.id, false), next.focus();
      }
      if (e.key === "ArrowLeft"){
        e.preventDefault();
        const prev = tabs[Math.max(idx - 1, 0)];
        if (prev) setActive(prev.dataset.id, false), prev.focus();
      }
      if (e.key === "Home"){
        e.preventDefault();
        const first = tabs[0];
        if (first) setActive(first.dataset.id, false), first.focus();
      }
      if (e.key === "End"){
        e.preventDefault();
        const last = tabs[tabs.length - 1];
        if (last) setActive(last.dataset.id, false), last.focus();
      }
    });

    // Initial render
    renderTabs();
    renderPanel();
  </script>
</body>
</html>
